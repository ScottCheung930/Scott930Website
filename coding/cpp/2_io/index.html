
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="ScottCheung930's personal website.">
      
      
        <meta name="author" content="scotcheung930">
      
      
        <link rel="canonical" href="https://scottcheung930.github.io/Scott930Website/coding/cpp/2_io/">
      
      
        <link rel="prev" href="../1_types/">
      
      
        <link rel="next" href="../3_container/">
      
      
        
      
      
      <link rel="icon" href="../../../assets/images/logo.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>输入输出 - Scott930</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      

  
  
  
  
  <style>:root{--md-annotation-icon:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2024%2024%22%3E%3Cpath%20d%3D%22M17%2013h-4v4h-2v-4H7v-2h4V7h2v4h4m-5-9A10%2010%200%200%200%202%2012a10%2010%200%200%200%2010%2010%2010%2010%200%200%200%2010-10A10%2010%200%200%200%2012%202%22/%3E%3C/svg%3E');}</style>


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../stylesheets/extra.css">
    
      <link rel="stylesheet" href="https://unpkg.com/katex@0/dist/katex.min.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#输入输出" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../../.." title="Scott930" class="md-header__button md-logo" aria-label="Scott930" data-md-component="logo">
      
  <img src="../../../assets/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Scott930
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              输入输出
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/ScottCheung930/Scott930Website" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    ScottCheung930/Scott930Website
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
  
    
  
  首页

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../communication/" class="md-tabs__link">
          
  
  
    
  
  通信

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../" class="md-tabs__link">
          
  
  
    
  
  代码

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../notes/" class="md-tabs__link">
          
  
  
    
  
  杂记

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Scott930" class="md-nav__button md-logo" aria-label="Scott930" data-md-component="logo">
      
  <img src="../../../assets/logo.png" alt="logo">

    </a>
    Scott930
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/ScottCheung930/Scott930Website" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    ScottCheung930/Scott930Website
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    首页
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../communication/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    通信
  

    
  </span>
  
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    通信
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    代码
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    代码
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../c/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    c
  

    
  </span>
  
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    c
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    c++
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    c++
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../1_types/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    C++的类型
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    输入输出
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    输入输出
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#继承关系" class="md-nav__link">
    <span class="md-ellipsis">
      
        继承关系
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ostream" class="md-nav__link">
    <span class="md-ellipsis">
      
        ostream
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ostream">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fmtflags" class="md-nav__link">
    <span class="md-ellipsis">
      
        fmtflags
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="fmtflags">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#常用的fmtflag操纵子" class="md-nav__link">
    <span class="md-ellipsis">
      
        常用的fmtflag操纵子
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#iomanip" class="md-nav__link">
    <span class="md-ellipsis">
      
        iomanip
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#改输出格式后恢复" class="md-nav__link">
    <span class="md-ellipsis">
      
        改输出格式后恢复
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="改输出格式后恢复">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#使用guard-class来封装一个不影响整体的输出函数" class="md-nav__link">
    <span class="md-ellipsis">
      
        使用guard class来封装一个不影响整体的输出函数
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#无格式输出" class="md-nav__link">
    <span class="md-ellipsis">
      
        无格式输出
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#输出重定向" class="md-nav__link">
    <span class="md-ellipsis">
      
        输出重定向
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#istream" class="md-nav__link">
    <span class="md-ellipsis">
      
        istream
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="istream">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#整行输入-cingetline或stringgetline" class="md-nav__link">
    <span class="md-ellipsis">
      
        整行输入 cin.getline()或string::getline()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#按字符输入-cinget" class="md-nav__link">
    <span class="md-ellipsis">
      
        按字符输入 cin.get()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cin错误处理" class="md-nav__link">
    <span class="md-ellipsis">
      
        cin错误处理
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="cin错误处理">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cinrdstate" class="md-nav__link">
    <span class="md-ellipsis">
      
        cin.rdstate()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#判断函数goodfailbadeof" class="md-nav__link">
    <span class="md-ellipsis">
      
        判断函数good()/fail()/bad()/eof()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#错误处理并输出导致错误的输入" class="md-nav__link">
    <span class="md-ellipsis">
      
        错误处理并输出导致错误的输入
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stringstream" class="md-nav__link">
    <span class="md-ellipsis">
      
        stringstream
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="stringstream">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#stringstream基础用法" class="md-nav__link">
    <span class="md-ellipsis">
      
        stringstream基础用法
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#istringstream-ostringstream" class="md-nav__link">
    <span class="md-ellipsis">
      
        istringstream, ostringstream
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fstream" class="md-nav__link">
    <span class="md-ellipsis">
      
        fstream
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="fstream">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#文件写入" class="md-nav__link">
    <span class="md-ellipsis">
      
        文件写入
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#文件读取" class="md-nav__link">
    <span class="md-ellipsis">
      
        文件读取
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#streambuf" class="md-nav__link">
    <span class="md-ellipsis">
      
        streambuf
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="streambuf">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#实现一个可切换输出设备终端文件的static输出流" class="md-nav__link">
    <span class="md-ellipsis">
      
        实现一个可切换输出设备(终端/文件)的static输出流
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="实现一个可切换输出设备(终端/文件)的static输出流">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#stdiosrdbuf" class="md-nav__link">
    <span class="md-ellipsis">
      
        std::ios::rdbuf()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#具体实现" class="md-nav__link">
    <span class="md-ellipsis">
      
        具体实现
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../3_container/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    容器
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../4_memory_and_lifetime/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    存储区, 作用域与生命周期(存储期)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../5_functions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    函数
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../6_compile_and_multifile/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    项目编译流程
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../7_oop/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    面向对象
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../8_cpp_heap_memory/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    C++的堆内存管理特性
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../macro/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    宏
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../notes/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    杂记
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    杂记
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../notes/masterThesis/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    毕设
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    毕设
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/masterThesis/2025-02-02/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2025年2月2日, w5
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/masterThesis/2025-02-07/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2025年2月7日, w6
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/masterThesis/2025-02-23/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2025年2月23日, w8
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/masterThesis/2025-03-09/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2025年3月9日, w10
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/masterThesis/2025-03-30/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2025年3月30日, w13
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/masterThesis/2025-04-06/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2025年4月6日, w14
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_3" >
        
          
          <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    讲座：5G and Beyond
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    讲座：5G and Beyond
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/lecture/note_CellularSystems-5GandBeyond/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Cellular systems - 5G and beyond Part 1
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/lecture/note_CellularSystems-5GandBeyond_part2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Cellular systems - 5G and beyond Part 2
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../notes/qqBot/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    QQ机器人
  

    
  </span>
  
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    QQ机器人
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_5" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../notes/smtpServer/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    邮件服务器与服务器VPN配置
  

    
  </span>
  
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    邮件服务器与服务器VPN配置
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#继承关系" class="md-nav__link">
    <span class="md-ellipsis">
      
        继承关系
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ostream" class="md-nav__link">
    <span class="md-ellipsis">
      
        ostream
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ostream">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fmtflags" class="md-nav__link">
    <span class="md-ellipsis">
      
        fmtflags
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="fmtflags">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#常用的fmtflag操纵子" class="md-nav__link">
    <span class="md-ellipsis">
      
        常用的fmtflag操纵子
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#iomanip" class="md-nav__link">
    <span class="md-ellipsis">
      
        iomanip
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#改输出格式后恢复" class="md-nav__link">
    <span class="md-ellipsis">
      
        改输出格式后恢复
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="改输出格式后恢复">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#使用guard-class来封装一个不影响整体的输出函数" class="md-nav__link">
    <span class="md-ellipsis">
      
        使用guard class来封装一个不影响整体的输出函数
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#无格式输出" class="md-nav__link">
    <span class="md-ellipsis">
      
        无格式输出
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#输出重定向" class="md-nav__link">
    <span class="md-ellipsis">
      
        输出重定向
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#istream" class="md-nav__link">
    <span class="md-ellipsis">
      
        istream
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="istream">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#整行输入-cingetline或stringgetline" class="md-nav__link">
    <span class="md-ellipsis">
      
        整行输入 cin.getline()或string::getline()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#按字符输入-cinget" class="md-nav__link">
    <span class="md-ellipsis">
      
        按字符输入 cin.get()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cin错误处理" class="md-nav__link">
    <span class="md-ellipsis">
      
        cin错误处理
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="cin错误处理">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cinrdstate" class="md-nav__link">
    <span class="md-ellipsis">
      
        cin.rdstate()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#判断函数goodfailbadeof" class="md-nav__link">
    <span class="md-ellipsis">
      
        判断函数good()/fail()/bad()/eof()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#错误处理并输出导致错误的输入" class="md-nav__link">
    <span class="md-ellipsis">
      
        错误处理并输出导致错误的输入
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stringstream" class="md-nav__link">
    <span class="md-ellipsis">
      
        stringstream
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="stringstream">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#stringstream基础用法" class="md-nav__link">
    <span class="md-ellipsis">
      
        stringstream基础用法
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#istringstream-ostringstream" class="md-nav__link">
    <span class="md-ellipsis">
      
        istringstream, ostringstream
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fstream" class="md-nav__link">
    <span class="md-ellipsis">
      
        fstream
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="fstream">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#文件写入" class="md-nav__link">
    <span class="md-ellipsis">
      
        文件写入
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#文件读取" class="md-nav__link">
    <span class="md-ellipsis">
      
        文件读取
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#streambuf" class="md-nav__link">
    <span class="md-ellipsis">
      
        streambuf
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="streambuf">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#实现一个可切换输出设备终端文件的static输出流" class="md-nav__link">
    <span class="md-ellipsis">
      
        实现一个可切换输出设备(终端/文件)的static输出流
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="实现一个可切换输出设备(终端/文件)的static输出流">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#stdiosrdbuf" class="md-nav__link">
    <span class="md-ellipsis">
      
        std::ios::rdbuf()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#具体实现" class="md-nav__link">
    <span class="md-ellipsis">
      
        具体实现
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
                



  


  <nav class="md-path" aria-label="导航栏" >
    <ol class="md-path__list">
      
        
  
  
    <li class="md-path__item">
      <a href="../../.." class="md-path__link">
        
  <span class="md-ellipsis">
    首页
  </span>

      </a>
    </li>
  

      
      
        
  
  
    
    
      <li class="md-path__item">
        <a href="../../" class="md-path__link">
          
  <span class="md-ellipsis">
    代码
  </span>

        </a>
      </li>
    
  

      
        
  
  
    
    
      <li class="md-path__item">
        <a href="../" class="md-path__link">
          
  <span class="md-ellipsis">
    c++
  </span>

        </a>
      </li>
    
  

      
    </ol>
  </nav>

              
              <article class="md-content__inner md-typeset">
                
                  <!--
  Copyright (c) 2016-2024 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Tags -->



<!--
  Hack: check whether the content contains a h1 headline. If it doesn't, the
  page title (or respectively site name) is used as the main headline.
-->


<!-- Page content -->
<h1 id="输入输出">输入输出<a class="headerlink" href="#输入输出">&para;</a></h1>
<div style="margin-top: -30px; font-size: 0.75em; opacity: 0.7;">
<p><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12a10 10 0 0 0 10 10 10 10 0 0 0 10-10h-2a8 8 0 0 1-8 8 8 8 0 0 1-8-8 8 8 0 0 1 8-8zm6.78 1a.7.7 0 0 0-.48.2l-1.22 1.21 2.5 2.5L20.8 5.7c.26-.26.26-.7 0-.95L19.25 3.2c-.13-.13-.3-.2-.47-.2m-2.41 2.12L9 12.5V15h2.5l7.37-7.38z"/></svg></span> 约 1875 个字 <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M360.8 1.2c-17-4.9-34.7 5-39.6 22l-128 448c-4.9 17 5 34.7 22 39.6s34.7-5 39.6-22l128-448c4.9-17-5-34.7-22-39.6m64.6 136.1c-12.5 12.5-12.5 32.8 0 45.3l73.4 73.4-73.4 73.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0l96-96c12.5-12.5 12.5-32.8 0-45.3l-96-96c-12.5-12.5-32.8-12.5-45.3 0zm-274.7 0c-12.5-12.5-32.8-12.5-45.3 0l-96 96c-12.5 12.5-12.5 32.8 0 45.3l96 96c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L77.3 256l73.3-73.4c12.5-12.5 12.5-32.8 0-45.3z"/></svg></span> 175 行代码 <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 17H7V3h14m0-2H7a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2M3 5H1v16a2 2 0 0 0 2 2h16v-2H3m12.96-10.71-2.75 3.54-1.96-2.36L8.5 15h11z"/></svg></span> 2 张图片 <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 20c4.42 0 8-3.58 8-8s-3.58-8-8-8-8 3.58-8 8 3.58 8 8 8m0-18c5.5 0 10 4.5 10 10s-4.5 10-10 10C6.47 22 2 17.5 2 12S6.5 2 12 2m.5 11H11V7h1.5v4.26l3.7-2.13.75 1.3z"/></svg></span> 预计阅读时间 8 分钟</p>
</div>
<ul>
<li>cin 标准输入流</li>
<li>cout 标准输出流</li>
<li>cerr 标准错误流</li>
<li>clog 标准日志流/带缓冲的错误流</li>
</ul>
<details class="note" open="open">
<summary>Note</summary>
<p><code>1&gt;</code> 重定向stdout,
<code>2&gt;</code>重定向stderr,
<code>&gt;</code>换成<code>&gt;&gt;</code>: 覆写文件换成在文件尾部追加</p>
</details>
<h2 id="继承关系">继承关系<a class="headerlink" href="#继承关系">&para;</a></h2>
<p>[下图]给出了输入输出流的模板类的继承关系, <code>CharT</code>可以适配各种基本字符类型
<img alt="io_basic_library" src="../images/io_basic_library.png" /></p>
<p>对于最常用的基本字符类型(<code>char</code>, <code>wchar_t</code>), C++也提供了单独的typedef, 最常用的<code>char</code>字符类型的输入输出库如下图
<a href="https://cplusplus.com/reference/iolibrary/">下图</a>所示.
<img alt="io_library" src="../images/io_library.png" /></p>
<p>注意派生类具有基类的性质, 所以ofstream会具有ostream的所有性质, 在介绍时不赘述.</p>
<h2 id="ostream">ostream<a class="headerlink" href="#ostream">&para;</a></h2>
<p>ostream是一个类, cout是预定义的ostream类的对象
cerr和clog也是ostream类的对象, cerr无缓冲区(实际有, 但只是每次都flush()), clog有缓冲区</p>
<p>注意clog和cerr都与C语言的stderr相关联, 很多时候它们会绑定到相同streambuf(同一个stderr缓冲区), 只是cerr默认每次都调用.flush(), 而clog并不会每次都flush(). 不过标准并不保证它们共享缓冲区, 若需要clog立刻输出, 应直接换成cerr或手动调用clog.flush().</p>
<h3 id="fmtflags">fmtflags<a class="headerlink" href="#fmtflags">&para;</a></h3>
<p>C++用bitmask表示各种格式控制开关, 而整体的掩码可以通过<code>os.flags()</code>获得.<code>std::ios::fmtflags</code>是一个bitmask类型,  <code>ios</code>被包含在<code>iostream</code>里. fmtflags包含不同功能的几个字段, 可以通过<code>cout.setf</code>直接设置某个字段的bitmask, 比如可以通过:</p>
<ul>
<li>
<p><code>std::cout.setf(std::ios::hex, std::ios::basefield);</code>把进制字段basefield 清空，再置表示16进制的比特位.</p>
</li>
<li>
<p><code>std::cout.setf(std::ios::hex);</code>按位或上表示16进制的比特位(没有把其它位置零, 可能冲突).</p>
</li>
</ul>
<p>但一般不会直接操纵bitmask, 而是通过对应的<strong>操纵子(manipulator)</strong>实现, 例如上述设置hex的操作等价于 <code>cout &lt;&lt; hex</code>. 这里是<code>&lt;&lt;</code>被重载, 使得其接受下一个操作数<code>hex</code>为函数指针, 再调用hex函数, 而hex函数就包装了<code>setf(std::ios::hex, std::ios::basefield)</code>.</p>
<h4 id="常用的fmtflag操纵子">常用的<code>fmtflag</code>操纵子<a class="headerlink" href="#常用的fmtflag操纵子">&para;</a></h4>
<ol>
<li>
<p>数字进制</p>
<ul>
<li><code>std::dec</code></li>
<li><code>std::dec</code></li>
<li><code>std::oct</code></li>
</ul>
</li>
<li>
<p>浮点格式</p>
<ul>
<li><code>std::fixed</code></li>
<li><code>std::scientific</code></li>
<li><code>std::hexfloat</code></li>
</ul>
</li>
<li>
<p>对齐方式</p>
<ul>
<li><code>std::left</code>     // 左对齐</li>
<li><code>std::right</code>    // 右对齐（默认）</li>
<li><code>std::internal</code> // 符号在左，数字右对齐（常配合宽度和填充）</li>
</ul>
</li>
<li>
<p>其它</p>
</li>
</ol>
<table>
<thead>
<tr>
<th>flag</th>
<th>操纵子</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>showbase</code></td>
<td><code>std::showbase</code></td>
<td>显示进制前缀：<code>0x</code>、<code>0</code> 等</td>
</tr>
<tr>
<td><code>showpos</code></td>
<td><code>std::showpos</code></td>
<td>正数前加 <code>+</code></td>
</tr>
<tr>
<td><code>showpoint</code></td>
<td><code>std::showpoint</code></td>
<td>浮点数即使是整数也显示小数点与尾零</td>
</tr>
<tr>
<td><code>uppercase</code></td>
<td><code>std::uppercase</code></td>
<td><code>E</code>、<code>X</code> 等字母大写</td>
</tr>
<tr>
<td><code>boolalpha</code></td>
<td><code>std::boolalpha</code></td>
<td><code>bool</code> 以 <code>true/false</code> 输出而不是 <code>1/0</code></td>
</tr>
<tr>
<td><code>noboolalpha</code></td>
<td><code>std::noboolalpha</code></td>
<td><code>bool</code> 以 <code>1/0</code> 输出</td>
</tr>
<tr>
<td><code>skipws</code></td>
<td><code>std::skipws</code></td>
<td>输入时跳过前导空白（默认开）</td>
</tr>
<tr>
<td></td>
<td><code>std::noskipws</code></td>
<td>输入时不跳过空白</td>
</tr>
<tr>
<td><code>unitbuf</code></td>
<td><code>std::unitbuf</code></td>
<td>每次输出都立即 flush</td>
</tr>
</tbody>
</table>
<h3 id="iomanip">iomanip<a class="headerlink" href="#iomanip">&para;</a></h3>
<p><code>iomanip</code>库存储带参数的格式操纵子和一些高级格式调整的工具. 需要<code>#include &lt;iomanip&gt;</code></p>
<ul>
<li>
<p>设定宽度: 
注意:不同于其它manipulator, <code>setw</code>只影响下一次<code>&lt;&lt;</code>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1"></a><a href="#__codelineno-0-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">setw</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">num</span><span class="p">;</span>
</span></code></pre></div></p>
</li>
<li>
<p>设定小数精度: 
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1"></a><a href="#__codelineno-1-1"><span class="linenos" data-linenos="1 "></span></a><span class="kt">double</span><span class="w"> </span><span class="n">num</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.23456</span><span class="p">;</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2"></a><a href="#__codelineno-1-2"><span class="linenos" data-linenos="2 "></span></a><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">setprecision</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">num</span><span class="p">;</span><span class="w"> </span><span class="c1">//得到1.235</span>
</span></code></pre></div></p>
</li>
<li>
<p>设定定点小数位数(与<code>fmtflags</code>的<code>std::fixed</code>连用)
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1"></a><a href="#__codelineno-2-1"><span class="linenos" data-linenos="1 "></span></a><span class="kt">double</span><span class="w"> </span><span class="n">num</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.2</span><span class="p">,</span><span class="n">num2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.2345</span><span class="p">;</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2"></a><a href="#__codelineno-2-2"><span class="linenos" data-linenos="2 "></span></a><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">fixed</span><span class="o">&lt;&lt;</span><span class="n">setprecission</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">&lt;&lt;</span><span class="n">num</span><span class="p">;</span><span class="w"> </span><span class="c1">//1.200</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3"></a><a href="#__codelineno-2-3"><span class="linenos" data-linenos="3 "></span></a><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">fixed</span><span class="o">&lt;&lt;</span><span class="n">setprecission</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">&lt;&lt;</span><span class="n">num2</span><span class="p">;</span><span class="w"> </span><span class="c1">//1.235</span>
</span></code></pre></div></p>
</li>
<li>
<p>设置前导零
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1"></a><a href="#__codelineno-3-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">setw</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="n">setfill</span><span class="p">(</span><span class="sc">&#39;0&#39;</span><span class="p">)</span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="c1">//得到0001(默认std::right)</span>
</span></code></pre></div></p>
</li>
<li>
<p>设置进制(对<code>fmtflags</code>的封装), 只支持8,10,16
<div class="language-c++ highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1"></a><a href="#__codelineno-4-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">setbase</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">16</span><span class="w"> </span><span class="c1">//20 </span>
</span></code></pre></div></p>
</li>
<li>
<p>包装fmtflags
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1"></a><a href="#__codelineno-5-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">ios</span><span class="o">::</span><span class="n">fmtflags</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ios</span><span class="o">::</span><span class="n">showbase</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ios</span><span class="o">::</span><span class="n">uppercase</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ios</span><span class="o">::</span><span class="n">showpos</span><span class="p">;</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2"></a><a href="#__codelineno-5-2"><span class="linenos" data-linenos="2 "></span></a><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">setiosflags</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">hex</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">255</span><span class="p">;</span>
</span></code></pre></div>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1"></a><a href="#__codelineno-6-1"><span class="linenos" data-linenos="1 "></span></a><span class="kt">void</span><span class="w"> </span><span class="nf">apply_format</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span><span class="w"> </span><span class="n">os</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">ios</span><span class="o">::</span><span class="n">fmtflags</span><span class="w"> </span><span class="n">f</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2"></a><a href="#__codelineno-6-2"><span class="linenos" data-linenos="2 "></span></a><span class="w">    </span><span class="n">os</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">setiosflags</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3"></a><a href="#__codelineno-6-3"><span class="linenos" data-linenos="3 "></span></a><span class="p">}</span>
</span></code></pre></div></p>
</li>
</ul>
<h3 id="改输出格式后恢复">改输出格式后恢复<a class="headerlink" href="#改输出格式后恢复">&para;</a></h3>
<ul>
<li>对于fmtflags, 可以使用<code>std::ios::fmtflags flags = os.flags()</code>保存状态;
<div class="language-c++ highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1"></a><a href="#__codelineno-7-1"><span class="linenos" data-linenos="1 "></span></a><span class="kt">void</span><span class="w"> </span><span class="nf">print_hex</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span><span class="w"> </span><span class="n">os</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2"></a><a href="#__codelineno-7-2"><span class="linenos" data-linenos="2 "></span></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">old</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">os</span><span class="p">.</span><span class="n">flags</span><span class="p">();</span><span class="w">  </span><span class="c1">// 保存</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3"></a><a href="#__codelineno-7-3"><span class="linenos" data-linenos="3 "></span></a>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4"></a><a href="#__codelineno-7-4"><span class="linenos" data-linenos="4 "></span></a><span class="w">    </span><span class="n">os</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">hex</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">showbase</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5"></a><a href="#__codelineno-7-5"><span class="linenos" data-linenos="5 "></span></a>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6"></a><a href="#__codelineno-7-6"><span class="linenos" data-linenos="6 "></span></a><span class="w">    </span><span class="n">os</span><span class="p">.</span><span class="n">flags</span><span class="p">(</span><span class="n">old</span><span class="p">);</span><span class="w">          </span><span class="c1">// 恢复</span>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7"></a><a href="#__codelineno-7-7"><span class="linenos" data-linenos="7 "></span></a><span class="p">}</span>
</span></code></pre></div></li>
</ul>
<p>若使用了不在fmtflags范围内的格式控制选项(如下所示), 还应:</p>
<ul>
<li>
<p>使用<code>std::streamsize prec = os.precision()</code>保存输出精度状态, 再使用<code>os.precision(prec);</code>恢复;</p>
</li>
<li>
<p>使用<code>char fill_char = os.fill()</code>保存填充字符状态, 再使用<code>os.fill(fill_char)</code>恢复;</p>
</li>
<li>
<p>注意: <code>setw</code>也不在fmtflags范围之内但其只影响下一次<code>&lt;&lt;</code>;</p>
</li>
</ul>
<h4 id="使用guard-class来封装一个不影响整体的输出函数">使用guard class来封装一个不影响整体的输出函数<a class="headerlink" href="#使用guard-class来封装一个不影响整体的输出函数">&para;</a></h4>
<div class="language-c++ highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1"></a><a href="#__codelineno-8-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="k">struct</span><span class="w"> </span><span class="nc">ios_guard</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2"></a><a href="#__codelineno-8-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">ios</span><span class="o">&amp;</span><span class="w"> </span><span class="n">os</span><span class="p">;</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3"></a><a href="#__codelineno-8-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">ios</span><span class="o">::</span><span class="n">fmtflags</span><span class="w"> </span><span class="n">flags</span><span class="p">;</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4"></a><a href="#__codelineno-8-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">streamsize</span><span class="w"> </span><span class="n">prec</span><span class="p">;</span>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5"></a><a href="#__codelineno-8-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">fill_char</span><span class="p">;</span>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6"></a><a href="#__codelineno-8-6"><span class="linenos" data-linenos=" 6 "></span></a>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7"></a><a href="#__codelineno-8-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="w">    </span><span class="k">explicit</span><span class="w"> </span><span class="n">ios_guard</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ios</span><span class="o">&amp;</span><span class="w"> </span><span class="n">os_</span><span class="p">)</span>
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8"></a><a href="#__codelineno-8-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="w">        </span><span class="o">:</span><span class="w"> </span><span class="n">os</span><span class="p">(</span><span class="n">os_</span><span class="p">),</span><span class="w"> </span><span class="n">flags</span><span class="p">(</span><span class="n">os_</span><span class="p">.</span><span class="n">flags</span><span class="p">()),</span>
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9"></a><a href="#__codelineno-8-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="w">          </span><span class="n">prec</span><span class="p">(</span><span class="n">os_</span><span class="p">.</span><span class="n">precision</span><span class="p">()),</span><span class="w"> </span><span class="n">fill_char</span><span class="p">(</span><span class="n">os_</span><span class="p">.</span><span class="n">fill</span><span class="p">())</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-8-10"><a id="__codelineno-8-10" name="__codelineno-8-10"></a><a href="#__codelineno-8-10"><span class="linenos" data-linenos="10 "></span></a>
</span><span id="__span-8-11"><a id="__codelineno-8-11" name="__codelineno-8-11"></a><a href="#__codelineno-8-11"><span class="linenos" data-linenos="11 "></span></a><span class="w">    </span><span class="o">~</span><span class="n">ios_guard</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-12"><a id="__codelineno-8-12" name="__codelineno-8-12"></a><a href="#__codelineno-8-12"><span class="linenos" data-linenos="12 "></span></a><span class="w">        </span><span class="n">os</span><span class="p">.</span><span class="n">flags</span><span class="p">(</span><span class="n">flags</span><span class="p">);</span>
</span><span id="__span-8-13"><a id="__codelineno-8-13" name="__codelineno-8-13"></a><a href="#__codelineno-8-13"><span class="linenos" data-linenos="13 "></span></a><span class="w">        </span><span class="n">os</span><span class="p">.</span><span class="n">precision</span><span class="p">(</span><span class="n">prec</span><span class="p">);</span>
</span><span id="__span-8-14"><a id="__codelineno-8-14" name="__codelineno-8-14"></a><a href="#__codelineno-8-14"><span class="linenos" data-linenos="14 "></span></a><span class="w">        </span><span class="n">os</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span><span class="n">fill_char</span><span class="p">);</span>
</span><span id="__span-8-15"><a id="__codelineno-8-15" name="__codelineno-8-15"></a><a href="#__codelineno-8-15"><span class="linenos" data-linenos="15 "></span></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-8-16"><a id="__codelineno-8-16" name="__codelineno-8-16"></a><a href="#__codelineno-8-16"><span class="linenos" data-linenos="16 "></span></a><span class="p">};</span>
</span><span id="__span-8-17"><a id="__codelineno-8-17" name="__codelineno-8-17"></a><a href="#__codelineno-8-17"><span class="linenos" data-linenos="17 "></span></a>
</span><span id="__span-8-18"><a id="__codelineno-8-18" name="__codelineno-8-18"></a><a href="#__codelineno-8-18"><span class="linenos" data-linenos="18 "></span></a><span class="kt">void</span><span class="w"> </span><span class="nf">myPrint</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span><span class="w"> </span><span class="n">os</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-19"><a id="__codelineno-8-19" name="__codelineno-8-19"></a><a href="#__codelineno-8-19"><span class="linenos" data-linenos="19 "></span></a><span class="w">    </span><span class="n">ios_guard</span><span class="w"> </span><span class="n">_</span><span class="p">{</span><span class="n">os</span><span class="p">};</span><span class="w">  </span><span class="c1">// 作用域内临时改格式</span>
</span><span id="__span-8-20"><a id="__codelineno-8-20" name="__codelineno-8-20"></a><a href="#__codelineno-8-20"><span class="linenos" data-linenos="20 "></span></a>
</span><span id="__span-8-21"><a id="__codelineno-8-21" name="__codelineno-8-21"></a><a href="#__codelineno-8-21"><span class="linenos" data-linenos="21 "></span></a><span class="w">    </span><span class="n">os</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">showpos</span>
</span><span id="__span-8-22"><a id="__codelineno-8-22" name="__codelineno-8-22"></a><a href="#__codelineno-8-22"><span class="linenos" data-linenos="22 "></span></a><span class="w">       </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">hexfloat</span>
</span><span id="__span-8-23"><a id="__codelineno-8-23" name="__codelineno-8-23"></a><a href="#__codelineno-8-23"><span class="linenos" data-linenos="23 "></span></a><span class="w">       </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">setprecision</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</span><span id="__span-8-24"><a id="__codelineno-8-24" name="__codelineno-8-24"></a><a href="#__codelineno-8-24"><span class="linenos" data-linenos="24 "></span></a><span class="w">       </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">setfill</span><span class="p">(</span><span class="sc">&#39;0&#39;</span><span class="p">)</span>
</span><span id="__span-8-25"><a id="__codelineno-8-25" name="__codelineno-8-25"></a><a href="#__codelineno-8-25"><span class="linenos" data-linenos="25 "></span></a><span class="w">       </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
</span><span id="__span-8-26"><a id="__codelineno-8-26" name="__codelineno-8-26"></a><a href="#__codelineno-8-26"><span class="linenos" data-linenos="26 "></span></a><span class="p">}</span><span class="w">   </span><span class="c1">// 离开作用域自动恢复 flags/precision/fill</span>
</span></code></pre></div>
<h3 id="无格式输出">无格式输出<a class="headerlink" href="#无格式输出">&para;</a></h3>
<p>需要按严格字节输出, 或者需要高性能地写大块缓冲区, 且不需要格式控制时使用.</p>
<ul>
<li>
<p><code>cout.put(char ch)</code> 输出一个字符, 忽略所有格式(即使之前设置过), 不会自动flush缓冲区(有缓冲)</p>
<p><code>cout.put(65);</code>输出字母<code>A</code>.</p>
</li>
<li>
<p><code>cout.write(const char* s, std::streamsize n)</code> 从地址s开始, 输出n个字符(不会遇到<code>\0</code>而停止), 无自动flush.</p>
</li>
</ul>
<h3 id="输出重定向">输出重定向<a class="headerlink" href="#输出重定向">&para;</a></h3>
<ul>
<li><code>1 &gt; file</code>重定向标准输出, <code>2 &gt; file</code>重定向标准错误</li>
</ul>
<h2 id="istream">istream<a class="headerlink" href="#istream">&para;</a></h2>
<p>同样的, cin是istream类的预定义的对象.</p>
<h3 id="整行输入-cingetline或stringgetline">整行输入 <code>cin.getline()</code>或<code>string::getline()</code><a class="headerlink" href="#整行输入-cingetline或stringgetline">&para;</a></h3>
<ul>
<li>作为<code>char[]</code>输入: <code>cin.getline(char* , streamsize )</code>
    参数为C风格字符数组和最大输入长度
    <div class="language-c++ highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1"></a><a href="#__codelineno-9-1"><span class="linenos" data-linenos="1 "></span></a><span class="kt">char</span><span class="w"> </span><span class="n">buf</span><span class="p">[</span><span class="mi">1024</span><span class="p">]{</span><span class="mi">0</span><span class="p">};</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2"></a><a href="#__codelineno-9-2"><span class="linenos" data-linenos="2 "></span></a><span class="n">cin</span><span class="p">.</span><span class="n">getline</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span><span class="mi">-1</span><span class="p">);</span><span class="c1">//-1为了留出&#39;\0&#39;的空间</span>
</span></code></pre></div>
    也可以读入直到指定分隔符
    <code>cin.getline(char*, streamsize, delemeter)</code></li>
<li>作为<code>string</code>类输入 (需<code>#include&lt;string&gt;</code>):<ul>
<li>读入包含空格的一整行: <code>getline(cin, line_var)</code></li>
<li>读入直到指定分隔符：<code>getline(cin, line_var, delimeter)</code></li>
</ul>
</li>
</ul>
<h3 id="按字符输入-cinget">按字符输入 <code>cin.get()</code><a class="headerlink" href="#按字符输入-cinget">&para;</a></h3>
<ul>
<li>
<p>输入一行按空格分隔的数字
    <code>cin &gt;&gt; str</code> 会默认跳过开始的空格, 并以空格或换行作为输入结尾（空格或换行仍保留在输入流中!）;
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1"></a><a href="#__codelineno-10-1"><span class="linenos" data-linenos="1 "></span></a><span class="kt">int</span><span class="w"> </span><span class="n">num</span><span class="p">;</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2"></a><a href="#__codelineno-10-2"><span class="linenos" data-linenos="2 "></span></a><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">nums</span><span class="p">;</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3"></a><a href="#__codelineno-10-3"><span class="linenos" data-linenos="3 "></span></a><span class="k">while</span><span class="p">(</span><span class="n">cin</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">num</span><span class="p">){</span>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4"></a><a href="#__codelineno-10-4"><span class="linenos" data-linenos="4 "></span></a><span class="w">    </span><span class="n">nums</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">num</span><span class="p">);</span>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5"></a><a href="#__codelineno-10-5"><span class="linenos" data-linenos="5 "></span></a><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">()</span><span class="o">==</span><span class="sc">&#39;\n&#39;</span><span class="p">){</span>
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6"></a><a href="#__codelineno-10-6"><span class="linenos" data-linenos="6 "></span></a><span class="w">        </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7"></a><a href="#__codelineno-10-7"><span class="linenos" data-linenos="7 "></span></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8"></a><a href="#__codelineno-10-8"><span class="linenos" data-linenos="8 "></span></a><span class="p">}</span>
</span></code></pre></div></p>
</li>
<li>
<p>输入直到换行或指定分隔符的另一种方法
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1"></a><a href="#__codelineno-11-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">string</span><span class="w"> </span><span class="n">str</span><span class="p">;</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2"></a><a href="#__codelineno-11-2"><span class="linenos" data-linenos="2 "></span></a><span class="k">for</span><span class="p">(;;){</span>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3"></a><a href="#__codelineno-11-3"><span class="linenos" data-linenos="3 "></span></a><span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">()</span>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4"></a><a href="#__codelineno-11-4"><span class="linenos" data-linenos="4 "></span></a><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">()</span><span class="o">==</span><span class="sc">&#39;\n&#39;</span><span class="p">){</span>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5"></a><a href="#__codelineno-11-5"><span class="linenos" data-linenos="5 "></span></a><span class="w">        </span><span class="p">......</span>
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6"></a><a href="#__codelineno-11-6"><span class="linenos" data-linenos="6 "></span></a><span class="w">        </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7"></a><a href="#__codelineno-11-7"><span class="linenos" data-linenos="7 "></span></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-11-8"><a id="__codelineno-11-8" name="__codelineno-11-8"></a><a href="#__codelineno-11-8"><span class="linenos" data-linenos="8 "></span></a><span class="w">    </span><span class="n">str</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">c</span><span class="p">;</span>
</span><span id="__span-11-9"><a id="__codelineno-11-9" name="__codelineno-11-9"></a><a href="#__codelineno-11-9"><span class="linenos" data-linenos="9 "></span></a><span class="p">}</span>
</span></code></pre></div></p>
</li>
</ul>
<h3 id="cin错误处理">cin错误处理<a class="headerlink" href="#cin错误处理">&para;</a></h3>
<p>cin作为istream类的预定义对象, 其成员函数也将适用于istream的派生类, 例如后文的ifstream, fstream, istringstream, stringstream.</p>
<h4 id="cinrdstate">cin.rdstate()<a class="headerlink" href="#cinrdstate">&para;</a></h4>
<p><code>ios::iostate rdstate()</code>是输入输出流的一组状态位, 其包含以下标志位:
<div class="language-c++ highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1"></a><a href="#__codelineno-12-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">ios</span><span class="o">::</span><span class="n">goodbit</span><span class="w">  </span><span class="c1">// 0，表示目前没有错误</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2"></a><a href="#__codelineno-12-2"><span class="linenos" data-linenos="2 "></span></a><span class="n">ios</span><span class="o">::</span><span class="n">eofbit</span><span class="w">   </span><span class="c1">// 读到 EOF（文件/输入结束）</span>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3"></a><a href="#__codelineno-12-3"><span class="linenos" data-linenos="3 "></span></a><span class="n">ios</span><span class="o">::</span><span class="n">failbit</span><span class="w">  </span><span class="c1">// 格式错误，或操作失败（但流本身没坏）</span>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4"></a><a href="#__codelineno-12-4"><span class="linenos" data-linenos="4 "></span></a><span class="n">ios</span><span class="o">::</span><span class="n">badbit</span><span class="w">   </span><span class="c1">// 输入流错误（比如底层设备损坏）</span>
</span></code></pre></div>
每次cin输入后,根据操作是否出错以及何种错误, 会自动更新rdstate()
- 正常状态: <code>cin.rdstate() == ios::goodbit</code> 为true
   注意: goodbit值为0
- 出错: 若多种错误同时发生, rdstate等于多种错误标志位的按位或
若手动判断, 可以如下进行:
<div class="language-c++ highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1"></a><a href="#__codelineno-13-1"><span class="linenos" data-linenos="1 "></span></a><span class="k">auto</span><span class="w"> </span><span class="n">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cin</span><span class="p">.</span><span class="n">rdstate</span><span class="p">();</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2"></a><a href="#__codelineno-13-2"><span class="linenos" data-linenos="2 "></span></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">state</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">ios</span><span class="o">::</span><span class="n">eofbit</span><span class="p">)</span><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="cm">/* 到 EOF 了 */</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3"></a><a href="#__codelineno-13-3"><span class="linenos" data-linenos="3 "></span></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">state</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">ios</span><span class="o">::</span><span class="n">failbit</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/* 输入格式错误 or 读取失败 */</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4"></a><a href="#__codelineno-13-4"><span class="linenos" data-linenos="4 "></span></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">state</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">ios</span><span class="o">::</span><span class="n">badbit</span><span class="p">)</span><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="cm">/* 输入流损坏(输入设备坏了)*/</span><span class="w"> </span><span class="p">}</span>
</span></code></pre></div></p>
<h4 id="判断函数goodfailbadeof">判断函数<code>good()/fail()/bad()/eof()</code><a class="headerlink" href="#判断函数goodfailbadeof">&para;</a></h4>
<p><code>good()/fail()/bad()/eof()</code>是对rdstate()判断的封装:
<div class="language-c++ highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1"></a><a href="#__codelineno-14-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">cin</span><span class="p">.</span><span class="n">good</span><span class="p">()</span><span class="w">  </span><span class="c1">// 等价于 rdstate() == goodbit</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2"></a><a href="#__codelineno-14-2"><span class="linenos" data-linenos="2 "></span></a><span class="n">cin</span><span class="p">.</span><span class="n">eof</span><span class="p">()</span><span class="w">   </span><span class="c1">// rdstate() &amp; eofbit</span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3"></a><a href="#__codelineno-14-3"><span class="linenos" data-linenos="3 "></span></a><span class="n">cin</span><span class="p">.</span><span class="n">fail</span><span class="p">()</span><span class="w">  </span><span class="c1">// rdstate() &amp; (failbit | badbit)  </span>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4"></a><a href="#__codelineno-14-4"><span class="linenos" data-linenos="4 "></span></a><span class="c1">// 注意：fail() 包含 badbit</span>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5"></a><a href="#__codelineno-14-5"><span class="linenos" data-linenos="5 "></span></a><span class="n">cin</span><span class="p">.</span><span class="n">bad</span><span class="p">()</span><span class="w">   </span><span class="c1">// rdstate() &amp; badbit</span>
</span></code></pre></div></p>
<p>failbit主要出现在输入格式不匹配的情况.</p>
<p>常见用法是:</p>
<ul>
<li>
<p>通过流对象的<code>operator bool()</code>重载, 流对象在条件判断里返回<code>!fail()</code>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1"></a><a href="#__codelineno-15-1"><span class="linenos" data-linenos="1 "></span></a><span class="k">while</span><span class="p">(</span><span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">x</span><span class="p">){...}</span><span class="w"> </span><span class="c1">//等价于while(!(cin&gt;&gt;x).fail()){ }</span>
</span></code></pre></div></p>
</li>
<li>
<p>通过流对象的<code>operator !()</code>重载, <code>!</code>之后的流对象会返回<code>fail()</code>
<div class="language-c++ highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1"></a><a href="#__codelineno-16-1"><span class="linenos" data-linenos="1 "></span></a><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">cin</span><span class="p">){...}</span><span class="w"> </span><span class="c1">///等价于if(cin.fail()</span>
</span></code></pre></div></p>
</li>
</ul>
<details class="note" open="open">
<summary>while (cin &gt;&gt; x)为什么不等于while ((cin &gt;&gt; x).good()?)</summary>
<p><code>while ((cin &gt;&gt; x).good()</code>会读不到&rdquo;恰好在文件结尾的那个字符&rdquo;</p>
<p>例如文件内容&rdquo;1 2 3&rdquo;(无多余空格)</p>
<div class="language-c++ highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1"></a><a href="#__codelineno-17-1"><span class="linenos" data-linenos="1 "></span></a><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">x</span><span class="p">){...}</span>
</span></code></pre></div>
<p>在第三次循环时会读到3, 此时eofbit被设置, cin.good()为false, cin.fail()为false. 若采用<code>while ((cin &gt;&gt; x).good()</code>, 第三次循环将不执行循环体直接结束, 而采用<code>while (cin &gt;&gt; x)</code>则将执行函数体, 并在第四次循环时因为读取不到任何字符而设置failbit, cin.fail()为true, 退出.</p>
</details>
<h4 id="错误处理并输出导致错误的输入">错误处理并输出导致错误的输入<a class="headerlink" href="#错误处理并输出导致错误的输入">&para;</a></h4>
<ul>
<li>使用<code>cin.clear()</code>恢复状态;</li>
<li>需要读入引起错误的输入, 否则会堵塞;
<div class="language-c++ highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1"></a><a href="#__codelineno-18-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="cp">#include</span><span class="cpf">&lt;iostream&gt;</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2"></a><a href="#__codelineno-18-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="cp">#include</span><span class="cpf">&lt;string&gt;</span>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3"></a><a href="#__codelineno-18-3"><span class="linenos" data-linenos=" 3 "></span></a>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4"></a><a href="#__codelineno-18-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="k">for</span><span class="p">(;;){</span>
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5"></a><a href="#__codelineno-18-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">{</span><span class="mi">0</span><span class="p">};</span>
</span><span id="__span-18-6"><a id="__codelineno-18-6" name="__codelineno-18-6"></a><a href="#__codelineno-18-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="w">    </span><span class="n">cin</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
</span><span id="__span-18-7"><a id="__codelineno-18-7" name="__codelineno-18-7"></a><a href="#__codelineno-18-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">cin</span><span class="p">.</span><span class="n">fail</span><span class="p">()){</span>
</span><span id="__span-18-8"><a id="__codelineno-18-8" name="__codelineno-18-8"></a><a href="#__codelineno-18-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="w">        </span><span class="n">cin</span><span class="p">.</span><span class="n">clear</span><span class="p">()</span><span class="w"> </span><span class="c1">//恢复rdstate状态为正常</span>
</span><span id="__span-18-9"><a id="__codelineno-18-9" name="__codelineno-18-9"></a><a href="#__codelineno-18-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="w">        </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;cin fail&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
</span><span id="__span-18-10"><a id="__codelineno-18-10" name="__codelineno-18-10"></a><a href="#__codelineno-18-10"><span class="linenos" data-linenos="10 "></span></a>
</span><span id="__span-18-11"><a id="__codelineno-18-11" name="__codelineno-18-11"></a><a href="#__codelineno-18-11"><span class="linenos" data-linenos="11 "></span></a><span class="w">        </span><span class="n">string</span><span class="w"> </span><span class="n">line</span><span class="p">;</span>
</span><span id="__span-18-12"><a id="__codelineno-18-12" name="__codelineno-18-12"></a><a href="#__codelineno-18-12"><span class="linenos" data-linenos="12 "></span></a><span class="w">        </span><span class="n">getline</span><span class="p">(</span><span class="n">cin</span><span class="p">,</span><span class="w"> </span><span class="n">line</span><span class="p">);</span><span class="c1">//把引起错误的输入取出, 否则输入会阻塞在这里</span>
</span><span id="__span-18-13"><a id="__codelineno-18-13" name="__codelineno-18-13"></a><a href="#__codelineno-18-13"><span class="linenos" data-linenos="13 "></span></a><span class="w">        </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;cin fail due to: &quot;</span><span class="o">&lt;&lt;</span><span class="n">line</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
</span><span id="__span-18-14"><a id="__codelineno-18-14" name="__codelineno-18-14"></a><a href="#__codelineno-18-14"><span class="linenos" data-linenos="14 "></span></a>
</span><span id="__span-18-15"><a id="__codelineno-18-15" name="__codelineno-18-15"></a><a href="#__codelineno-18-15"><span class="linenos" data-linenos="15 "></span></a><span class="w">        </span><span class="k">continue</span><span class="p">;</span>
</span><span id="__span-18-16"><a id="__codelineno-18-16" name="__codelineno-18-16"></a><a href="#__codelineno-18-16"><span class="linenos" data-linenos="16 "></span></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-18-17"><a id="__codelineno-18-17" name="__codelineno-18-17"></a><a href="#__codelineno-18-17"><span class="linenos" data-linenos="17 "></span></a><span class="p">}</span>
</span></code></pre></div></li>
</ul>
<h2 id="stringstream">stringstream<a class="headerlink" href="#stringstream">&para;</a></h2>
<p><code>#include &lt;sstream&gt;</code></p>
<p><code>stringstream</code>继承于<code>iostream</code>, 支持cout和cin的绝大多数用法, 只是不再绑定终端+缓冲区(比如在stringstream中插入endl, 只是插入一个换行, 因为没有刷新缓冲区的概念)</p>
<p>应用场景: 
1. 不是通过设备输入输出, 而是通过字符串, 比如通过网络发送/接收string类的消息体并解析, 这种消息体可能包含很复杂的格式.</p>
<ol>
<li>为了避免各种类型与string的类型转换, 输出流自带把所有东西当成字符串处理的功能.</li>
</ol>
<h3 id="stringstream基础用法">stringstream基础用法<a class="headerlink" href="#stringstream基础用法">&para;</a></h3>
<div class="language-c++ highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1"></a><a href="#__codelineno-19-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;sstream&gt;</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2"></a><a href="#__codelineno-19-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3"></a><a href="#__codelineno-19-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string&gt;</span>
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4"></a><a href="#__codelineno-19-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">std</span><span class="p">;</span>
</span><span id="__span-19-5"><a id="__codelineno-19-5" name="__codelineno-19-5"></a><a href="#__codelineno-19-5"><span class="linenos" data-linenos=" 5 "></span></a>
</span><span id="__span-19-6"><a id="__codelineno-19-6" name="__codelineno-19-6"></a><a href="#__codelineno-19-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(){</span>
</span><span id="__span-19-7"><a id="__codelineno-19-7" name="__codelineno-19-7"></a><a href="#__codelineno-19-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="w">    </span><span class="n">stringstream</span><span class="w"> </span><span class="n">ss</span><span class="p">;</span>
</span><span id="__span-19-8"><a id="__codelineno-19-8" name="__codelineno-19-8"></a><a href="#__codelineno-19-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="w">    </span><span class="n">ss</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;test stringstream&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">hex</span><span class="o">&lt;&lt;</span><span class="mi">100</span><span class="o">&lt;&lt;</span><span class="n">boolalpha</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"> </span><span class="c1">//同cout语法</span>
</span><span id="__span-19-9"><a id="__codelineno-19-9" name="__codelineno-19-9"></a><a href="#__codelineno-19-9"><span class="linenos" data-linenos=" 9 "></span></a>
</span><span id="__span-19-10"><a id="__codelineno-19-10" name="__codelineno-19-10"></a><a href="#__codelineno-19-10"><span class="linenos" data-linenos="10 "></span></a><span class="w">    </span><span class="n">string</span><span class="w"> </span><span class="n">str1</span><span class="p">,</span><span class="w"> </span><span class="n">str2</span><span class="p">;</span>
</span><span id="__span-19-11"><a id="__codelineno-19-11" name="__codelineno-19-11"></a><a href="#__codelineno-19-11"><span class="linenos" data-linenos="11 "></span></a><span class="w">    </span><span class="n">ss</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">str1</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">str2</span><span class="w"> </span><span class="p">;</span><span class="w">  </span><span class="c1">//同cin语法</span>
</span><span id="__span-19-12"><a id="__codelineno-19-12" name="__codelineno-19-12"></a><a href="#__codelineno-19-12"><span class="linenos" data-linenos="12 "></span></a><span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">str1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">str2</span><span class="p">;</span><span class="w"> </span><span class="c1">//输出test stringstream </span>
</span><span id="__span-19-13"><a id="__codelineno-19-13" name="__codelineno-19-13"></a><a href="#__codelineno-19-13"><span class="linenos" data-linenos="13 "></span></a>
</span><span id="__span-19-14"><a id="__codelineno-19-14" name="__codelineno-19-14"></a><a href="#__codelineno-19-14"><span class="linenos" data-linenos="14 "></span></a><span class="w">    </span><span class="n">string</span><span class="w"> </span><span class="n">str3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;123</span><span class="se">\n</span><span class="s">456</span><span class="se">\n</span><span class="s">789&quot;</span><span class="p">;</span>
</span><span id="__span-19-15"><a id="__codelineno-19-15" name="__codelineno-19-15"></a><a href="#__codelineno-19-15"><span class="linenos" data-linenos="15 "></span></a><span class="w">    </span><span class="n">stringstream</span><span class="w"> </span><span class="n">ss3</span><span class="p">(</span><span class="n">str3</span><span class="p">);</span>
</span><span id="__span-19-16"><a id="__codelineno-19-16" name="__codelineno-19-16"></a><a href="#__codelineno-19-16"><span class="linenos" data-linenos="16 "></span></a><span class="w">    </span><span class="n">string</span><span class="w"> </span><span class="n">line</span><span class="p">;</span>
</span><span id="__span-19-17"><a id="__codelineno-19-17" name="__codelineno-19-17"></a><a href="#__codelineno-19-17"><span class="linenos" data-linenos="17 "></span></a><span class="w">    </span>
</span><span id="__span-19-18"><a id="__codelineno-19-18" name="__codelineno-19-18"></a><a href="#__codelineno-19-18"><span class="linenos" data-linenos="18 "></span></a><span class="w">    </span><span class="k">for</span><span class="p">(;;){</span>
</span><span id="__span-19-19"><a id="__codelineno-19-19" name="__codelineno-19-19"></a><a href="#__codelineno-19-19"><span class="linenos" data-linenos="19 "></span></a><span class="w">        </span><span class="n">getline</span><span class="p">(</span><span class="n">ss3</span><span class="p">,</span><span class="w"> </span><span class="n">line</span><span class="p">);</span>
</span><span id="__span-19-20"><a id="__codelineno-19-20" name="__codelineno-19-20"></a><a href="#__codelineno-19-20"><span class="linenos" data-linenos="20 "></span></a><span class="w">        </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">line</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
</span><span id="__span-19-21"><a id="__codelineno-19-21" name="__codelineno-19-21"></a><a href="#__codelineno-19-21"><span class="linenos" data-linenos="21 "></span></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">ss</span><span class="p">.</span><span class="n">eof</span><span class="p">())</span><span class="w"> </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-19-22"><a id="__codelineno-19-22" name="__codelineno-19-22"></a><a href="#__codelineno-19-22"><span class="linenos" data-linenos="22 "></span></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-19-23"><a id="__codelineno-19-23" name="__codelineno-19-23"></a><a href="#__codelineno-19-23"><span class="linenos" data-linenos="23 "></span></a><span class="w">    </span>
</span><span id="__span-19-24"><a id="__codelineno-19-24" name="__codelineno-19-24"></a><a href="#__codelineno-19-24"><span class="linenos" data-linenos="24 "></span></a><span class="w">    </span>
</span><span id="__span-19-25"><a id="__codelineno-19-25" name="__codelineno-19-25"></a><a href="#__codelineno-19-25"><span class="linenos" data-linenos="25 "></span></a><span class="p">}</span>
</span></code></pre></div>
<ul>
<li>
<p>输出stringstream的内容:<code>cout &lt;&lt; ss.str() &lt;&lt; endl</code></p>
</li>
<li>
<p>清空stringstream: <code>ss.str("")</code>将空字符串传给stringstream (注意, 同cin一样, <code>ss.clear()</code>是清空错误状态, 不是清空内容)</p>
</li>
</ul>
<h3 id="istringstream-ostringstream">istringstream, ostringstream<a class="headerlink" href="#istringstream-ostringstream">&para;</a></h3>
<p>istringstream 可以作为输入流；
ostringstream 可以作为输出流；</p>
<p>输入空格分隔的一行多整数
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1"></a><a href="#__codelineno-20-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">string</span><span class="w"> </span><span class="n">line</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;10 20 30&quot;</span>
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2"></a><a href="#__codelineno-20-2"><span class="linenos" data-linenos="2 "></span></a><span class="n">istringstream</span><span class="w"> </span><span class="n">iss</span><span class="p">(</span><span class="n">line</span><span class="p">);</span>
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3"></a><a href="#__codelineno-20-3"><span class="linenos" data-linenos="3 "></span></a><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4"></a><a href="#__codelineno-20-4"><span class="linenos" data-linenos="4 "></span></a><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">a</span><span class="p">;</span>
</span><span id="__span-20-5"><a id="__codelineno-20-5" name="__codelineno-20-5"></a><a href="#__codelineno-20-5"><span class="linenos" data-linenos="5 "></span></a><span class="k">while</span><span class="p">(</span><span class="n">iss</span><span class="o">&gt;&gt;</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
</span></code></pre></div></p>
<p>输入指定分隔符的元素
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1"></a><a href="#__codelineno-21-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">string</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;1.2.3.4&quot;</span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2"></a><a href="#__codelineno-21-2"><span class="linenos" data-linenos="2 "></span></a><span class="n">istringstream</span><span class="w"> </span><span class="n">iss</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3"></a><a href="#__codelineno-21-3"><span class="linenos" data-linenos="3 "></span></a><span class="n">string</span><span class="w"> </span><span class="n">part</span><span class="p">;</span>
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4"></a><a href="#__codelineno-21-4"><span class="linenos" data-linenos="4 "></span></a><span class="k">while</span><span class="p">(</span><span class="n">getline</span><span class="p">(</span><span class="n">iss</span><span class="p">,</span><span class="n">part</span><span class="p">,</span><span class="sc">&#39;.&#39;</span><span class="p">)){</span>
</span><span id="__span-21-5"><a id="__codelineno-21-5" name="__codelineno-21-5"></a><a href="#__codelineno-21-5"><span class="linenos" data-linenos="5 "></span></a><span class="w">    </span><span class="c1">//part可能为空，例如&quot;1..3&quot;会得到一个空part</span>
</span><span id="__span-21-6"><a id="__codelineno-21-6" name="__codelineno-21-6"></a><a href="#__codelineno-21-6"><span class="linenos" data-linenos="6 "></span></a><span class="p">}</span>
</span></code></pre></div></p>
<p>自定义输入函数
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1"></a><a href="#__codelineno-22-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">parseInput</span><span class="p">(</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">s</span><span class="p">){</span>
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2"></a><a href="#__codelineno-22-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="w">    </span><span class="n">istringstream</span><span class="w"> </span><span class="nf">iss</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3"></a><a href="#__codelineno-22-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="w">    </span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">nums</span><span class="p">;</span>
</span><span id="__span-22-4"><a id="__codelineno-22-4" name="__codelineno-22-4"></a><a href="#__codelineno-22-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="w">    </span><span class="n">string</span><span class="w"> </span><span class="n">part</span><span class="p">;</span>
</span><span id="__span-22-5"><a id="__codelineno-22-5" name="__codelineno-22-5"></a><a href="#__codelineno-22-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="w">    </span><span class="k">while</span><span class="p">(</span><span class="n">getline</span><span class="p">(</span><span class="n">iss</span><span class="p">,</span><span class="n">part</span><span class="p">,</span><span class="sc">&#39;.&#39;</span><span class="p">)){</span>
</span><span id="__span-22-6"><a id="__codelineno-22-6" name="__codelineno-22-6"></a><a href="#__codelineno-22-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="w">        </span><span class="n">nums</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">stoi</span><span class="p">(</span><span class="n">part</span><span class="p">));</span>
</span><span id="__span-22-7"><a id="__codelineno-22-7" name="__codelineno-22-7"></a><a href="#__codelineno-22-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-22-8"><a id="__codelineno-22-8" name="__codelineno-22-8"></a><a href="#__codelineno-22-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">nums</span><span class="p">;</span>
</span><span id="__span-22-9"><a id="__codelineno-22-9" name="__codelineno-22-9"></a><a href="#__codelineno-22-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="p">}</span>
</span><span id="__span-22-10"><a id="__codelineno-22-10" name="__codelineno-22-10"></a><a href="#__codelineno-22-10"><span class="linenos" data-linenos="10 "></span></a>
</span><span id="__span-22-11"><a id="__codelineno-22-11" name="__codelineno-22-11"></a><a href="#__codelineno-22-11"><span class="linenos" data-linenos="11 "></span></a>
</span><span id="__span-22-12"><a id="__codelineno-22-12" name="__codelineno-22-12"></a><a href="#__codelineno-22-12"><span class="linenos" data-linenos="12 "></span></a><span class="kt">int</span><span class="w"> </span><span class="n">main</span><span class="p">(){</span>
</span><span id="__span-22-13"><a id="__codelineno-22-13" name="__codelineno-22-13"></a><a href="#__codelineno-22-13"><span class="linenos" data-linenos="13 "></span></a><span class="w">    </span><span class="n">string</span><span class="w"> </span><span class="n">s</span><span class="p">;</span>
</span><span id="__span-22-14"><a id="__codelineno-22-14" name="__codelineno-22-14"></a><a href="#__codelineno-22-14"><span class="linenos" data-linenos="14 "></span></a><span class="w">    </span><span class="n">getline</span><span class="p">(</span><span class="n">cin</span><span class="p">,</span><span class="n">s</span><span class="p">);</span>
</span><span id="__span-22-15"><a id="__codelineno-22-15" name="__codelineno-22-15"></a><a href="#__codelineno-22-15"><span class="linenos" data-linenos="15 "></span></a><span class="w">    </span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">nums</span><span class="p">;</span>
</span><span id="__span-22-16"><a id="__codelineno-22-16" name="__codelineno-22-16"></a><a href="#__codelineno-22-16"><span class="linenos" data-linenos="16 "></span></a><span class="w">    </span><span class="n">nums</span><span class="o">=</span><span class="n">parseInput</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
</span><span id="__span-22-17"><a id="__codelineno-22-17" name="__codelineno-22-17"></a><a href="#__codelineno-22-17"><span class="linenos" data-linenos="17 "></span></a><span class="p">}</span>
</span></code></pre></div></p>
<p>实现类似sprintf的输出到字符串
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1"></a><a href="#__codelineno-23-1"><span class="linenos" data-linenos="1 "></span></a><span class="kt">double</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">3.14159</span><span class="p">;</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">7</span><span class="p">;</span>
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2"></a><a href="#__codelineno-23-2"><span class="linenos" data-linenos="2 "></span></a><span class="n">ostringstream</span><span class="w"> </span><span class="n">oss</span><span class="p">;</span>
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3"></a><a href="#__codelineno-23-3"><span class="linenos" data-linenos="3 "></span></a><span class="n">oss</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;x=&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">fixed</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">setprecision</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">x</span>
</span><span id="__span-23-4"><a id="__codelineno-23-4" name="__codelineno-23-4"></a><a href="#__codelineno-23-4"><span class="linenos" data-linenos="4 "></span></a><span class="w">    </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;, n=&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">setw</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">setfill</span><span class="p">(</span><span class="sc">&#39;0&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="c1">// 001</span>
</span><span id="__span-23-5"><a id="__codelineno-23-5" name="__codelineno-23-5"></a><a href="#__codelineno-23-5"><span class="linenos" data-linenos="5 "></span></a><span class="n">string</span><span class="w"> </span><span class="n">out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">oss</span><span class="p">.</span><span class="n">str</span><span class="p">();</span><span class="w">   </span><span class="c1">// &quot;x=3.14, n=007&quot;</span>
</span></code></pre></div></p>
<h2 id="fstream">fstream<a class="headerlink" href="#fstream">&para;</a></h2>
<p><code>include&lt;fstream&gt;</code></p>
<p>类型:<code>fstream</code>, <code>ifstream</code>, <code>ofstream</code></p>
<ul>
<li>基础用法:<ul>
<li>打开文件 <code>fstream fs("text.txt")</code>或者<code>fs.open("test.txt")</code></li>
<li>关闭文件 <code>fs.close()</code>. 当文件流对象析构时也会自动close, 但需注意有的系统有文件句柄的总数限制, 所以不使用文件时应主动关闭fs. close也会自动flush缓冲区.</li>
<li>文件是否打开<code>fs.is_open()</code></li>
<li>打开模式
    <div class="language-c++ highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1"></a><a href="#__codelineno-24-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">std</span><span class="o">::</span><span class="n">ios</span><span class="o">::</span><span class="n">in</span><span class="w">     </span><span class="c1">// 以输入（读）方式打开</span>
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2"></a><a href="#__codelineno-24-2"><span class="linenos" data-linenos="2 "></span></a><span class="n">std</span><span class="o">::</span><span class="n">ios</span><span class="o">::</span><span class="n">out</span><span class="w">    </span><span class="c1">// 以输出（写）方式打开</span>
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3"></a><a href="#__codelineno-24-3"><span class="linenos" data-linenos="3 "></span></a><span class="n">std</span><span class="o">::</span><span class="n">ios</span><span class="o">::</span><span class="n">app</span><span class="w">    </span><span class="c1">// 追加写，每次写都在末尾</span>
</span><span id="__span-24-4"><a id="__codelineno-24-4" name="__codelineno-24-4"></a><a href="#__codelineno-24-4"><span class="linenos" data-linenos="4 "></span></a><span class="n">std</span><span class="o">::</span><span class="n">ios</span><span class="o">::</span><span class="n">trunc</span><span class="w">  </span><span class="c1">// 打开时截断文件为长度 0（清空）, 在ios::out或者ostream时默认启用, 有ios::in或者istream时不生效.</span>
</span><span id="__span-24-5"><a id="__codelineno-24-5" name="__codelineno-24-5"></a><a href="#__codelineno-24-5"><span class="linenos" data-linenos="5 "></span></a><span class="n">std</span><span class="o">::</span><span class="n">ios</span><span class="o">::</span><span class="n">binary</span><span class="w"> </span><span class="c1">// 二进制模式</span>
</span><span id="__span-24-6"><a id="__codelineno-24-6" name="__codelineno-24-6"></a><a href="#__codelineno-24-6"><span class="linenos" data-linenos="6 "></span></a><span class="n">std</span><span class="o">::</span><span class="n">ios</span><span class="o">::</span><span class="n">ate</span><span class="w">    </span><span class="c1">// 打开后定位到文件末尾（但仍可在任意位置读写）</span>
</span></code></pre></div>
    打开模式是bitmask, 所以按位或
    <code>fs.open("test.txt", std::ios::binary|std::ios::app)</code></li>
</ul>
</li>
</ul>
<p>若使用<code>fstream</code>, 则必须在第二个参数位(打开模式)指明读/写/读写; 若为<code>ofstream</code>或者<code>ifstream</code>则不用.</p>
<h3 id="文件写入">文件写入<a class="headerlink" href="#文件写入">&para;</a></h3>
<ul>
<li>
<p>可以使用<code>fstream</code>或<code>ofstream</code></p>
</li>
<li>
<p><code>ios::binary</code>, 在Windows平台和Linux平台默认对<code>\r\n</code>的处理不同, 可能存在默认的转换. 而<code>ios::binary</code>不对此进行处理或转换. 尤其是对于图像视频等二进制文件, 应使用<code>ios::binary</code>防止写入时文件损坏.</p>
</li>
<li>
<p><code>fstream</code>(<code>ios::out</code>)和<code>ostream</code>写文件是默认清空源文件开始写! (默认设置<code>std::ios::trunc</code>). 若不希望清空源文件, 使用<code>ios::app</code>.</p>
</li>
<li>
<p><code>ios::app</code>: 每次写入时都从结尾开始写入, 文件不存在会被创建</p>
</li>
</ul>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1"></a><a href="#__codelineno-25-1"><span class="linenos" data-linenos="1 "></span></a><span class="c1">//以写入模式打开文件</span>
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2"></a><a href="#__codelineno-25-2"><span class="linenos" data-linenos="2 "></span></a><span class="n">fstream</span><span class="w"> </span><span class="nf">wfs</span><span class="p">(</span><span class="n">testfile</span><span class="p">,</span><span class="w"> </span><span class="n">ios</span><span class="o">::</span><span class="n">out</span><span class="o">|</span><span class="n">ios</span><span class="o">::</span><span class="n">binary</span><span class="o">|</span><span class="n">ios</span><span class="o">::</span><span class="n">app</span><span class="p">);</span>
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3"></a><a href="#__codelineno-25-3"><span class="linenos" data-linenos="3 "></span></a><span class="c1">//或者: fstream wfs; wfs.open(testfile, ios::out|ios::binary);</span>
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4"></a><a href="#__codelineno-25-4"><span class="linenos" data-linenos="4 "></span></a><span class="n">wfs</span><span class="o">&lt;&lt;</span><span class="s">&quot;1234567890</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span id="__span-25-5"><a id="__codelineno-25-5" name="__codelineno-25-5"></a><a href="#__codelineno-25-5"><span class="linenos" data-linenos="5 "></span></a><span class="n">wfs</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;987654321&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span><span class="p">);</span>
</span></code></pre></div>
<h3 id="文件读取">文件读取<a class="headerlink" href="#文件读取">&para;</a></h3>
<ul>
<li>
<p><code>ios::ate</code>在打开时移到文件末尾(但并非每次读写自动都在末尾, 与<code>ios::app</code>不同)</p>
</li>
<li>
<p>处理打开失败
<div class="language-c++ highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1"></a><a href="#__codelineno-26-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">testfile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;test.txt&quot;</span><span class="p">;</span>
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2"></a><a href="#__codelineno-26-2"><span class="linenos" data-linenos="2 "></span></a><span class="n">fstream</span><span class="w"> </span><span class="nf">rfs</span><span class="p">(</span><span class="n">testfile</span><span class="p">,</span><span class="w"> </span><span class="n">ios</span><span class="o">::</span><span class="n">in</span><span class="o">|</span><span class="n">ios</span><span class="o">::</span><span class="n">binary</span><span class="p">)</span>
</span><span id="__span-26-3"><a id="__codelineno-26-3" name="__codelineno-26-3"></a><a href="#__codelineno-26-3"><span class="linenos" data-linenos="3 "></span></a>
</span><span id="__span-26-4"><a id="__codelineno-26-4" name="__codelineno-26-4"></a><a href="#__codelineno-26-4"><span class="linenos" data-linenos="4 "></span></a><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">rf</span><span class="p">.</span><span class="n">is_open</span><span class="p">()){</span>
</span><span id="__span-26-5"><a id="__codelineno-26-5" name="__codelineno-26-5"></a><a href="#__codelineno-26-5"><span class="linenos" data-linenos="5 "></span></a><span class="w">    </span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;open file&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">testfile</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;failed!&quot;</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
</span><span id="__span-26-6"><a id="__codelineno-26-6" name="__codelineno-26-6"></a><a href="#__codelineno-26-6"><span class="linenos" data-linenos="6 "></span></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
</span><span id="__span-26-7"><a id="__codelineno-26-7" name="__codelineno-26-7"></a><a href="#__codelineno-26-7"><span class="linenos" data-linenos="7 "></span></a><span class="p">}</span>
</span></code></pre></div></p>
</li>
<li>
<p>输出读到的字符数
<div class="language-c++ highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1"></a><a href="#__codelineno-27-1"><span class="linenos" data-linenos="1 "></span></a><span class="kt">char</span><span class="w"> </span><span class="n">buf</span><span class="p">[</span><span class="mi">4090</span><span class="p">]{</span><span class="mi">0</span><span class="p">};</span>
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2"></a><a href="#__codelineno-27-2"><span class="linenos" data-linenos="2 "></span></a><span class="n">rfs</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span><span class="mi">-1</span><span class="p">)</span>
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3"></a><a href="#__codelineno-27-3"><span class="linenos" data-linenos="3 "></span></a>
</span><span id="__span-27-4"><a id="__codelineno-27-4" name="__codelineno-27-4"></a><a href="#__codelineno-27-4"><span class="linenos" data-linenos="4 "></span></a><span class="n">cout</span><span class="o">&lt;&lt;</span><span class="n">rfs</span><span class="p">.</span><span class="n">gcount</span><span class="p">()</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span><span class="c1">//输出读了的字符数</span>
</span><span id="__span-27-5"><a id="__codelineno-27-5" name="__codelineno-27-5"></a><a href="#__codelineno-27-5"><span class="linenos" data-linenos="5 "></span></a><span class="n">cout</span><span class="o">&lt;&lt;</span><span class="n">buf</span><span class="o">&lt;&lt;</span><span class="n">endl</span>
</span></code></pre></div></p>
</li>
<li>
<p>获取文件大小:
<div class="language-c++ highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1"></a><a href="#__codelineno-28-1"><span class="linenos" data-linenos="1 "></span></a><span class="c1">//先移动文件读取指针到尾部</span>
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2"></a><a href="#__codelineno-28-2"><span class="linenos" data-linenos="2 "></span></a><span class="n">ifstream</span><span class="w"> </span><span class="n">ifs</span><span class="p">(</span><span class="n">testfile</span><span class="p">,</span><span class="w"> </span><span class="n">ios</span><span class="o">::</span><span class="n">binary</span><span class="o">|</span><span class="n">ios</span><span class="o">::</span><span class="n">ate</span><span class="p">)</span>
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3"></a><a href="#__codelineno-28-3"><span class="linenos" data-linenos="3 "></span></a>
</span><span id="__span-28-4"><a id="__codelineno-28-4" name="__codelineno-28-4"></a><a href="#__codelineno-28-4"><span class="linenos" data-linenos="4 "></span></a><span class="c1">//获取文件读取指针的位置, 即尾部位置</span>
</span><span id="__span-28-5"><a id="__codelineno-28-5" name="__codelineno-28-5"></a><a href="#__codelineno-28-5"><span class="linenos" data-linenos="5 "></span></a><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">testfile</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;filesize=&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="n">ifs</span><span class="p">.</span><span class="n">tellg</span><span class="p">();</span>
</span></code></pre></div></p>
</li>
<li>
<p>实时读取文件的新增内容</p>
</li>
</ul>
<div class="language-c++ highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1"></a><a href="#__codelineno-29-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="cp">#include</span><span class="cpf">&lt;string&gt;</span>
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2"></a><a href="#__codelineno-29-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="cp">#include</span><span class="cpf">&lt;iostream&gt;</span>
</span><span id="__span-29-3"><a id="__codelineno-29-3" name="__codelineno-29-3"></a><a href="#__codelineno-29-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="cp">#include</span><span class="cpf">&lt;fstream&gt;</span>
</span><span id="__span-29-4"><a id="__codelineno-29-4" name="__codelineno-29-4"></a><a href="#__codelineno-29-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">std</span><span class="p">;</span>
</span><span id="__span-29-5"><a id="__codelineno-29-5" name="__codelineno-29-5"></a><a href="#__codelineno-29-5"><span class="linenos" data-linenos=" 5 "></span></a>
</span><span id="__span-29-6"><a id="__codelineno-29-6" name="__codelineno-29-6"></a><a href="#__codelineno-29-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(){</span>
</span><span id="__span-29-7"><a id="__codelineno-29-7" name="__codelineno-29-7"></a><a href="#__codelineno-29-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="w">    </span><span class="n">string</span><span class="w"> </span><span class="n">testfile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;test.txt&quot;</span><span class="p">;</span>
</span><span id="__span-29-8"><a id="__codelineno-29-8" name="__codelineno-29-8"></a><a href="#__codelineno-29-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="w">    </span><span class="n">ifstream</span><span class="w"> </span><span class="n">ifs</span><span class="p">(</span><span class="n">testfile</span><span class="p">,</span><span class="w"> </span><span class="n">ios</span><span class="o">::</span><span class="n">ate</span><span class="o">|</span><span class="n">ios</span><span class="o">::</span><span class="n">binary</span><span class="p">);</span>
</span><span id="__span-29-9"><a id="__codelineno-29-9" name="__codelineno-29-9"></a><a href="#__codelineno-29-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="w">    </span><span class="n">string</span><span class="w"> </span><span class="n">line</span><span class="p">;</span>
</span><span id="__span-29-10"><a id="__codelineno-29-10" name="__codelineno-29-10"></a><a href="#__codelineno-29-10"><span class="linenos" data-linenos="10 "></span></a>
</span><span id="__span-29-11"><a id="__codelineno-29-11" name="__codelineno-29-11"></a><a href="#__codelineno-29-11"><span class="linenos" data-linenos="11 "></span></a><span class="w">    </span><span class="k">for</span><span class="p">(;;){</span>
</span><span id="__span-29-12"><a id="__codelineno-29-12" name="__codelineno-29-12"></a><a href="#__codelineno-29-12"><span class="linenos" data-linenos="12 "></span></a><span class="w">        </span><span class="n">getline</span><span class="p">(</span><span class="n">ifs</span><span class="p">,</span><span class="n">line</span><span class="p">);</span><span class="c1">//由于已经在结尾, getline会失败(ifs.fail()为true)</span>
</span><span id="__span-29-13"><a id="__codelineno-29-13" name="__codelineno-29-13"></a><a href="#__codelineno-29-13"><span class="linenos" data-linenos="13 "></span></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">line</span><span class="p">.</span><span class="n">empty</span><span class="p">()){</span><span class="c1">//或者!ifs.fail()</span>
</span><span id="__span-29-14"><a id="__codelineno-29-14" name="__codelineno-29-14"></a><a href="#__codelineno-29-14"><span class="linenos" data-linenos="14 "></span></a><span class="w">            </span><span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">&quot;newLine: &quot;</span><span class="o">&lt;&lt;</span><span class="n">line</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span><span class="w"> </span>
</span><span id="__span-29-15"><a id="__codelineno-29-15" name="__codelineno-29-15"></a><a href="#__codelineno-29-15"><span class="linenos" data-linenos="15 "></span></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-29-16"><a id="__codelineno-29-16" name="__codelineno-29-16"></a><a href="#__codelineno-29-16"><span class="linenos" data-linenos="16 "></span></a><span class="w">        </span><span class="n">ifs</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span><span class="c1">//恢复ifs的rdstate, 否则会一直处于fail状态</span>
</span><span id="__span-29-17"><a id="__codelineno-29-17" name="__codelineno-29-17"></a><a href="#__codelineno-29-17"><span class="linenos" data-linenos="17 "></span></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-29-18"><a id="__codelineno-29-18" name="__codelineno-29-18"></a><a href="#__codelineno-29-18"><span class="linenos" data-linenos="18 "></span></a><span class="p">}</span>
</span></code></pre></div>
<h2 id="streambuf">streambuf<a class="headerlink" href="#streambuf">&para;</a></h2>
<p><code>std::streambuf</code>是缓冲区的底层类,与具体设备进行交互,管理缓冲区. 其内部维护读写指针, 并实现了一组虚函数如<code>overflow()</code>, <code>underflow</code>等用来在缓冲区写满/读完时触发对设备的操作.</p>
<p><code>std::streambuf</code>作为基类, 而对于不同的读写设备(文件/字符串)有不同的派生类. 当需要对其它类型的输入输出设备进行操作时(例如直接输出到socket), 也可以自己实现一个继承<code>streambuf</code>的类.</p>
<p>我们可以通过改变<code>std::istream</code> / <code>std::ostream</code> / <code>std::iostream</code>等类内部的<code>stream_buf</code>来实现重定向.</p>
<h3 id="实现一个可切换输出设备终端文件的static输出流">实现一个可切换输出设备(终端/文件)的static输出流<a class="headerlink" href="#实现一个可切换输出设备终端文件的static输出流">&para;</a></h3>
<h4 id="stdiosrdbuf"><code>std::ios::rdbuf()</code><a class="headerlink" href="#stdiosrdbuf">&para;</a></h4>
<p>无参数时, 返回流的缓冲区指针
<div class="language-c++ highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1"></a><a href="#__codelineno-30-1"><span class="linenos" data-linenos="1 "></span></a><span class="c1">//返回当前cout绑定的streambuf(默认stdout)</span>
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2"></a><a href="#__codelineno-30-2"><span class="linenos" data-linenos="2 "></span></a><span class="n">std</span><span class="o">::</span><span class="n">streambuf</span><span class="o">*</span><span class="w"> </span><span class="n">consoleBuf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="p">.</span><span class="n">rdbuf</span><span class="p">()</span>
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3"></a><a href="#__codelineno-30-3"><span class="linenos" data-linenos="3 "></span></a>
</span><span id="__span-30-4"><a id="__codelineno-30-4" name="__codelineno-30-4"></a><a href="#__codelineno-30-4"><span class="linenos" data-linenos="4 "></span></a><span class="c1">//返回文件输出流绑定的streambuf</span>
</span><span id="__span-30-5"><a id="__codelineno-30-5" name="__codelineno-30-5"></a><a href="#__codelineno-30-5"><span class="linenos" data-linenos="5 "></span></a><span class="n">std</span><span class="o">::</span><span class="n">ofstream</span><span class="w"> </span><span class="n">ofs</span><span class="p">(</span><span class="s">&quot;out.txt&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ios</span><span class="o">::</span><span class="n">binary</span><span class="o">|</span><span class="n">ios</span><span class="o">::</span><span class="n">app</span><span class="p">);</span>
</span><span id="__span-30-6"><a id="__codelineno-30-6" name="__codelineno-30-6"></a><a href="#__codelineno-30-6"><span class="linenos" data-linenos="6 "></span></a><span class="n">std</span><span class="o">::</span><span class="n">streambuf</span><span class="o">*</span><span class="w"> </span><span class="n">fileBuf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="p">.</span><span class="n">rdbuf</span><span class="p">();</span>
</span></code></pre></div></p>
<p>以缓冲区指针作参数时, 替换某个流的缓冲区, 并清除rdstate的错误状态.
<div class="language-c++ highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1"></a><a href="#__codelineno-31-1"><span class="linenos" data-linenos="1 "></span></a><span class="c1">//将cout重定向至out.txt</span>
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2"></a><a href="#__codelineno-31-2"><span class="linenos" data-linenos="2 "></span></a><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="p">.</span><span class="n">rdbuf</span><span class="p">(</span><span class="n">fileBuf</span><span class="p">);</span><span class="w"> </span>
</span></code></pre></div></p>
<p>注意, <code>std::ios::set_rdbuf()</code>也是替换streambuf指针, 但它不会清除错误状态(<code>rdstate</code>). 同时它是<code>protected</code>, 所以只能在<code>ios</code>的派生类的成员函数里被调用.</p>
<h4 id="具体实现">具体实现<a class="headerlink" href="#具体实现">&para;</a></h4>
<ul>
<li>
<p>log.h
<div class="language-c++ highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1"></a><a href="#__codelineno-32-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="c1">// log.h</span>
</span><span id="__span-32-2"><a id="__codelineno-32-2" name="__codelineno-32-2"></a><a href="#__codelineno-32-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="cp">#pragma once</span>
</span><span id="__span-32-3"><a id="__codelineno-32-3" name="__codelineno-32-3"></a><a href="#__codelineno-32-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;ostream&gt;</span>
</span><span id="__span-32-4"><a id="__codelineno-32-4" name="__codelineno-32-4"></a><a href="#__codelineno-32-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string&gt;</span>
</span><span id="__span-32-5"><a id="__codelineno-32-5" name="__codelineno-32-5"></a><a href="#__codelineno-32-5"><span class="linenos" data-linenos=" 5 "></span></a>
</span><span id="__span-32-6"><a id="__codelineno-32-6" name="__codelineno-32-6"></a><a href="#__codelineno-32-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="c1">// 对外暴露的“日志流”</span>
</span><span id="__span-32-7"><a id="__codelineno-32-7" name="__codelineno-32-7"></a><a href="#__codelineno-32-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="k">extern</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="w"> </span><span class="n">log_stream</span><span class="p">;</span>
</span><span id="__span-32-8"><a id="__codelineno-32-8" name="__codelineno-32-8"></a><a href="#__codelineno-32-8"><span class="linenos" data-linenos=" 8 "></span></a>
</span><span id="__span-32-9"><a id="__codelineno-32-9" name="__codelineno-32-9"></a><a href="#__codelineno-32-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="c1">// 切换输出目标</span>
</span><span id="__span-32-10"><a id="__codelineno-32-10" name="__codelineno-32-10"></a><a href="#__codelineno-32-10"><span class="linenos" data-linenos="10 "></span></a><span class="kt">void</span><span class="w"> </span><span class="nf">set_log_to_console</span><span class="p">();</span>
</span><span id="__span-32-11"><a id="__codelineno-32-11" name="__codelineno-32-11"></a><a href="#__codelineno-32-11"><span class="linenos" data-linenos="11 "></span></a><span class="kt">bool</span><span class="w"> </span><span class="nf">set_log_to_file</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">filename</span><span class="p">);</span>
</span></code></pre></div></p>
</li>
<li>
<p>log.cpp
<div class="language-c++ highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1"></a><a href="#__codelineno-33-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="c1">// log.cpp</span>
</span><span id="__span-33-2"><a id="__codelineno-33-2" name="__codelineno-33-2"></a><a href="#__codelineno-33-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;log.h&quot;</span>
</span><span id="__span-33-3"><a id="__codelineno-33-3" name="__codelineno-33-3"></a><a href="#__codelineno-33-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
</span><span id="__span-33-4"><a id="__codelineno-33-4" name="__codelineno-33-4"></a><a href="#__codelineno-33-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;fstream&gt;</span>
</span><span id="__span-33-5"><a id="__codelineno-33-5" name="__codelineno-33-5"></a><a href="#__codelineno-33-5"><span class="linenos" data-linenos=" 5 "></span></a>
</span><span id="__span-33-6"><a id="__codelineno-33-6" name="__codelineno-33-6"></a><a href="#__codelineno-33-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="k">namespace</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-33-7"><a id="__codelineno-33-7" name="__codelineno-33-7"></a><a href="#__codelineno-33-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="w">    </span><span class="c1">// 真正打开文件的流，内部用</span>
</span><span id="__span-33-8"><a id="__codelineno-33-8" name="__codelineno-33-8"></a><a href="#__codelineno-33-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">ofstream</span><span class="w"> </span><span class="n">log_file</span><span class="p">;</span>
</span><span id="__span-33-9"><a id="__codelineno-33-9" name="__codelineno-33-9"></a><a href="#__codelineno-33-9"><span class="linenos" data-linenos=" 9 "></span></a>
</span><span id="__span-33-10"><a id="__codelineno-33-10" name="__codelineno-33-10"></a><a href="#__codelineno-33-10"><span class="linenos" data-linenos="10 "></span></a><span class="w">    </span><span class="c1">// 记住标准输出的 buffer，方便切回终端</span>
</span><span id="__span-33-11"><a id="__codelineno-33-11" name="__codelineno-33-11"></a><a href="#__codelineno-33-11"><span class="linenos" data-linenos="11 "></span></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">streambuf</span><span class="o">*</span><span class="w"> </span><span class="n">console_buf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
</span><span id="__span-33-12"><a id="__codelineno-33-12" name="__codelineno-33-12"></a><a href="#__codelineno-33-12"><span class="linenos" data-linenos="12 "></span></a><span class="p">}</span>
</span><span id="__span-33-13"><a id="__codelineno-33-13" name="__codelineno-33-13"></a><a href="#__codelineno-33-13"><span class="linenos" data-linenos="13 "></span></a>
</span><span id="__span-33-14"><a id="__codelineno-33-14" name="__codelineno-33-14"></a><a href="#__codelineno-33-14"><span class="linenos" data-linenos="14 "></span></a><span class="c1">// 注意：先不绑定任何 buffer，避免静态初始化顺序问题</span>
</span><span id="__span-33-15"><a id="__codelineno-33-15" name="__codelineno-33-15"></a><a href="#__codelineno-33-15"><span class="linenos" data-linenos="15 "></span></a><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="w"> </span><span class="n">log_stream</span><span class="p">(</span><span class="k">nullptr</span><span class="p">);</span>
</span><span id="__span-33-16"><a id="__codelineno-33-16" name="__codelineno-33-16"></a><a href="#__codelineno-33-16"><span class="linenos" data-linenos="16 "></span></a>
</span><span id="__span-33-17"><a id="__codelineno-33-17" name="__codelineno-33-17"></a><a href="#__codelineno-33-17"><span class="linenos" data-linenos="17 "></span></a><span class="kt">void</span><span class="w"> </span><span class="nf">set_log_to_console</span><span class="p">()</span>
</span><span id="__span-33-18"><a id="__codelineno-33-18" name="__codelineno-33-18"></a><a href="#__codelineno-33-18"><span class="linenos" data-linenos="18 "></span></a><span class="p">{</span>
</span><span id="__span-33-19"><a id="__codelineno-33-19" name="__codelineno-33-19"></a><a href="#__codelineno-33-19"><span class="linenos" data-linenos="19 "></span></a><span class="w">    </span><span class="c1">// 第一次调用时，把 cout 的 buffer 记下来</span>
</span><span id="__span-33-20"><a id="__codelineno-33-20" name="__codelineno-33-20"></a><a href="#__codelineno-33-20"><span class="linenos" data-linenos="20 "></span></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">console_buf</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-33-21"><a id="__codelineno-33-21" name="__codelineno-33-21"></a><a href="#__codelineno-33-21"><span class="linenos" data-linenos="21 "></span></a><span class="w">        </span><span class="n">console_buf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="p">.</span><span class="n">rdbuf</span><span class="p">();</span>
</span><span id="__span-33-22"><a id="__codelineno-33-22" name="__codelineno-33-22"></a><a href="#__codelineno-33-22"><span class="linenos" data-linenos="22 "></span></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-33-23"><a id="__codelineno-33-23" name="__codelineno-33-23"></a><a href="#__codelineno-33-23"><span class="linenos" data-linenos="23 "></span></a>
</span><span id="__span-33-24"><a id="__codelineno-33-24" name="__codelineno-33-24"></a><a href="#__codelineno-33-24"><span class="linenos" data-linenos="24 "></span></a><span class="w">    </span><span class="c1">// 让 log_stream 使用终端的 buffer</span>
</span><span id="__span-33-25"><a id="__codelineno-33-25" name="__codelineno-33-25"></a><a href="#__codelineno-33-25"><span class="linenos" data-linenos="25 "></span></a><span class="w">    </span><span class="n">log_stream</span><span class="p">.</span><span class="n">rdbuf</span><span class="p">(</span><span class="n">console_buf</span><span class="p">);</span>
</span><span id="__span-33-26"><a id="__codelineno-33-26" name="__codelineno-33-26"></a><a href="#__codelineno-33-26"><span class="linenos" data-linenos="26 "></span></a><span class="p">}</span>
</span><span id="__span-33-27"><a id="__codelineno-33-27" name="__codelineno-33-27"></a><a href="#__codelineno-33-27"><span class="linenos" data-linenos="27 "></span></a>
</span><span id="__span-33-28"><a id="__codelineno-33-28" name="__codelineno-33-28"></a><a href="#__codelineno-33-28"><span class="linenos" data-linenos="28 "></span></a><span class="kt">bool</span><span class="w"> </span><span class="nf">set_log_to_file</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">filename</span><span class="p">)</span>
</span><span id="__span-33-29"><a id="__codelineno-33-29" name="__codelineno-33-29"></a><a href="#__codelineno-33-29"><span class="linenos" data-linenos="29 "></span></a><span class="p">{</span>
</span><span id="__span-33-30"><a id="__codelineno-33-30" name="__codelineno-33-30"></a><a href="#__codelineno-33-30"><span class="linenos" data-linenos="30 "></span></a><span class="w">    </span><span class="c1">// 先关掉之前打开的文件（如果有）</span>
</span><span id="__span-33-31"><a id="__codelineno-33-31" name="__codelineno-33-31"></a><a href="#__codelineno-33-31"><span class="linenos" data-linenos="31 "></span></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">log_file</span><span class="p">.</span><span class="n">is_open</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-33-32"><a id="__codelineno-33-32" name="__codelineno-33-32"></a><a href="#__codelineno-33-32"><span class="linenos" data-linenos="32 "></span></a><span class="w">        </span><span class="n">log_file</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>
</span><span id="__span-33-33"><a id="__codelineno-33-33" name="__codelineno-33-33"></a><a href="#__codelineno-33-33"><span class="linenos" data-linenos="33 "></span></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-33-34"><a id="__codelineno-33-34" name="__codelineno-33-34"></a><a href="#__codelineno-33-34"><span class="linenos" data-linenos="34 "></span></a><span class="w">    </span><span class="n">log_file</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span><span class="w"> </span><span class="c1">// 清理错误状态</span>
</span><span id="__span-33-35"><a id="__codelineno-33-35" name="__codelineno-33-35"></a><a href="#__codelineno-33-35"><span class="linenos" data-linenos="35 "></span></a>
</span><span id="__span-33-36"><a id="__codelineno-33-36" name="__codelineno-33-36"></a><a href="#__codelineno-33-36"><span class="linenos" data-linenos="36 "></span></a><span class="w">    </span><span class="c1">// 以追加方式打开文件</span>
</span><span id="__span-33-37"><a id="__codelineno-33-37" name="__codelineno-33-37"></a><a href="#__codelineno-33-37"><span class="linenos" data-linenos="37 "></span></a><span class="w">    </span><span class="n">log_file</span><span class="p">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">ios</span><span class="o">::</span><span class="n">out</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">ios</span><span class="o">::</span><span class="n">app</span><span class="p">);</span>
</span><span id="__span-33-38"><a id="__codelineno-33-38" name="__codelineno-33-38"></a><a href="#__codelineno-33-38"><span class="linenos" data-linenos="38 "></span></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">log_file</span><span class="p">.</span><span class="n">is_open</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-33-39"><a id="__codelineno-33-39" name="__codelineno-33-39"></a><a href="#__codelineno-33-39"><span class="linenos" data-linenos="39 "></span></a><span class="w">        </span><span class="c1">// 打开失败就返回 false，不修改当前 log_stream 的目标</span>
</span><span id="__span-33-40"><a id="__codelineno-33-40" name="__codelineno-33-40"></a><a href="#__codelineno-33-40"><span class="linenos" data-linenos="40 "></span></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
</span><span id="__span-33-41"><a id="__codelineno-33-41" name="__codelineno-33-41"></a><a href="#__codelineno-33-41"><span class="linenos" data-linenos="41 "></span></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-33-42"><a id="__codelineno-33-42" name="__codelineno-33-42"></a><a href="#__codelineno-33-42"><span class="linenos" data-linenos="42 "></span></a>
</span><span id="__span-33-43"><a id="__codelineno-33-43" name="__codelineno-33-43"></a><a href="#__codelineno-33-43"><span class="linenos" data-linenos="43 "></span></a><span class="w">    </span><span class="c1">// 让 log_stream 使用文件的 buffer</span>
</span><span id="__span-33-44"><a id="__codelineno-33-44" name="__codelineno-33-44"></a><a href="#__codelineno-33-44"><span class="linenos" data-linenos="44 "></span></a><span class="w">    </span><span class="n">log_stream</span><span class="p">.</span><span class="n">rdbuf</span><span class="p">(</span><span class="n">log_file</span><span class="p">.</span><span class="n">rdbuf</span><span class="p">());</span>
</span><span id="__span-33-45"><a id="__codelineno-33-45" name="__codelineno-33-45"></a><a href="#__codelineno-33-45"><span class="linenos" data-linenos="45 "></span></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
</span><span id="__span-33-46"><a id="__codelineno-33-46" name="__codelineno-33-46"></a><a href="#__codelineno-33-46"><span class="linenos" data-linenos="46 "></span></a><span class="p">}</span>
</span></code></pre></div></p>
</li>
<li>
<p>main.cpp
<div class="language-c++ highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1"></a><a href="#__codelineno-34-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="c1">// main.cpp</span>
</span><span id="__span-34-2"><a id="__codelineno-34-2" name="__codelineno-34-2"></a><a href="#__codelineno-34-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;log.h&quot;</span>
</span><span id="__span-34-3"><a id="__codelineno-34-3" name="__codelineno-34-3"></a><a href="#__codelineno-34-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
</span><span id="__span-34-4"><a id="__codelineno-34-4" name="__codelineno-34-4"></a><a href="#__codelineno-34-4"><span class="linenos" data-linenos=" 4 "></span></a>
</span><span id="__span-34-5"><a id="__codelineno-34-5" name="__codelineno-34-5"></a><a href="#__codelineno-34-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
</span><span id="__span-34-6"><a id="__codelineno-34-6" name="__codelineno-34-6"></a><a href="#__codelineno-34-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="p">{</span>
</span><span id="__span-34-7"><a id="__codelineno-34-7" name="__codelineno-34-7"></a><a href="#__codelineno-34-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="w">    </span><span class="c1">// 程序开始时先选择一个默认输出目标</span>
</span><span id="__span-34-8"><a id="__codelineno-34-8" name="__codelineno-34-8"></a><a href="#__codelineno-34-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="w">    </span><span class="n">set_log_to_console</span><span class="p">();</span>
</span><span id="__span-34-9"><a id="__codelineno-34-9" name="__codelineno-34-9"></a><a href="#__codelineno-34-9"><span class="linenos" data-linenos=" 9 "></span></a>
</span><span id="__span-34-10"><a id="__codelineno-34-10" name="__codelineno-34-10"></a><a href="#__codelineno-34-10"><span class="linenos" data-linenos="10 "></span></a><span class="w">    </span><span class="n">log_stream</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;程序启动...</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span id="__span-34-11"><a id="__codelineno-34-11" name="__codelineno-34-11"></a><a href="#__codelineno-34-11"><span class="linenos" data-linenos="11 "></span></a>
</span><span id="__span-34-12"><a id="__codelineno-34-12" name="__codelineno-34-12"></a><a href="#__codelineno-34-12"><span class="linenos" data-linenos="12 "></span></a><span class="w">    </span><span class="c1">// 某个地方根据配置/参数切换到文件</span>
</span><span id="__span-34-13"><a id="__codelineno-34-13" name="__codelineno-34-13"></a><a href="#__codelineno-34-13"><span class="linenos" data-linenos="13 "></span></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">set_log_to_file</span><span class="p">(</span><span class="s">&quot;app.log&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-14"><a id="__codelineno-34-14" name="__codelineno-34-14"></a><a href="#__codelineno-34-14"><span class="linenos" data-linenos="14 "></span></a><span class="w">        </span><span class="n">log_stream</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;现在开始把日志写到 app.log</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span id="__span-34-15"><a id="__codelineno-34-15" name="__codelineno-34-15"></a><a href="#__codelineno-34-15"><span class="linenos" data-linenos="15 "></span></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-16"><a id="__codelineno-34-16" name="__codelineno-34-16"></a><a href="#__codelineno-34-16"><span class="linenos" data-linenos="16 "></span></a><span class="w">        </span><span class="n">log_stream</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;无法打开 app.log，继续输出到终端</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span id="__span-34-17"><a id="__codelineno-34-17" name="__codelineno-34-17"></a><a href="#__codelineno-34-17"><span class="linenos" data-linenos="17 "></span></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-34-18"><a id="__codelineno-34-18" name="__codelineno-34-18"></a><a href="#__codelineno-34-18"><span class="linenos" data-linenos="18 "></span></a>
</span><span id="__span-34-19"><a id="__codelineno-34-19" name="__codelineno-34-19"></a><a href="#__codelineno-34-19"><span class="linenos" data-linenos="19 "></span></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-20"><a id="__codelineno-34-20" name="__codelineno-34-20"></a><a href="#__codelineno-34-20"><span class="linenos" data-linenos="20 "></span></a><span class="w">        </span><span class="n">log_stream</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;一条日志：&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">&#39;\n&#39;</span><span class="p">;</span>
</span><span id="__span-34-21"><a id="__codelineno-34-21" name="__codelineno-34-21"></a><a href="#__codelineno-34-21"><span class="linenos" data-linenos="21 "></span></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-34-22"><a id="__codelineno-34-22" name="__codelineno-34-22"></a><a href="#__codelineno-34-22"><span class="linenos" data-linenos="22 "></span></a>
</span><span id="__span-34-23"><a id="__codelineno-34-23" name="__codelineno-34-23"></a><a href="#__codelineno-34-23"><span class="linenos" data-linenos="23 "></span></a><span class="w">    </span><span class="c1">// 随时可以再切回终端</span>
</span><span id="__span-34-24"><a id="__codelineno-34-24" name="__codelineno-34-24"></a><a href="#__codelineno-34-24"><span class="linenos" data-linenos="24 "></span></a><span class="w">    </span><span class="n">set_log_to_console</span><span class="p">();</span>
</span><span id="__span-34-25"><a id="__codelineno-34-25" name="__codelineno-34-25"></a><a href="#__codelineno-34-25"><span class="linenos" data-linenos="25 "></span></a><span class="w">    </span><span class="n">log_stream</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;结束，回到终端输出</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span id="__span-34-26"><a id="__codelineno-34-26" name="__codelineno-34-26"></a><a href="#__codelineno-34-26"><span class="linenos" data-linenos="26 "></span></a>
</span><span id="__span-34-27"><a id="__codelineno-34-27" name="__codelineno-34-27"></a><a href="#__codelineno-34-27"><span class="linenos" data-linenos="27 "></span></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-34-28"><a id="__codelineno-34-28" name="__codelineno-34-28"></a><a href="#__codelineno-34-28"><span class="linenos" data-linenos="28 "></span></a><span class="p">}</span>
</span></code></pre></div></p>
</li>
</ul>
<p>注意:</p>
<ol>
<li>
<p>log.cpp中定义log_stream时直接写<code>std::ostream log_stream(cout.rdbuf())</code>可能有静态初始化顺序问题(详见<strong>面向对象-类成员变量的初始化</strong>). 静态初始化顺序问题是指不同编译单元间的静态初始化顺序是不明确的. </p>
<p>当存在跨编译单元的依赖(<code>extern</code>)时, 就有可能出现用还没初始化的全局对象去初始化另一个全局对象. </p>
<p>本例子中, <code>std::cout</code>这一对象是在iostream所引入的另外的编译单元中初始化的, 而<code>log_stream</code>是在<code>log.cpp</code>中初始化的. 两者的初始化在不同编译单元, 应避免顺序依赖. 所以写<code>std::ostream log_stream(nullptr)</code>.</p>
</li>
<li>
<p>log.cpp中的匿名命名空间<code>namespace {...}</code>作用在此处等同于<code>static</code>, 即限制全局变量仅该编译单元可见. 只是使用匿名命名空间可以对变量/函数/结构体/类/枚举类/using等使用, 且可以直接作用于一大段代码, 而static只能用于变量和函数且需要挨个标注.</p>
</li>
</ol>


<!-- Comment system -->
<!-- 对所有非主页页面启用comment-->
 
    <h2 id="__comments">评论</h2>
    <!-- Insert generated snippet here -->
    <script src="https://giscus.app/client.js"
        data-repo="ScottCheung930/Scott930Website"
        data-repo-id="R_kgDON95dXw"
        data-category="Announcements"
        data-category-id="DIC_kwDON95dX84CnPj9"
        data-mapping="url"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="bottom"
        data-theme="preferred_color_scheme"
        data-lang="zh-CN"
        crossorigin="anonymous" async>
    </script>

    <!-- Synchronize Giscus theme with palette -->
    <script>
        var giscus = document.querySelector("script[src*=giscus]")

        // Set palette on initial load
        var palette = __md_get("__palette")
        if (palette && typeof palette.color === "object") {
            var theme = palette.color.scheme === "slate"
                ? "transparent_dark"
                : "light"

            // Instruct Giscus to set theme
            giscus.setAttribute("data-theme", theme)
        }

        // Register event handlers after documented loaded
        document.addEventListener("DOMContentLoaded", function () {
            var ref = document.querySelector("[data-md-component=palette]")
            ref.addEventListener("change", function () {
                var palette = __md_get("__palette")
                if (palette && typeof palette.color === "object") {
                    var theme = palette.color.scheme === "slate"
                        ? "transparent_dark"
                        : "light"

                    // Instruct Giscus to change theme
                    var frame = document.querySelector(".giscus-frame")
                    frame.contentWindow.postMessage(
                        { giscus: { setConfig: { theme } } },
                        "https://giscus.app"
                    )
                }
            })
        })
    </script>

                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2025 ScottCheung930
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.tabs.prune", "navigation.expand", "navigation.path", "navigation.indexes", "content.code.annotate", "content.action.edit", "content.action.view", "content.code.copy", "content.tooltips"], "search": "../../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="../../../javascripts/extra.js"></script>
      
        <script src="../../../javascripts/katex.js"></script>
      
        <script src="https://unpkg.com/katex@0/dist/katex.min.js"></script>
      
        <script src="https://unpkg.com/katex@0/dist/contrib/auto-render.min.js"></script>
      
        <script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
      
    
  </body>
</html>