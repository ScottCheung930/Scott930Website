
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="ScottCheung930's personal website.">
      
      
        <meta name="author" content="scotcheung930">
      
      
        <link rel="canonical" href="https://scottcheung930.github.io/Scott930Website/coding/cpp/7_oop/">
      
      
        <link rel="prev" href="../6_compile_and_multifile/">
      
      
        <link rel="next" href="../8_cpp_heap_memory/">
      
      
        
      
      
      <link rel="icon" href="../../../assets/images/logo.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>面向对象 - Scott930</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      

  
  
  
  
  <style>:root{--md-annotation-icon:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2024%2024%22%3E%3Cpath%20d%3D%22M17%2013h-4v4h-2v-4H7v-2h4V7h2v4h4m-5-9A10%2010%200%200%200%202%2012a10%2010%200%200%200%2010%2010%2010%2010%200%200%200%2010-10A10%2010%200%200%200%2012%202%22/%3E%3C/svg%3E');}</style>


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../stylesheets/extra.css">
    
      <link rel="stylesheet" href="https://unpkg.com/katex@0/dist/katex.min.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#面向对象" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../../.." title="Scott930" class="md-header__button md-logo" aria-label="Scott930" data-md-component="logo">
      
  <img src="../../../assets/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Scott930
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              面向对象
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/ScottCheung930/Scott930Website" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    ScottCheung930/Scott930Website
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
  
    
  
  首页

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../communication/" class="md-tabs__link">
          
  
  
    
  
  通信

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../" class="md-tabs__link">
          
  
  
    
  
  代码

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../notes/" class="md-tabs__link">
          
  
  
    
  
  杂记

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Scott930" class="md-nav__button md-logo" aria-label="Scott930" data-md-component="logo">
      
  <img src="../../../assets/logo.png" alt="logo">

    </a>
    Scott930
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/ScottCheung930/Scott930Website" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    ScottCheung930/Scott930Website
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    首页
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../communication/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    通信
  

    
  </span>
  
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    通信
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    代码
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    代码
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../c/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    c
  

    
  </span>
  
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    c
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    c++
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    c++
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../1_types/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    C++的类型
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2_io/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    输入输出
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../3_container/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    容器
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../4_memory_and_lifetime/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    存储区, 作用域与生命周期(存储期)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../5_functions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    函数
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../6_compile_and_multifile/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    项目编译流程
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    面向对象
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    面向对象
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#一些规则" class="md-nav__link">
    <span class="md-ellipsis">
      
        一些规则
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#const作用于对象-成员函数和成员变量" class="md-nav__link">
    <span class="md-ellipsis">
      
        const作用于对象, 成员函数和成员变量
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="const作用于对象, 成员函数和成员变量">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#常量const对象" class="md-nav__link">
    <span class="md-ellipsis">
      
        常量const对象
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#静态成员变量和静态成员函数" class="md-nav__link">
    <span class="md-ellipsis">
      
        静态成员变量和静态成员函数
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="静态成员变量和静态成员函数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#静态成员变量" class="md-nav__link">
    <span class="md-ellipsis">
      
        静态成员变量
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#静态成员函数" class="md-nav__link">
    <span class="md-ellipsis">
      
        静态成员函数
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="静态成员函数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#静态成员函数的应用" class="md-nav__link">
    <span class="md-ellipsis">
      
        静态成员函数的应用
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#构造函数和初始化" class="md-nav__link">
    <span class="md-ellipsis">
      
        构造函数和初始化
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="构造函数和初始化">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#类成员变量的初始化方式" class="md-nav__link">
    <span class="md-ellipsis">
      
        类成员变量的初始化方式
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#和去初始化对象" class="md-nav__link">
    <span class="md-ellipsis">
      
        ()和{}去初始化对象
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#转换构造函数与explict" class="md-nav__link">
    <span class="md-ellipsis">
      
        转换构造函数与explict
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#委托构造函数" class="md-nav__link">
    <span class="md-ellipsis">
      
        委托构造函数
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#继承-is-a" class="md-nav__link">
    <span class="md-ellipsis">
      
        继承 (is a)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="继承 (is a)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#继承中的访问权限" class="md-nav__link">
    <span class="md-ellipsis">
      
        继承中的访问权限
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#派生类的构造" class="md-nav__link">
    <span class="md-ellipsis">
      
        派生类的构造
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#继承中同名的成员变量和函数" class="md-nav__link">
    <span class="md-ellipsis">
      
        继承中同名的成员变量和函数
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#多态公有继承" class="md-nav__link">
    <span class="md-ellipsis">
      
        多态公有继承
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="多态公有继承">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#虚方法" class="md-nav__link">
    <span class="md-ellipsis">
      
        虚方法
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="虚方法">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#静态绑定和动态绑定" class="md-nav__link">
    <span class="md-ellipsis">
      
        静态绑定和动态绑定
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#继承类型的指针和引用类型的向上强制转换upcasting" class="md-nav__link">
    <span class="md-ellipsis">
      
        继承类型的指针和引用类型的向上强制转换(upcasting)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#虚方法实现多态" class="md-nav__link">
    <span class="md-ellipsis">
      
        虚方法实现多态
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#纯虚函数和抽象类" class="md-nav__link">
    <span class="md-ellipsis">
      
        纯虚函数和抽象类
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#常见坑-析构函数在绝大部分情况应设置为虚函数" class="md-nav__link">
    <span class="md-ellipsis">
      
        常见坑: 析构函数在绝大部分情况应设置为虚函数
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="##设计模式组合" class="md-nav__link">
    <span class="md-ellipsis">
      
        设计模式: 组合 (has a)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="设计模式: 组合 (has a)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#设计模式-工厂类" class="md-nav__link">
    <span class="md-ellipsis">
      
        设计模式: 工厂类
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#组合的另一种实现-委托" class="md-nav__link">
    <span class="md-ellipsis">
      
        组合的另一种实现: 委托
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#使用继承组合委托实现日志类" class="md-nav__link">
    <span class="md-ellipsis">
      
        使用继承、组合/委托实现日志类
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../8_cpp_heap_memory/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    C++的堆内存管理特性
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../macro/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    宏
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../notes/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    杂记
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    杂记
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../notes/masterThesis/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    毕设
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    毕设
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/masterThesis/2025-02-02/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2025年2月2日, w5
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/masterThesis/2025-02-07/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2025年2月7日, w6
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/masterThesis/2025-02-23/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2025年2月23日, w8
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/masterThesis/2025-03-09/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2025年3月9日, w10
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/masterThesis/2025-03-30/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2025年3月30日, w13
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/masterThesis/2025-04-06/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2025年4月6日, w14
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_3" >
        
          
          <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    讲座：5G and Beyond
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    讲座：5G and Beyond
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/lecture/note_CellularSystems-5GandBeyond/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Cellular systems - 5G and beyond Part 1
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/lecture/note_CellularSystems-5GandBeyond_part2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Cellular systems - 5G and beyond Part 2
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../notes/qqBot/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    QQ机器人
  

    
  </span>
  
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    QQ机器人
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_5" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../notes/smtpServer/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    邮件服务器与服务器VPN配置
  

    
  </span>
  
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    邮件服务器与服务器VPN配置
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#一些规则" class="md-nav__link">
    <span class="md-ellipsis">
      
        一些规则
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#const作用于对象-成员函数和成员变量" class="md-nav__link">
    <span class="md-ellipsis">
      
        const作用于对象, 成员函数和成员变量
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="const作用于对象, 成员函数和成员变量">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#常量const对象" class="md-nav__link">
    <span class="md-ellipsis">
      
        常量const对象
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#静态成员变量和静态成员函数" class="md-nav__link">
    <span class="md-ellipsis">
      
        静态成员变量和静态成员函数
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="静态成员变量和静态成员函数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#静态成员变量" class="md-nav__link">
    <span class="md-ellipsis">
      
        静态成员变量
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#静态成员函数" class="md-nav__link">
    <span class="md-ellipsis">
      
        静态成员函数
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="静态成员函数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#静态成员函数的应用" class="md-nav__link">
    <span class="md-ellipsis">
      
        静态成员函数的应用
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#构造函数和初始化" class="md-nav__link">
    <span class="md-ellipsis">
      
        构造函数和初始化
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="构造函数和初始化">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#类成员变量的初始化方式" class="md-nav__link">
    <span class="md-ellipsis">
      
        类成员变量的初始化方式
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#和去初始化对象" class="md-nav__link">
    <span class="md-ellipsis">
      
        ()和{}去初始化对象
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#转换构造函数与explict" class="md-nav__link">
    <span class="md-ellipsis">
      
        转换构造函数与explict
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#委托构造函数" class="md-nav__link">
    <span class="md-ellipsis">
      
        委托构造函数
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#继承-is-a" class="md-nav__link">
    <span class="md-ellipsis">
      
        继承 (is a)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="继承 (is a)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#继承中的访问权限" class="md-nav__link">
    <span class="md-ellipsis">
      
        继承中的访问权限
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#派生类的构造" class="md-nav__link">
    <span class="md-ellipsis">
      
        派生类的构造
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#继承中同名的成员变量和函数" class="md-nav__link">
    <span class="md-ellipsis">
      
        继承中同名的成员变量和函数
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#多态公有继承" class="md-nav__link">
    <span class="md-ellipsis">
      
        多态公有继承
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="多态公有继承">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#虚方法" class="md-nav__link">
    <span class="md-ellipsis">
      
        虚方法
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="虚方法">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#静态绑定和动态绑定" class="md-nav__link">
    <span class="md-ellipsis">
      
        静态绑定和动态绑定
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#继承类型的指针和引用类型的向上强制转换upcasting" class="md-nav__link">
    <span class="md-ellipsis">
      
        继承类型的指针和引用类型的向上强制转换(upcasting)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#虚方法实现多态" class="md-nav__link">
    <span class="md-ellipsis">
      
        虚方法实现多态
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#纯虚函数和抽象类" class="md-nav__link">
    <span class="md-ellipsis">
      
        纯虚函数和抽象类
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#常见坑-析构函数在绝大部分情况应设置为虚函数" class="md-nav__link">
    <span class="md-ellipsis">
      
        常见坑: 析构函数在绝大部分情况应设置为虚函数
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="##设计模式组合" class="md-nav__link">
    <span class="md-ellipsis">
      
        设计模式: 组合 (has a)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="设计模式: 组合 (has a)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#设计模式-工厂类" class="md-nav__link">
    <span class="md-ellipsis">
      
        设计模式: 工厂类
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#组合的另一种实现-委托" class="md-nav__link">
    <span class="md-ellipsis">
      
        组合的另一种实现: 委托
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#使用继承组合委托实现日志类" class="md-nav__link">
    <span class="md-ellipsis">
      
        使用继承、组合/委托实现日志类
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
                



  


  <nav class="md-path" aria-label="导航栏" >
    <ol class="md-path__list">
      
        
  
  
    <li class="md-path__item">
      <a href="../../.." class="md-path__link">
        
  <span class="md-ellipsis">
    首页
  </span>

      </a>
    </li>
  

      
      
        
  
  
    
    
      <li class="md-path__item">
        <a href="../../" class="md-path__link">
          
  <span class="md-ellipsis">
    代码
  </span>

        </a>
      </li>
    
  

      
        
  
  
    
    
      <li class="md-path__item">
        <a href="../" class="md-path__link">
          
  <span class="md-ellipsis">
    c++
  </span>

        </a>
      </li>
    
  

      
    </ol>
  </nav>

              
              <article class="md-content__inner md-typeset">
                
                  <!--
  Copyright (c) 2016-2024 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Tags -->



<!--
  Hack: check whether the content contains a h1 headline. If it doesn't, the
  page title (or respectively site name) is used as the main headline.
-->


<!-- Page content -->
<h1 id="面向对象">面向对象<a class="headerlink" href="#面向对象">&para;</a></h1>
<div style="margin-top: -30px; font-size: 0.75em; opacity: 0.7;">
<p><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12a10 10 0 0 0 10 10 10 10 0 0 0 10-10h-2a8 8 0 0 1-8 8 8 8 0 0 1-8-8 8 8 0 0 1 8-8zm6.78 1a.7.7 0 0 0-.48.2l-1.22 1.21 2.5 2.5L20.8 5.7c.26-.26.26-.7 0-.95L19.25 3.2c-.13-.13-.3-.2-.47-.2m-2.41 2.12L9 12.5V15h2.5l7.37-7.38z"/></svg></span> 约 5413 个字 <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M360.8 1.2c-17-4.9-34.7 5-39.6 22l-128 448c-4.9 17 5 34.7 22 39.6s34.7-5 39.6-22l128-448c4.9-17-5-34.7-22-39.6m64.6 136.1c-12.5 12.5-12.5 32.8 0 45.3l73.4 73.4-73.4 73.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0l96-96c12.5-12.5 12.5-32.8 0-45.3l-96-96c-12.5-12.5-32.8-12.5-45.3 0zm-274.7 0c-12.5-12.5-32.8-12.5-45.3 0l-96 96c-12.5 12.5-12.5 32.8 0 45.3l96 96c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L77.3 256l73.3-73.4c12.5-12.5 12.5-32.8 0-45.3z"/></svg></span> 477 行代码 <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 17H7V3h14m0-2H7a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2M3 5H1v16a2 2 0 0 0 2 2h16v-2H3m12.96-10.71-2.75 3.54-1.96-2.36L8.5 15h11z"/></svg></span> 2 张图片 <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 20c4.42 0 8-3.58 8-8s-3.58-8-8-8-8 3.58-8 8 3.58 8 8 8m0-18c5.5 0 10 4.5 10 10s-4.5 10-10 10C6.47 22 2 17.5 2 12S6.5 2 12 2m.5 11H11V7h1.5v4.26l3.7-2.13.75 1.3z"/></svg></span> 预计阅读时间 24 分钟</p>
</div>
<h2 id="一些规则">一些规则<a class="headerlink" href="#一些规则">&para;</a></h2>
<p>类与类之间的关系有三种: 继承(inheritance), 组合(composition), 委托(delegation).</p>
<ul>
<li>永远不要把成员变量放到public</li>
<li>给成员变量加前缀或后缀下划线, 以示与全局变量的区分.</li>
<li>对对象取地址就是对象的this指针.</li>
<li>对象本身(空对象)占&gt;=1字节的内存(绝大多数实现为==1字节), 因为即便是两个空对象也需要有不同的地址. 但有时候内存对齐(例如4字节对齐)会放大空对象的大小.</li>
</ul>
<h2 id="const作用于对象-成员函数和成员变量">const作用于对象, 成员函数和成员变量<a class="headerlink" href="#const作用于对象-成员函数和成员变量">&para;</a></h2>
<ul>
<li>
<p>当const作用于一个对象
    obj 的类型是 const T，意味着: </p>
<ul>
<li>不能通过 obj 修改其非 mutable 的子对象（非静态数据成员等）; </li>
<li>只能调用 T 的 const 成员函数（以及 const/const volatile 更严格版本）; </li>
<li>不能把 obj 绑定到 T&amp;（非常量左值引用），但可绑定到 const T&amp;。</li>
</ul>
</li>
<li>
<p>当const作用于成员函数声明
    成员函数的 cv 限定会改变 this 的类型，从而限制函数体内对对象的修改能力，并参与重载决议.
    从语义上, 一个const成员函数声明该函数不会修改调用对象本身.
    对类 X 的非静态成员函数：</p>
<ul>
<li>void f(); 中：this 的类型是 X* const</li>
<li>void f() const; 中：this 的类型是 const X* const</li>
</ul>
<p>注意这里有两层const, 指针本身是 const（不能在成员函数里给 this 重新赋值）。const 出现在 *this 的指向类型上时，才意味着“不能修改对象状态”（除 mutable 之外）</p>
<p>const 成员函数内：不能修改非 mutable 的非静态数据成员。只能调用同样满足 const 约束的成员函数(即 g() const )</p>
</li>
<li>
<p>当const作用于成员变量声明
    例：struct X { const int a; };</p>
<p>每个 X 对象里都有一个 a，其值在构造完成后不可再赋值。必须在构造函数成员初始化列表或类内初始化器中初始化。
含 const 非静态成员的类型，拷贝/移动赋值运算符往往会被隐式删除，因为无法给 const 成员再赋值。</p>
</li>
</ul>
<h3 id="常量const对象">常量const对象<a class="headerlink" href="#常量const对象">&para;</a></h3>
<p>常量对象只能调用const成员函数, 非const成员函数被视为可能修改对象状态.
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1"></a><a href="#__codelineno-0-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="k">class</span><span class="w"> </span><span class="nc">A</span><span class="p">{</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2"></a><a href="#__codelineno-0-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="k">private</span><span class="o">:</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3"></a><a href="#__codelineno-0-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">val</span><span class="p">;</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4"></a><a href="#__codelineno-0-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="k">public</span><span class="o">:</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5"></a><a href="#__codelineno-0-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">GetVal</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="k">return</span><span class="w"> </span><span class="n">val</span><span class="p">};</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6"></a><a href="#__codelineno-0-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="p">};</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7"></a><a href="#__codelineno-0-7"><span class="linenos" data-linenos=" 7 "></span></a>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8"></a><a href="#__codelineno-0-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9"></a><a href="#__codelineno-0-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="p">{</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10"></a><a href="#__codelineno-0-10"><span class="linenos" data-linenos="10 "></span></a><span class="w">    </span><span class="n">A</span><span class="w"> </span><span class="n">a</span><span class="p">{</span><span class="mi">1</span><span class="p">};</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11"></a><a href="#__codelineno-0-11"><span class="linenos" data-linenos="11 "></span></a><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="n">aa</span><span class="p">{</span><span class="mi">2</span><span class="p">};</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12"></a><a href="#__codelineno-0-12"><span class="linenos" data-linenos="12 "></span></a>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13"></a><a href="#__codelineno-0-13"><span class="linenos" data-linenos="13 "></span></a><span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">GetVal</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14"></a><a href="#__codelineno-0-14"><span class="linenos" data-linenos="14 "></span></a>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15"></a><a href="#__codelineno-0-15"><span class="linenos" data-linenos="15 "></span></a><span class="w">    </span><span class="c1">//cout &lt;&lt; aa.GetVal() &lt;&lt;endl; </span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16"></a><a href="#__codelineno-0-16"><span class="linenos" data-linenos="16 "></span></a><span class="w">    </span><span class="c1">//error: passing &#39;const A&#39; as &#39;this&#39; argument discards qualifiers [-fpermissive]</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17"></a><a href="#__codelineno-0-17"><span class="linenos" data-linenos="17 "></span></a><span class="p">}</span>
</span></code></pre></div>
因此在可能用到常量对象时, 需要注意也实现const成员函数.</p>
<p>在有对象的组合时, 需要注意维护const语义的传递, 即一个常量对象的内部对象, 我们也不希望其能被修改, 见后文<a href="##设计模式组合">组合</a></p>
<h2 id="静态成员变量和静态成员函数">静态成员变量和静态成员函数<a class="headerlink" href="#静态成员变量和静态成员函数">&para;</a></h2>
<h3 id="静态成员变量">静态成员变量<a class="headerlink" href="#静态成员变量">&para;</a></h3>
<p>静态成员变量与类绑定而非对象. 例如统计某个类的有多少个对象的counter, 某个类为新对象分配的自增ID, 某个类所有对象适用的常量, 某一类所有对象的共享资源(缓存, 线程池等)</p>
<ul>
<li>
<p>类内仅声明, 需要在类外定义
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1"></a><a href="#__codelineno-1-1"><span class="linenos" data-linenos="1 "></span></a><span class="c1">///a.h</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2"></a><a href="#__codelineno-1-2"><span class="linenos" data-linenos="2 "></span></a><span class="k">class</span><span class="w"> </span><span class="nc">A</span><span class="p">{</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3"></a><a href="#__codelineno-1-3"><span class="linenos" data-linenos="3 "></span></a><span class="k">private</span><span class="o">:</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4"></a><a href="#__codelineno-1-4"><span class="linenos" data-linenos="4 "></span></a><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">val</span><span class="p">;</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5"></a><a href="#__codelineno-1-5"><span class="linenos" data-linenos="5 "></span></a><span class="p">}</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6"></a><a href="#__codelineno-1-6"><span class="linenos" data-linenos="6 "></span></a>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7"></a><a href="#__codelineno-1-7"><span class="linenos" data-linenos="7 "></span></a><span class="c1">///a.cpp</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8"></a><a href="#__codelineno-1-8"><span class="linenos" data-linenos="8 "></span></a><span class="kt">int</span><span class="w"> </span><span class="n">A</span><span class="o">::</span><span class="n">val</span><span class="p">;</span><span class="w"> </span>
</span></code></pre></div></p>
</li>
<li>
<p>非常量的static成员变量不能在类内初始化, 需要在类外初始化</p>
</li>
</ul>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1"></a><a href="#__codelineno-2-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="c1">///a.h</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2"></a><a href="#__codelineno-2-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="k">class</span><span class="w"> </span><span class="nc">A</span><span class="p">{</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3"></a><a href="#__codelineno-2-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="k">private</span><span class="o">:</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4"></a><a href="#__codelineno-2-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">val1</span><span class="p">;</span><span class="c1">//static int 不可类内初始化</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5"></a><a href="#__codelineno-2-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">val2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6"></a><a href="#__codelineno-2-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="c1">//N是编译时常量, 可以这样写;</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7"></a><a href="#__codelineno-2-7"><span class="linenos" data-linenos=" 7 "></span></a>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8"></a><a href="#__codelineno-2-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="p">}</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9"></a><a href="#__codelineno-2-9"><span class="linenos" data-linenos=" 9 "></span></a>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10"></a><a href="#__codelineno-2-10"><span class="linenos" data-linenos="10 "></span></a><span class="c1">///a.cpp</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11"></a><a href="#__codelineno-2-11"><span class="linenos" data-linenos="11 "></span></a><span class="kt">int</span><span class="w"> </span><span class="n">A</span><span class="o">::</span><span class="n">val1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span>
</span></code></pre></div>
<ul>
<li>特殊: <code>static const</code> 可以在类内初始化;</li>
</ul>
<p>若它只当作编译时常量表达式(定义数组大小, 用作模板非类型参数, switch-case的case), 则不用在类外另加定义; 否则仍应当在类外进行定义.</p>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1"></a><a href="#__codelineno-3-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="c1">///a.j</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2"></a><a href="#__codelineno-3-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="k">class</span><span class="w"> </span><span class="nc">A</span><span class="p">{</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3"></a><a href="#__codelineno-3-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="k">private</span><span class="o">:</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4"></a><a href="#__codelineno-3-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="c1">//N是编译时常量, 不必在类外定义</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5"></a><a href="#__codelineno-3-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">M</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span><span class="c1">//M是需要内存的变量, 需要在类外定义.</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6"></a><a href="#__codelineno-3-6"><span class="linenos" data-linenos=" 6 "></span></a>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7"></a><a href="#__codelineno-3-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="p">}</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8"></a><a href="#__codelineno-3-8"><span class="linenos" data-linenos=" 8 "></span></a>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9"></a><a href="#__codelineno-3-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="c1">///a.cpp</span>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10"></a><a href="#__codelineno-3-10"><span class="linenos" data-linenos="10 "></span></a><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">A</span><span class="o">::</span><span class="n">M</span><span class="p">;</span><span class="c1">//不用写static了</span>
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11"></a><a href="#__codelineno-3-11"><span class="linenos" data-linenos="11 "></span></a>
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12"></a><a href="#__codelineno-3-12"><span class="linenos" data-linenos="12 "></span></a><span class="c1">///main.cpp</span>
</span><span id="__span-3-13"><a id="__codelineno-3-13" name="__codelineno-3-13"></a><a href="#__codelineno-3-13"><span class="linenos" data-linenos="13 "></span></a><span class="p">...</span><span class="w"> </span><span class="p">...</span>
</span><span id="__span-3-14"><a id="__codelineno-3-14" name="__codelineno-3-14"></a><a href="#__codelineno-3-14"><span class="linenos" data-linenos="14 "></span></a><span class="c1">// A::N在编译时被替换成了3, 不是变量, 不需要在类外定义.</span>
</span><span id="__span-3-15"><a id="__codelineno-3-15" name="__codelineno-3-15"></a><a href="#__codelineno-3-15"><span class="linenos" data-linenos="15 "></span></a><span class="kt">int</span><span class="w"> </span><span class="n">arr</span><span class="p">[</span><span class="n">A</span><span class="o">::</span><span class="n">N</span><span class="p">];</span><span class="w">  </span>
</span><span id="__span-3-16"><a id="__codelineno-3-16" name="__codelineno-3-16"></a><a href="#__codelineno-3-16"><span class="linenos" data-linenos="16 "></span></a>
</span><span id="__span-3-17"><a id="__codelineno-3-17" name="__codelineno-3-17"></a><a href="#__codelineno-3-17"><span class="linenos" data-linenos="17 "></span></a><span class="c1">// A::M被读值, 当作变量处理, 需要分配内存, 需要在类外定义</span>
</span><span id="__span-3-18"><a id="__codelineno-3-18" name="__codelineno-3-18"></a><a href="#__codelineno-3-18"><span class="linenos" data-linenos="18 "></span></a><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="o">::</span><span class="n">M</span><span class="p">;</span>
</span><span id="__span-3-19"><a id="__codelineno-3-19" name="__codelineno-3-19"></a><a href="#__codelineno-3-19"><span class="linenos" data-linenos="19 "></span></a><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">A</span><span class="o">::</span><span class="n">M</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span><span id="__span-3-20"><a id="__codelineno-3-20" name="__codelineno-3-20"></a><a href="#__codelineno-3-20"><span class="linenos" data-linenos="20 "></span></a><span class="p">...</span><span class="w"> </span><span class="p">...</span>
</span></code></pre></div>
<h3 id="静态成员函数">静态成员函数<a class="headerlink" href="#静态成员函数">&para;</a></h3>
<ul>
<li>
<p>非static成员函数和普通函数的区别?</p>
<p>非static成员函数有隐含参数this, 而static成员函数没有. 因为从实现层面, 对非static成员函数的调用必须使用this指针.</p>
<p>首先成员函数的CV/引用限定符限制了改成员函数是否可以修改caller对象(<code>int MyClass::getValue() const;</code>/<code>int MyClass::setValue();</code>), 或者区分重载函数被左值引用对象还是右值引用对象调用():
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1"></a><a href="#__codelineno-4-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="k">class</span><span class="w"> </span><span class="nc">A</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2"></a><a href="#__codelineno-4-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="p">{</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3"></a><a href="#__codelineno-4-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="k">public</span><span class="o">:</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4"></a><a href="#__codelineno-4-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">text</span><span class="p">()</span><span class="o">&amp;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">&quot;左值引用</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5"></a><a href="#__codelineno-4-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">text</span><span class="p">()</span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">&quot;右值引用</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6"></a><a href="#__codelineno-4-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="p">}</span><span class="err">；</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7"></a><a href="#__codelineno-4-7"><span class="linenos" data-linenos=" 7 "></span></a>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8"></a><a href="#__codelineno-4-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="kt">int</span><span class="w"> </span><span class="n">main</span><span class="p">(){</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9"></a><a href="#__codelineno-4-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="w">    </span><span class="n">A</span><span class="w"> </span><span class="n">a</span><span class="p">;</span>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10"></a><a href="#__codelineno-4-10"><span class="linenos" data-linenos="10 "></span></a><span class="w">    </span><span class="n">a</span><span class="p">.</span><span class="n">text</span><span class="p">();</span><span class="w">    </span><span class="c1">//  输出&quot;左值引用&quot;</span>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11"></a><a href="#__codelineno-4-11"><span class="linenos" data-linenos="11 "></span></a><span class="w">    </span><span class="n">A</span><span class="p">().</span><span class="n">text</span><span class="p">();</span><span class="w">    </span><span class="c1">//  输出&quot;右值引用&quot;</span>
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12"></a><a href="#__codelineno-4-12"><span class="linenos" data-linenos="12 "></span></a><span class="p">}</span>
</span></code></pre></div>
这是通过在<strong>编译期</strong>修饰隐含的this指针参数类型, 产生不同的函数签名来实现的.</p>
<p>(注意, CV限定符会改变this指针类型, 但&amp;&amp;限定并不会让函数体的<code>*this</code>变成真的右值. <code>*this</code>在函数体内一直是左值表达式.)</p>
<p>其次在多继承/虚继承场景时, 成员函数必须取得具体唯一的子对象的地址, 对于不同的子对象才能执行不同的行为.</p>
</li>
<li>
<p>静态成员函数由于和类绑定而非对象, 因此只能访问同样和类绑定的静态成员变量, 不能访问非静态成员变量.</p>
</li>
</ul>
<h4 id="静态成员函数的应用">静态成员函数的应用<a class="headerlink" href="#静态成员函数的应用">&para;</a></h4>
<ol>
<li>
<p>单例模式(Meyers Singleton)
对于需要确保某个类全局只有唯一实例的情况(例如日志系统), 在static成员函数内定义static对象, 可以确保不会重复实例化且线程安全(只在第一次调用时实例化).
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1"></a><a href="#__codelineno-5-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="k">class</span><span class="w"> </span><span class="nc">Logger</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2"></a><a href="#__codelineno-5-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="k">public</span><span class="o">:</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3"></a><a href="#__codelineno-5-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="n">Logger</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Instance</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4"></a><a href="#__codelineno-5-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="w">        </span><span class="k">static</span><span class="w"> </span><span class="n">Logger</span><span class="w"> </span><span class="n">inst</span><span class="p">;</span><span class="w">          </span><span class="c1">// 线程安全：C++11 起保证</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5"></a><a href="#__codelineno-5-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">inst</span><span class="p">;</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6"></a><a href="#__codelineno-5-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7"></a><a href="#__codelineno-5-7"><span class="linenos" data-linenos=" 7 "></span></a>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8"></a><a href="#__codelineno-5-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">Log</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">msg</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9"></a><a href="#__codelineno-5-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="w">        </span><span class="c1">// ...</span>
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10"></a><a href="#__codelineno-5-10"><span class="linenos" data-linenos="10 "></span></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11"></a><a href="#__codelineno-5-11"><span class="linenos" data-linenos="11 "></span></a><span class="w">    </span><span class="o">~</span><span class="n">Logger</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">default</span><span class="p">;</span><span class="w"> </span><span class="c1">//析构函数不能放私有, 不然没法析构</span>
</span><span id="__span-5-12"><a id="__codelineno-5-12" name="__codelineno-5-12"></a><a href="#__codelineno-5-12"><span class="linenos" data-linenos="12 "></span></a>
</span><span id="__span-5-13"><a id="__codelineno-5-13" name="__codelineno-5-13"></a><a href="#__codelineno-5-13"><span class="linenos" data-linenos="13 "></span></a><span class="k">private</span><span class="o">:</span>
</span><span id="__span-5-14"><a id="__codelineno-5-14" name="__codelineno-5-14"></a><a href="#__codelineno-5-14"><span class="linenos" data-linenos="14 "></span></a><span class="w">    </span><span class="n">Logger</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">default</span><span class="p">;</span><span class="w"> </span><span class="c1">//单例模式构造应放私有, 则不能在外部实例化这个类, 仅能调用Logger::Instance()实例化.</span>
</span><span id="__span-5-15"><a id="__codelineno-5-15" name="__codelineno-5-15"></a><a href="#__codelineno-5-15"><span class="linenos" data-linenos="15 "></span></a><span class="w">    </span>
</span><span id="__span-5-16"><a id="__codelineno-5-16" name="__codelineno-5-16"></a><a href="#__codelineno-5-16"><span class="linenos" data-linenos="16 "></span></a><span class="p">};</span>
</span></code></pre></div></p>
</li>
<li>
<p>包装成员函数为C语言库的回调函数指针
C语言库常需要一个普通函数指针作为回调函数, 因为C语言没有&rdquo;隐含this指针&rdquo;的设计, 直接传入对象的成员函数会有问题, 所以若我们希望通过C语言库回调某个对象的成员函数, 则需要通过一个static成员函数来包装.</p>
</li>
</ol>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1"></a><a href="#__codelineno-6-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="k">extern</span><span class="w"> </span><span class="s">&quot;C&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2"></a><a href="#__codelineno-6-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="w">    </span><span class="c1">//该C语言库的功能为在发生event_i时, 调用C_Callback(event_i, user_j) 去修改指针user_j所指向的数据.</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3"></a><a href="#__codelineno-6-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="w">    </span><span class="c1">//用户自定义要传入的回调函数, 在发生指定event时对指定user进行指定操作. 对于面向对象, user即为指向某对象的指针.</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4"></a><a href="#__codelineno-6-4"><span class="linenos" data-linenos=" 4 "></span></a>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5"></a><a href="#__codelineno-6-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="w">    </span><span class="k">typedef</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">C_Callback</span><span class="p">)(</span><span class="kt">int</span><span class="w"> </span><span class="n">event</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">user</span><span class="p">);</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6"></a><a href="#__codelineno-6-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">RegisterCallback</span><span class="p">(</span><span class="n">C_Callback</span><span class="w"> </span><span class="n">cb</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">user</span><span class="p">);</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7"></a><a href="#__codelineno-6-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="p">}</span>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8"></a><a href="#__codelineno-6-8"><span class="linenos" data-linenos=" 8 "></span></a>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9"></a><a href="#__codelineno-6-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="k">class</span><span class="w"> </span><span class="nc">Client</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10"></a><a href="#__codelineno-6-10"><span class="linenos" data-linenos="10 "></span></a><span class="k">public</span><span class="o">:</span>
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11"></a><a href="#__codelineno-6-11"><span class="linenos" data-linenos="11 "></span></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">Start</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-12"><a id="__codelineno-6-12" name="__codelineno-6-12"></a><a href="#__codelineno-6-12"><span class="linenos" data-linenos="12 "></span></a><span class="w">        </span><span class="n">RegisterCallback</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Client</span><span class="o">::</span><span class="n">OnEventThunk</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">);</span>
</span><span id="__span-6-13"><a id="__codelineno-6-13" name="__codelineno-6-13"></a><a href="#__codelineno-6-13"><span class="linenos" data-linenos="13 "></span></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-6-14"><a id="__codelineno-6-14" name="__codelineno-6-14"></a><a href="#__codelineno-6-14"><span class="linenos" data-linenos="14 "></span></a>
</span><span id="__span-6-15"><a id="__codelineno-6-15" name="__codelineno-6-15"></a><a href="#__codelineno-6-15"><span class="linenos" data-linenos="15 "></span></a><span class="k">private</span><span class="o">:</span>
</span><span id="__span-6-16"><a id="__codelineno-6-16" name="__codelineno-6-16"></a><a href="#__codelineno-6-16"><span class="linenos" data-linenos="16 "></span></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">OnEvent</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-17"><a id="__codelineno-6-17" name="__codelineno-6-17"></a><a href="#__codelineno-6-17"><span class="linenos" data-linenos="17 "></span></a><span class="w">        </span><span class="c1">//真正的处理流程</span>
</span><span id="__span-6-18"><a id="__codelineno-6-18" name="__codelineno-6-18"></a><a href="#__codelineno-6-18"><span class="linenos" data-linenos="18 "></span></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-6-19"><a id="__codelineno-6-19" name="__codelineno-6-19"></a><a href="#__codelineno-6-19"><span class="linenos" data-linenos="19 "></span></a>
</span><span id="__span-6-20"><a id="__codelineno-6-20" name="__codelineno-6-20"></a><a href="#__codelineno-6-20"><span class="linenos" data-linenos="20 "></span></a><span class="w">    </span><span class="c1">// “桥接函数”：签名严格匹配 C_Callback</span>
</span><span id="__span-6-21"><a id="__codelineno-6-21" name="__codelineno-6-21"></a><a href="#__codelineno-6-21"><span class="linenos" data-linenos="21 "></span></a><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">OnEventThunk</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">event</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">user</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-22"><a id="__codelineno-6-22" name="__codelineno-6-22"></a><a href="#__codelineno-6-22"><span class="linenos" data-linenos="22 "></span></a><span class="w">        </span><span class="k">auto</span><span class="o">*</span><span class="w"> </span><span class="n">self</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="n">Client</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">user</span><span class="p">);</span>
</span><span id="__span-6-23"><a id="__codelineno-6-23" name="__codelineno-6-23"></a><a href="#__codelineno-6-23"><span class="linenos" data-linenos="23 "></span></a><span class="w">        </span><span class="n">self</span><span class="o">-&gt;</span><span class="n">OnEvent</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>
</span><span id="__span-6-24"><a id="__codelineno-6-24" name="__codelineno-6-24"></a><a href="#__codelineno-6-24"><span class="linenos" data-linenos="24 "></span></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-6-25"><a id="__codelineno-6-25" name="__codelineno-6-25"></a><a href="#__codelineno-6-25"><span class="linenos" data-linenos="25 "></span></a><span class="p">};</span>
</span></code></pre></div>
<h2 id="构造函数和初始化">构造函数和初始化<a class="headerlink" href="#构造函数和初始化">&para;</a></h2>
<h3 id="类成员变量的初始化方式">类成员变量的初始化方式<a class="headerlink" href="#类成员变量的初始化方式">&para;</a></h3>
<p>???+ Note C++变量的初始化过程</p>
<div class="language-text highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>所有**拥有静态存储期的变量**, 都会在main函数之前进行初始化. 对**这些拥有静态存储期的变量**分为静态初始化期和动态初始化期. 静态初始化一定在main()之前进行, 其先后分为**零初始化**(zero-initialization, 把所有具有静态存储期的对象都置为0), 和**常量初始化**(对于满足编译期常量的, 初始化为常量值). 而**动态初始化**需要执行构造函数等等, 根据不同变量有差异, 例如普通的全局对象也在main()之前由动态初始化进行构造, 但局部static对象在首次使用时进行构造.
</code></pre></div>
<ul>
<li>
<p>默认成员初始化器(initializer), 从C++11 开始</p>
<p>初始化器会在构造函数的函数体执行之前完成</p>
<p><div class="language-cpp highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1"></a><a href="#__codelineno-7-1"><span class="linenos" data-linenos="1 "></span></a><span class="k">class</span><span class="w"> </span><span class="nc">A</span><span class="p">{</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2"></a><a href="#__codelineno-7-2"><span class="linenos" data-linenos="2 "></span></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="p">{</span><span class="mi">42</span><span class="p">};</span><span class="c1">//用{}有编译器类型检查</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3"></a><a href="#__codelineno-7-3"><span class="linenos" data-linenos="3 "></span></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">42</span><span class="p">;</span><span class="c1">//用&quot;=&quot;号没有类型检查</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4"></a><a href="#__codelineno-7-4"><span class="linenos" data-linenos="4 "></span></a><span class="p">}</span>
</span></code></pre></div>
注意静态成员变量不能在类内初始化, 除了静态成员常量, 它可以在类内初始化(见上文).</p>
<p>也可以用已初始化的成员变量去初始化别的成员变量:
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1"></a><a href="#__codelineno-8-1"><span class="linenos" data-linenos="1 "></span></a><span class="k">class</span><span class="w"> </span><span class="nc">A</span><span class="p">{</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2"></a><a href="#__codelineno-8-2"><span class="linenos" data-linenos="2 "></span></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="p">{</span><span class="mi">42</span><span class="p">};</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3"></a><a href="#__codelineno-8-3"><span class="linenos" data-linenos="3 "></span></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">m</span><span class="p">{</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">};</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4"></a><a href="#__codelineno-8-4"><span class="linenos" data-linenos="4 "></span></a><span class="p">}</span>
</span></code></pre></div></p>
<p>默认成员初始化器也支持如下语法:
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1"></a><a href="#__codelineno-9-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="k">class</span><span class="w"> </span><span class="nc">MyClass</span><span class="p">{</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2"></a><a href="#__codelineno-9-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">_id</span><span class="p">{</span><span class="n">_count</span><span class="o">++</span><span class="p">};</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3"></a><a href="#__codelineno-9-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">_count</span><span class="p">;</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4"></a><a href="#__codelineno-9-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="k">public</span><span class="o">:</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5"></a><a href="#__codelineno-9-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="w">    </span><span class="n">MyClass</span><span class="p">(){</span>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6"></a><a href="#__codelineno-9-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="w">        </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Create My Class&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="n">_id</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7"></a><a href="#__codelineno-9-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8"></a><a href="#__codelineno-9-8"><span class="linenos" data-linenos=" 8 "></span></a>
</span><span id="__span-9-9"><a id="__codelineno-9-9" name="__codelineno-9-9"></a><a href="#__codelineno-9-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="w">    </span><span class="o">~</span><span class="n">MyClass</span><span class="p">(){</span>
</span><span id="__span-9-10"><a id="__codelineno-9-10" name="__codelineno-9-10"></a><a href="#__codelineno-9-10"><span class="linenos" data-linenos="10 "></span></a><span class="w">        </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Drop My Class&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="n">_id</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
</span><span id="__span-9-11"><a id="__codelineno-9-11" name="__codelineno-9-11"></a><a href="#__codelineno-9-11"><span class="linenos" data-linenos="11 "></span></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-9-12"><a id="__codelineno-9-12" name="__codelineno-9-12"></a><a href="#__codelineno-9-12"><span class="linenos" data-linenos="12 "></span></a><span class="p">}</span>
</span><span id="__span-9-13"><a id="__codelineno-9-13" name="__codelineno-9-13"></a><a href="#__codelineno-9-13"><span class="linenos" data-linenos="13 "></span></a>
</span><span id="__span-9-14"><a id="__codelineno-9-14" name="__codelineno-9-14"></a><a href="#__codelineno-9-14"><span class="linenos" data-linenos="14 "></span></a><span class="kt">int</span><span class="w"> </span><span class="n">MyClass</span><span class="o">::</span><span class="n">_count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-9-15"><a id="__codelineno-9-15" name="__codelineno-9-15"></a><a href="#__codelineno-9-15"><span class="linenos" data-linenos="15 "></span></a>
</span><span id="__span-9-16"><a id="__codelineno-9-16" name="__codelineno-9-16"></a><a href="#__codelineno-9-16"><span class="linenos" data-linenos="16 "></span></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(){</span>
</span><span id="__span-9-17"><a id="__codelineno-9-17" name="__codelineno-9-17"></a><a href="#__codelineno-9-17"><span class="linenos" data-linenos="17 "></span></a><span class="w">    </span><span class="n">MyClass</span><span class="w"> </span><span class="n">obj0</span><span class="p">;</span>
</span><span id="__span-9-18"><a id="__codelineno-9-18" name="__codelineno-9-18"></a><a href="#__codelineno-9-18"><span class="linenos" data-linenos="18 "></span></a><span class="w">    </span><span class="n">MyClass</span><span class="w"> </span><span class="n">obj1</span><span class="p">;</span>
</span><span id="__span-9-19"><a id="__codelineno-9-19" name="__codelineno-9-19"></a><a href="#__codelineno-9-19"><span class="linenos" data-linenos="19 "></span></a><span class="w">    </span><span class="n">MyClass</span><span class="w"> </span><span class="n">obj2</span><span class="p">;</span>
</span><span id="__span-9-20"><a id="__codelineno-9-20" name="__codelineno-9-20"></a><a href="#__codelineno-9-20"><span class="linenos" data-linenos="20 "></span></a><span class="p">}</span>
</span></code></pre></div></p>
<ol>
<li>
<p>上述代码的输出为:
<div class="language-text highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1"></a><a href="#__codelineno-10-1"><span class="linenos" data-linenos="1 "></span></a>Create My Class0
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2"></a><a href="#__codelineno-10-2"><span class="linenos" data-linenos="2 "></span></a>Create My Class1
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3"></a><a href="#__codelineno-10-3"><span class="linenos" data-linenos="3 "></span></a>Create My Class2
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4"></a><a href="#__codelineno-10-4"><span class="linenos" data-linenos="4 "></span></a>Drop My Class2
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5"></a><a href="#__codelineno-10-5"><span class="linenos" data-linenos="5 "></span></a>Drop My Class1
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6"></a><a href="#__codelineno-10-6"><span class="linenos" data-linenos="6 "></span></a>Drop My Class0
</span></code></pre></div></p>
</li>
</ol>
<details class="note 上述代码的初始化顺序" open="open">
<summary>Note</summary>
<p>明明_count声明在_id之后, 为什么_id能够用_count去初始化呢? 因为_count是static, 是一个有静态存储期的变量, 在进入main函数之前以及对象被创建之前就由静态初始化被初始化为0了. 所以_count是比_id先初始化的.</p>
</details>
</li>
<li>
<p>成员初始化器列表(member initializer lists)</p>
<p>初始化器列表会在构造函数的函数体执行之前完成.</p>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1"></a><a href="#__codelineno-11-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="k">class</span><span class="w"> </span><span class="nc">A</span><span class="p">{</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2"></a><a href="#__codelineno-11-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">val</span><span class="p">;</span>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3"></a><a href="#__codelineno-11-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="w">    </span><span class="n">string</span><span class="w"> </span><span class="n">name</span><span class="p">;</span>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4"></a><a href="#__codelineno-11-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="k">public</span><span class="o">:</span>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5"></a><a href="#__codelineno-11-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="c1">// 可以使用():    </span>
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6"></a><a href="#__codelineno-11-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="w">    </span><span class="n">A</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">val</span><span class="p">,</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="n">name</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="n">id</span><span class="p">(</span><span class="n">id</span><span class="p">),</span><span class="w"> </span><span class="n">val</span><span class="p">(</span><span class="n">val</span><span class="p">),</span><span class="w"> </span><span class="n">name</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7"></a><a href="#__codelineno-11-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="c1">// 或者使用{}:</span>
</span><span id="__span-11-8"><a id="__codelineno-11-8" name="__codelineno-11-8"></a><a href="#__codelineno-11-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="w">    </span><span class="n">A</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">val</span><span class="p">,</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="n">name</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="n">id</span><span class="p">{</span><span class="n">id</span><span class="p">},</span><span class="w"> </span><span class="n">val</span><span class="p">{</span><span class="n">val</span><span class="p">},</span><span class="w"> </span><span class="n">name</span><span class="p">{</span><span class="n">name</span><span class="p">}</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-11-9"><a id="__codelineno-11-9" name="__codelineno-11-9"></a><a href="#__codelineno-11-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="c1">// 同样,可以用已初始化的成员变量给未初始化的成员变量初始化:</span>
</span><span id="__span-11-10"><a id="__codelineno-11-10" name="__codelineno-11-10"></a><a href="#__codelineno-11-10"><span class="linenos" data-linenos="10 "></span></a><span class="w">    </span><span class="n">A</span><span class="p">{(</span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="n">id</span><span class="p">{</span><span class="n">id</span><span class="p">},</span><span class="w"> </span><span class="n">val</span><span class="p">{</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">},</span><span class="w"> </span><span class="n">string</span><span class="p">{</span><span class="s">&quot;defaultName&quot;</span><span class="p">}</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-11-11"><a id="__codelineno-11-11" name="__codelineno-11-11"></a><a href="#__codelineno-11-11"><span class="linenos" data-linenos="11 "></span></a><span class="p">};</span>
</span></code></pre></div>
<p>注意成员初始化器列表的顺序不影响成员被初始化的顺序,它们按照在类定义中的顺序初始化.</p>
</li>
<li>
<p>构造函数内赋值</p>
<p>尽量少在构造函数内赋值, 减少构造的开销. 也不应把业务代码放在构造函数内.</p>
<p>由于构造函数体在默认初始化器和初始化器列表之后执行, 因此若有构造函数体, 最终的结果以构造函数体为准.</p>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1"></a><a href="#__codelineno-12-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="k">class</span><span class="w"> </span><span class="nc">MyClass</span><span class="p">{</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2"></a><a href="#__codelineno-12-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">_id</span><span class="p">{</span><span class="n">_count</span><span class="o">++</span><span class="p">};</span>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3"></a><a href="#__codelineno-12-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">_count</span><span class="p">;</span>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4"></a><a href="#__codelineno-12-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="w">    </span><span class="n">string</span><span class="w"> </span><span class="n">_name</span><span class="p">;</span>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5"></a><a href="#__codelineno-12-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="k">public</span><span class="o">:</span>
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6"></a><a href="#__codelineno-12-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="w">    </span><span class="n">MyClass</span><span class="p">(</span><span class="n">string</span><span class="w"> </span><span class="n">name</span><span class="p">){</span>
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7"></a><a href="#__codelineno-12-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="w">        </span><span class="n">_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">name</span><span class="o">+</span><span class="n">to_string</span><span class="p">(</span><span class="n">_id</span><span class="p">);</span>
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8"></a><a href="#__codelineno-12-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-12-9"><a id="__codelineno-12-9" name="__codelineno-12-9"></a><a href="#__codelineno-12-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="p">}</span>
</span><span id="__span-12-10"><a id="__codelineno-12-10" name="__codelineno-12-10"></a><a href="#__codelineno-12-10"><span class="linenos" data-linenos="10 "></span></a>
</span><span id="__span-12-11"><a id="__codelineno-12-11" name="__codelineno-12-11"></a><a href="#__codelineno-12-11"><span class="linenos" data-linenos="11 "></span></a><span class="kt">int</span><span class="w"> </span><span class="n">MyClass</span><span class="o">::</span><span class="n">_count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span></code></pre></div>
</li>
</ul>
<h3 id="和去初始化对象">()和{}去初始化对象<a class="headerlink" href="#和去初始化对象">&para;</a></h3>
<p>C++在定义一个对象时, 使用<code>()</code>是直接初始化(direct initialization), 使用<code>{}</code>是列表初始化(list initialization).</p>
<ul>
<li>使用<code>{}</code>的好处:<ul>
<li>禁止窄化转换(narrowing), 比如<code>int a(3.14)</code>会初始化a为3(截断, 保留整数), 而<code>int b{3.14}</code>会error.</li>
<li>优先匹配定义了初始化器列表(<code>std::initializer_list&lt;T&gt;</code>)的构造函数.</li>
<li><code>()</code>可能被解析成函数声明, <code>{}</code>不会;</li>
<li><code>{}</code>会清零内置类型, <code>()</code>不会.
<div class="language-c++ highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1"></a><a href="#__codelineno-13-1"><span class="linenos" data-linenos="1 "></span></a><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">{};</span><span class="w">     </span><span class="c1">// x == 0</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2"></a><a href="#__codelineno-13-2"><span class="linenos" data-linenos="2 "></span></a><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="p">;</span><span class="w">       </span><span class="c1">// 未初始化（有垃圾值）</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3"></a><a href="#__codelineno-13-3"><span class="linenos" data-linenos="3 "></span></a>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4"></a><a href="#__codelineno-13-4"><span class="linenos" data-linenos="4 "></span></a><span class="k">struct</span><span class="w"> </span><span class="nc">S</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="p">;</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5"></a><a href="#__codelineno-13-5"><span class="linenos" data-linenos="5 "></span></a><span class="n">S</span><span class="w"> </span><span class="n">s</span><span class="p">{};</span><span class="w">       </span><span class="c1">// s.a == 0</span>
</span></code></pre></div></li>
</ul>
</li>
<li>
<p>使用<code>{}</code>的坑:</p>
<ul>
<li>
<p>容器由于定义了初始化器列表为参的构造函数, 会解析为列表构造
<div class="language-c++ highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1"></a><a href="#__codelineno-14-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">v1</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">);</span><span class="w"> </span><span class="c1">// 3 个元素，每个是 7  -&gt; [7,7,7]</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2"></a><a href="#__codelineno-14-2"><span class="linenos" data-linenos="2 "></span></a><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">v2</span><span class="p">{</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">};</span><span class="w"> </span><span class="c1">// 两个元素：3 和 7     -&gt; [3,7]int</span>
</span></code></pre></div></p>
</li>
<li>
<p><code>auto</code>会将<code>{}</code>推导为<code>std:initializaer_list</code>
<div class="language-c++ highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1"></a><a href="#__codelineno-15-1"><span class="linenos" data-linenos="1 "></span></a><span class="k">auto</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">};</span><span class="w">   </span><span class="c1">// a 的类型是 std::initializer_list&lt;int&gt;</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2"></a><a href="#__codelineno-15-2"><span class="linenos" data-linenos="2 "></span></a><span class="k">auto</span><span class="w"> </span><span class="n">b</span><span class="p">{</span><span class="mi">1</span><span class="p">};</span><span class="w">          </span><span class="c1">// b 是 int（C++17 起更稳定；早期标准这里更容易踩坑）</span>
</span></code></pre></div></p>
</li>
</ul>
</li>
</ul>
<h3 id="转换构造函数与explict">转换构造函数与explict<a class="headerlink" href="#转换构造函数与explict">&para;</a></h3>
<p>构造函数默认时转换构造函数, 允许隐式转换:
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1"></a><a href="#__codelineno-16-1"><span class="linenos" data-linenos="1 "></span></a><span class="k">class</span><span class="w"> </span><span class="nc">MyClass</span><span class="p">{</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2"></a><a href="#__codelineno-16-2"><span class="linenos" data-linenos="2 "></span></a><span class="k">public</span><span class="o">:</span>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3"></a><a href="#__codelineno-16-3"><span class="linenos" data-linenos="3 "></span></a><span class="w">    </span><span class="n">MyClass</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">val</span><span class="p">){};</span>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4"></a><a href="#__codelineno-16-4"><span class="linenos" data-linenos="4 "></span></a><span class="p">}</span>
</span></code></pre></div>
- 初始化时隐式转换:
    <div class="language-cpp highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1"></a><a href="#__codelineno-17-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">MyClass</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="c1">//MyClass a{1}; </span>
</span></code></pre></div>
- 函数调用时隐式转换
    <div class="language-cpp highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1"></a><a href="#__codelineno-18-1"><span class="linenos" data-linenos="1 "></span></a><span class="kt">void</span><span class="w"> </span><span class="nf">func</span><span class="p">(</span><span class="n">MyClass</span><span class="w"> </span><span class="n">obj</span><span class="p">){...}</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2"></a><a href="#__codelineno-18-2"><span class="linenos" data-linenos="2 "></span></a>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3"></a><a href="#__codelineno-18-3"><span class="linenos" data-linenos="3 "></span></a><span class="n">func</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="c1">//func(MyClass{1})  </span>
</span></code></pre></div></p>
<p>禁止此类隐式转换, 需要给构造函数加上<code>explicit</code>关键字.</p>
<h3 id="委托构造函数">委托构造函数<a class="headerlink" href="#委托构造函数">&para;</a></h3>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1"></a><a href="#__codelineno-19-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="k">class</span><span class="w"> </span><span class="nc">class_a</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2"></a><a href="#__codelineno-19-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="k">public</span><span class="o">:</span>
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3"></a><a href="#__codelineno-19-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="w">    </span><span class="n">class_a</span><span class="p">()</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4"></a><a href="#__codelineno-19-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="w">    </span><span class="n">class_a</span><span class="p">(</span><span class="n">string</span><span class="w"> </span><span class="n">str</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">m_string</span><span class="p">{</span><span class="w"> </span><span class="n">str</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-19-5"><a id="__codelineno-19-5" name="__codelineno-19-5"></a><a href="#__codelineno-19-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="w">    </span><span class="n">class_a</span><span class="p">(</span><span class="n">string</span><span class="w"> </span><span class="n">str</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">dbl</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">class_a</span><span class="p">(</span><span class="n">str</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">m_double</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dbl</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-19-6"><a id="__codelineno-19-6" name="__codelineno-19-6"></a><a href="#__codelineno-19-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">m_double</span><span class="p">{</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-19-7"><a id="__codelineno-19-7" name="__codelineno-19-7"></a><a href="#__codelineno-19-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="w">    </span><span class="n">string</span><span class="w"> </span><span class="n">m_string</span><span class="p">{</span><span class="w"> </span><span class="n">m_double</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">10.0</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s">&quot;alpha&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s">&quot;beta&quot;</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-19-8"><a id="__codelineno-19-8" name="__codelineno-19-8"></a><a href="#__codelineno-19-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="p">};</span>
</span><span id="__span-19-9"><a id="__codelineno-19-9" name="__codelineno-19-9"></a><a href="#__codelineno-19-9"><span class="linenos" data-linenos=" 9 "></span></a>
</span><span id="__span-19-10"><a id="__codelineno-19-10" name="__codelineno-19-10"></a><a href="#__codelineno-19-10"><span class="linenos" data-linenos="10 "></span></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-19-11"><a id="__codelineno-19-11" name="__codelineno-19-11"></a><a href="#__codelineno-19-11"><span class="linenos" data-linenos="11 "></span></a><span class="w">    </span><span class="n">class_a</span><span class="w"> </span><span class="n">a</span><span class="p">{</span><span class="w"> </span><span class="s">&quot;hello&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">2.0</span><span class="w"> </span><span class="p">};</span><span class="w">  </span><span class="c1">//expect a.m_double == 2.0, a.m_string == &quot;hello&quot;</span>
</span><span id="__span-19-12"><a id="__codelineno-19-12" name="__codelineno-19-12"></a><a href="#__codelineno-19-12"><span class="linenos" data-linenos="12 "></span></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span>
</span><span id="__span-19-13"><a id="__codelineno-19-13" name="__codelineno-19-13"></a><a href="#__codelineno-19-13"><span class="linenos" data-linenos="13 "></span></a><span class="p">}</span>
</span></code></pre></div>
<h2 id="继承-is-a">继承 (is a)<a class="headerlink" href="#继承-is-a">&para;</a></h2>
<ul>
<li>
<p>构造先基类再派生类, 析构时先派生类再基类.</p>
</li>
<li>
<p>内存布局: 派生类对象的内存空间先是其属于基类的成员变量, 再是属于其自己的成员变量.</p>
</li>
</ul>
<h3 id="继承中的访问权限">继承中的访问权限<a class="headerlink" href="#继承中的访问权限">&para;</a></h3>
<ul>
<li>
<p>访问说明符</p>
<ul>
<li>public 自己(基类),派生类和外部都能访问</li>
<li>protected 只有自己(基类)和派生类能访问, 外部不能访问. 在没有继承时protected等同于private</li>
<li>private 只有自己(基类)能访问, 派生类和外部都不能访问.</li>
</ul>
</li>
<li>
<p>继承方式:</p>
<ul>
<li>公有继承(public): 范围不变. 基类的private不继承; 基类的protected在派生类还是protected; 基类的public在派生类还是public.</li>
<li>保护继承(protected): 基类的public在派生类变成protected.</li>
<li>私有继承(private): 基类的public和protected在派生类变成private.</li>
</ul>
</li>
</ul>
<p>C++中, <code>class</code>的默认继承方式是私有继承, <code>struct</code>的默认继承方式是公有继承</p>
<h3 id="派生类的构造">派生类的构造<a class="headerlink" href="#派生类的构造">&para;</a></h3>
<p>派生类对象构造时, 先进行重载决议来选择要调用的派生类构造函数, 再根据该构造函数的初始化列表决定调用哪个基类构造函数. 有时候需要指定派生类在不同情况下选用不同的基类构造函数, 若不写明 (采用派生类默认无参构造函数, 或派生类构造函数未写明调用哪个基类构造函数), 则默认调用无参基类构造函数<code>Base()</code>.</p>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1"></a><a href="#__codelineno-20-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2"></a><a href="#__codelineno-20-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">std</span><span class="p">;</span>
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3"></a><a href="#__codelineno-20-3"><span class="linenos" data-linenos=" 3 "></span></a>
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4"></a><a href="#__codelineno-20-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="k">class</span><span class="w"> </span><span class="nc">Base</span>
</span><span id="__span-20-5"><a id="__codelineno-20-5" name="__codelineno-20-5"></a><a href="#__codelineno-20-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="p">{</span>
</span><span id="__span-20-6"><a id="__codelineno-20-6" name="__codelineno-20-6"></a><a href="#__codelineno-20-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="k">public</span><span class="o">:</span>
</span><span id="__span-20-7"><a id="__codelineno-20-7" name="__codelineno-20-7"></a><a href="#__codelineno-20-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="w">    </span><span class="n">Base</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Default Base Constructor&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;}</span>
</span><span id="__span-20-8"><a id="__codelineno-20-8" name="__codelineno-20-8"></a><a href="#__codelineno-20-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="w">    </span><span class="n">Base</span><span class="p">(</span><span class="n">string</span><span class="w"> </span><span class="n">str</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">name</span><span class="p">(</span><span class="n">str</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="n">cout</span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Parameterized Base Constructor: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;}</span>
</span><span id="__span-20-9"><a id="__codelineno-20-9" name="__codelineno-20-9"></a><a href="#__codelineno-20-9"><span class="linenos" data-linenos=" 9 "></span></a>
</span><span id="__span-20-10"><a id="__codelineno-20-10" name="__codelineno-20-10"></a><a href="#__codelineno-20-10"><span class="linenos" data-linenos="10 "></span></a><span class="w">    </span><span class="n">string</span><span class="w"> </span><span class="n">name</span><span class="p">{</span><span class="s">&quot;BaseName&quot;</span><span class="p">};</span>
</span><span id="__span-20-11"><a id="__codelineno-20-11" name="__codelineno-20-11"></a><a href="#__codelineno-20-11"><span class="linenos" data-linenos="11 "></span></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">testFunc</span><span class="p">()</span>
</span><span id="__span-20-12"><a id="__codelineno-20-12" name="__codelineno-20-12"></a><a href="#__codelineno-20-12"><span class="linenos" data-linenos="12 "></span></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-20-13"><a id="__codelineno-20-13" name="__codelineno-20-13"></a><a href="#__codelineno-20-13"><span class="linenos" data-linenos="13 "></span></a><span class="w">        </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Base::testFunc()&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span>
</span><span id="__span-20-14"><a id="__codelineno-20-14" name="__codelineno-20-14"></a><a href="#__codelineno-20-14"><span class="linenos" data-linenos="14 "></span></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-20-15"><a id="__codelineno-20-15" name="__codelineno-20-15"></a><a href="#__codelineno-20-15"><span class="linenos" data-linenos="15 "></span></a><span class="p">};</span>
</span><span id="__span-20-16"><a id="__codelineno-20-16" name="__codelineno-20-16"></a><a href="#__codelineno-20-16"><span class="linenos" data-linenos="16 "></span></a>
</span><span id="__span-20-17"><a id="__codelineno-20-17" name="__codelineno-20-17"></a><a href="#__codelineno-20-17"><span class="linenos" data-linenos="17 "></span></a><span class="k">class</span><span class="w"> </span><span class="nc">Derive</span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Base</span>
</span><span id="__span-20-18"><a id="__codelineno-20-18" name="__codelineno-20-18"></a><a href="#__codelineno-20-18"><span class="linenos" data-linenos="18 "></span></a><span class="p">{</span>
</span><span id="__span-20-19"><a id="__codelineno-20-19" name="__codelineno-20-19"></a><a href="#__codelineno-20-19"><span class="linenos" data-linenos="19 "></span></a><span class="k">public</span><span class="o">:</span>
</span><span id="__span-20-20"><a id="__codelineno-20-20" name="__codelineno-20-20"></a><a href="#__codelineno-20-20"><span class="linenos" data-linenos="20 "></span></a><span class="w">    </span><span class="n">Derive</span><span class="p">()</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">Base</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="n">cout</span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Default Derive Constructor&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;}</span>
</span><span id="__span-20-21"><a id="__codelineno-20-21" name="__codelineno-20-21"></a><a href="#__codelineno-20-21"><span class="linenos" data-linenos="21 "></span></a><span class="w">    </span><span class="n">Derive</span><span class="p">(</span><span class="n">string</span><span class="w"> </span><span class="n">str</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">Base</span><span class="p">(</span><span class="n">str</span><span class="p">){</span><span class="n">cout</span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Parameterized Derive Constructor: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;}</span>
</span><span id="__span-20-22"><a id="__codelineno-20-22" name="__codelineno-20-22"></a><a href="#__codelineno-20-22"><span class="linenos" data-linenos="22 "></span></a><span class="p">};</span>
</span><span id="__span-20-23"><a id="__codelineno-20-23" name="__codelineno-20-23"></a><a href="#__codelineno-20-23"><span class="linenos" data-linenos="23 "></span></a>
</span><span id="__span-20-24"><a id="__codelineno-20-24" name="__codelineno-20-24"></a><a href="#__codelineno-20-24"><span class="linenos" data-linenos="24 "></span></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
</span><span id="__span-20-25"><a id="__codelineno-20-25" name="__codelineno-20-25"></a><a href="#__codelineno-20-25"><span class="linenos" data-linenos="25 "></span></a><span class="p">{</span>
</span><span id="__span-20-26"><a id="__codelineno-20-26" name="__codelineno-20-26"></a><a href="#__codelineno-20-26"><span class="linenos" data-linenos="26 "></span></a><span class="w">    </span><span class="n">Base</span><span class="w"> </span><span class="n">Base1</span><span class="p">;</span>
</span><span id="__span-20-27"><a id="__codelineno-20-27" name="__codelineno-20-27"></a><a href="#__codelineno-20-27"><span class="linenos" data-linenos="27 "></span></a><span class="w">    </span><span class="n">Base</span><span class="w"> </span><span class="n">Base2</span><span class="p">{</span><span class="s">&quot;asdfad&quot;</span><span class="p">};</span>
</span><span id="__span-20-28"><a id="__codelineno-20-28" name="__codelineno-20-28"></a><a href="#__codelineno-20-28"><span class="linenos" data-linenos="28 "></span></a><span class="w">    </span><span class="n">Derive</span><span class="w"> </span><span class="n">obj1</span><span class="p">;</span>
</span><span id="__span-20-29"><a id="__codelineno-20-29" name="__codelineno-20-29"></a><a href="#__codelineno-20-29"><span class="linenos" data-linenos="29 "></span></a><span class="w">    </span><span class="n">Derive</span><span class="w"> </span><span class="n">obj2</span><span class="p">{</span><span class="s">&quot;123123&quot;</span><span class="p">};</span>
</span><span id="__span-20-30"><a id="__codelineno-20-30" name="__codelineno-20-30"></a><a href="#__codelineno-20-30"><span class="linenos" data-linenos="30 "></span></a><span class="p">}</span>
</span></code></pre></div>
<p>注意这里不是委托构造, 而是基类子对象初始化(base-class subobject initialization), 也就是在派生类构造函数的成员初始化列表里指定用哪个 Base 构造函数来构造 派生类对象内部的那一份 Base 部分。</p>
<h3 id="继承中同名的成员变量和函数">继承中同名的成员变量和函数<a class="headerlink" href="#继承中同名的成员变量和函数">&para;</a></h3>
<ul>
<li>同名成员变量和成员函数, 优先访问派生类的;</li>
<li>若派生类没有定义同名的成员函数, 则会直接访问到基类的成员函数.</li>
</ul>
<p>若一定要访问基类的同名成员变量/函数, 在成员变量名前加作用域限定符(<code>基类名::成员变量名</code>).</p>
<p><div class="language-cpp highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1"></a><a href="#__codelineno-21-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="k">class</span><span class="w"> </span><span class="nc">Base</span><span class="p">{</span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2"></a><a href="#__codelineno-21-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="k">public</span><span class="o">:</span>
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3"></a><a href="#__codelineno-21-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="w">    </span><span class="n">string</span><span class="w"> </span><span class="n">name</span><span class="p">{</span><span class="s">&quot;BaseName&quot;</span><span class="p">};</span>
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4"></a><a href="#__codelineno-21-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">testFunc</span><span class="p">(){</span>
</span><span id="__span-21-5"><a id="__codelineno-21-5" name="__codelineno-21-5"></a><a href="#__codelineno-21-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="w">        </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Base::testFunc()&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
</span><span id="__span-21-6"><a id="__codelineno-21-6" name="__codelineno-21-6"></a><a href="#__codelineno-21-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-21-7"><a id="__codelineno-21-7" name="__codelineno-21-7"></a><a href="#__codelineno-21-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="p">}</span>
</span><span id="__span-21-8"><a id="__codelineno-21-8" name="__codelineno-21-8"></a><a href="#__codelineno-21-8"><span class="linenos" data-linenos=" 8 "></span></a>
</span><span id="__span-21-9"><a id="__codelineno-21-9" name="__codelineno-21-9"></a><a href="#__codelineno-21-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="k">class</span><span class="w"> </span><span class="nc">Derive</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Base</span><span class="p">{</span>
</span><span id="__span-21-10"><a id="__codelineno-21-10" name="__codelineno-21-10"></a><a href="#__codelineno-21-10"><span class="linenos" data-linenos="10 "></span></a><span class="k">public</span><span class="o">:</span>
</span><span id="__span-21-11"><a id="__codelineno-21-11" name="__codelineno-21-11"></a><a href="#__codelineno-21-11"><span class="linenos" data-linenos="11 "></span></a><span class="w">    </span><span class="n">string</span><span class="w"> </span><span class="n">name</span><span class="p">{</span><span class="s">&quot;DeriveName&quot;</span><span class="p">};</span>
</span><span id="__span-21-12"><a id="__codelineno-21-12" name="__codelineno-21-12"></a><a href="#__codelineno-21-12"><span class="linenos" data-linenos="12 "></span></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">testFunc</span><span class="p">(){</span>
</span><span id="__span-21-13"><a id="__codelineno-21-13" name="__codelineno-21-13"></a><a href="#__codelineno-21-13"><span class="linenos" data-linenos="13 "></span></a><span class="w">        </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Derive::testFunc()&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
</span><span id="__span-21-14"><a id="__codelineno-21-14" name="__codelineno-21-14"></a><a href="#__codelineno-21-14"><span class="linenos" data-linenos="14 "></span></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-21-15"><a id="__codelineno-21-15" name="__codelineno-21-15"></a><a href="#__codelineno-21-15"><span class="linenos" data-linenos="15 "></span></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">printBase</span><span class="p">(){</span>
</span><span id="__span-21-16"><a id="__codelineno-21-16" name="__codelineno-21-16"></a><a href="#__codelineno-21-16"><span class="linenos" data-linenos="16 "></span></a><span class="w">        </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Base = &quot;</span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">Base</span><span class="o">::</span><span class="n">name</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span>
</span><span id="__span-21-17"><a id="__codelineno-21-17" name="__codelineno-21-17"></a><a href="#__codelineno-21-17"><span class="linenos" data-linenos="17 "></span></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-21-18"><a id="__codelineno-21-18" name="__codelineno-21-18"></a><a href="#__codelineno-21-18"><span class="linenos" data-linenos="18 "></span></a><span class="p">}</span>
</span><span id="__span-21-19"><a id="__codelineno-21-19" name="__codelineno-21-19"></a><a href="#__codelineno-21-19"><span class="linenos" data-linenos="19 "></span></a>
</span><span id="__span-21-20"><a id="__codelineno-21-20" name="__codelineno-21-20"></a><a href="#__codelineno-21-20"><span class="linenos" data-linenos="20 "></span></a><span class="kt">int</span><span class="w"> </span><span class="n">main</span><span class="p">(){</span>
</span><span id="__span-21-21"><a id="__codelineno-21-21" name="__codelineno-21-21"></a><a href="#__codelineno-21-21"><span class="linenos" data-linenos="21 "></span></a><span class="w">    </span><span class="n">Derive</span><span class="w"> </span><span class="n">a</span><span class="p">;</span>
</span><span id="__span-21-22"><a id="__codelineno-21-22" name="__codelineno-21-22"></a><a href="#__codelineno-21-22"><span class="linenos" data-linenos="22 "></span></a><span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span><span class="w"> </span><span class="c1">// DeriveName</span>
</span><span id="__span-21-23"><a id="__codelineno-21-23" name="__codelineno-21-23"></a><a href="#__codelineno-21-23"><span class="linenos" data-linenos="23 "></span></a>
</span><span id="__span-21-24"><a id="__codelineno-21-24" name="__codelineno-21-24"></a><a href="#__codelineno-21-24"><span class="linenos" data-linenos="24 "></span></a><span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">Base</span><span class="o">::</span><span class="n">name</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span><span class="w"> </span><span class="c1">// BaseName</span>
</span><span id="__span-21-25"><a id="__codelineno-21-25" name="__codelineno-21-25"></a><a href="#__codelineno-21-25"><span class="linenos" data-linenos="25 "></span></a>
</span><span id="__span-21-26"><a id="__codelineno-21-26" name="__codelineno-21-26"></a><a href="#__codelineno-21-26"><span class="linenos" data-linenos="26 "></span></a><span class="w">    </span><span class="n">a</span><span class="p">.</span><span class="n">printBase</span><span class="p">();</span><span class="w"> </span><span class="c1">// Base = BaseName</span>
</span><span id="__span-21-27"><a id="__codelineno-21-27" name="__codelineno-21-27"></a><a href="#__codelineno-21-27"><span class="linenos" data-linenos="27 "></span></a>
</span><span id="__span-21-28"><a id="__codelineno-21-28" name="__codelineno-21-28"></a><a href="#__codelineno-21-28"><span class="linenos" data-linenos="28 "></span></a><span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">testFunc</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span><span class="w"> </span><span class="c1">// Derive::testFunc()</span>
</span><span id="__span-21-29"><a id="__codelineno-21-29" name="__codelineno-21-29"></a><a href="#__codelineno-21-29"><span class="linenos" data-linenos="29 "></span></a>
</span><span id="__span-21-30"><a id="__codelineno-21-30" name="__codelineno-21-30"></a><a href="#__codelineno-21-30"><span class="linenos" data-linenos="30 "></span></a><span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">Base</span><span class="o">::</span><span class="n">testFunc</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span><span class="w"> </span><span class="c1">// Base::testFunc()</span>
</span><span id="__span-21-31"><a id="__codelineno-21-31" name="__codelineno-21-31"></a><a href="#__codelineno-21-31"><span class="linenos" data-linenos="31 "></span></a><span class="p">}</span>
</span></code></pre></div>
注意有继承关系的类的同名函数并非重写(override), 重写概念只适用于使用虚方法时派生类的方法重写了基类的虚方法.</p>
<h2 id="多态公有继承">多态公有继承<a class="headerlink" href="#多态公有继承">&para;</a></h2>
<ul>
<li>
<p><strong>多态</strong>: 同一个方法的行为随上下文而异.</p>
</li>
<li>
<p><strong>静态多态</strong>: 函数重载, 模板;</p>
</li>
<li>
<p><strong>动态多态</strong>: 通过虚方法实现.</p>
</li>
</ul>
<p>多态常与公有继承结合, 为不同类型的实体提供统一的接口. 多态公有继承的实现可基于两种机制: 
1. 静态多态: 在派生类中重新定义基类的方法(即上文&rdquo;继承中同名的成员变量和函数&rdquo;);
2. 动态多态: 使用虚(virtual)方法.</p>
<h3 id="虚方法">虚方法<a class="headerlink" href="#虚方法">&para;</a></h3>
<p><strong>在基类方法的声明中使用关键字virtual, 则该方法在基类以及所有的派生类中都是虚方法.</strong>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1"></a><a href="#__codelineno-22-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="k">class</span><span class="w"> </span><span class="nc">Base</span><span class="p">{</span>
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2"></a><a href="#__codelineno-22-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="k">public</span><span class="o">:</span>
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3"></a><a href="#__codelineno-22-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">id0</span><span class="p">{</span><span class="mi">0</span><span class="p">};</span><span class="w"> </span>
</span><span id="__span-22-4"><a id="__codelineno-22-4" name="__codelineno-22-4"></a><a href="#__codelineno-22-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="w">    </span><span class="n">string</span><span class="w"> </span><span class="n">name</span><span class="p">{</span><span class="s">&quot;base&quot;</span><span class="p">};</span>
</span><span id="__span-22-5"><a id="__codelineno-22-5" name="__codelineno-22-5"></a><a href="#__codelineno-22-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="w">    </span>
</span><span id="__span-22-6"><a id="__codelineno-22-6" name="__codelineno-22-6"></a><a href="#__codelineno-22-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="w">    </span><span class="n">Base</span><span class="p">(</span><span class="n">string</span><span class="w"> </span><span class="n">str</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="o">:</span><span class="n">name</span><span class="p">{</span><span class="n">str</span><span class="p">},</span><span class="w"> </span><span class="n">id0</span><span class="p">{</span><span class="n">id</span><span class="p">}</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-22-7"><a id="__codelineno-22-7" name="__codelineno-22-7"></a><a href="#__codelineno-22-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">showName</span><span class="p">(){</span>
</span><span id="__span-22-8"><a id="__codelineno-22-8" name="__codelineno-22-8"></a><a href="#__codelineno-22-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="w">        </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Base Name &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
</span><span id="__span-22-9"><a id="__codelineno-22-9" name="__codelineno-22-9"></a><a href="#__codelineno-22-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-22-10"><a id="__codelineno-22-10" name="__codelineno-22-10"></a><a href="#__codelineno-22-10"><span class="linenos" data-linenos="10 "></span></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">showNameNonVirtual</span><span class="p">(){</span>
</span><span id="__span-22-11"><a id="__codelineno-22-11" name="__codelineno-22-11"></a><a href="#__codelineno-22-11"><span class="linenos" data-linenos="11 "></span></a><span class="w">        </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Base Name &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
</span><span id="__span-22-12"><a id="__codelineno-22-12" name="__codelineno-22-12"></a><a href="#__codelineno-22-12"><span class="linenos" data-linenos="12 "></span></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-22-13"><a id="__codelineno-22-13" name="__codelineno-22-13"></a><a href="#__codelineno-22-13"><span class="linenos" data-linenos="13 "></span></a><span class="p">};</span>
</span><span id="__span-22-14"><a id="__codelineno-22-14" name="__codelineno-22-14"></a><a href="#__codelineno-22-14"><span class="linenos" data-linenos="14 "></span></a>
</span><span id="__span-22-15"><a id="__codelineno-22-15" name="__codelineno-22-15"></a><a href="#__codelineno-22-15"><span class="linenos" data-linenos="15 "></span></a><span class="k">class</span><span class="w"> </span><span class="nc">Derive1</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Base</span><span class="p">{</span>
</span><span id="__span-22-16"><a id="__codelineno-22-16" name="__codelineno-22-16"></a><a href="#__codelineno-22-16"><span class="linenos" data-linenos="16 "></span></a><span class="k">public</span><span class="o">:</span>
</span><span id="__span-22-17"><a id="__codelineno-22-17" name="__codelineno-22-17"></a><a href="#__codelineno-22-17"><span class="linenos" data-linenos="17 "></span></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">id1</span><span class="p">{</span><span class="mi">1</span><span class="p">};</span>
</span><span id="__span-22-18"><a id="__codelineno-22-18" name="__codelineno-22-18"></a><a href="#__codelineno-22-18"><span class="linenos" data-linenos="18 "></span></a>
</span><span id="__span-22-19"><a id="__codelineno-22-19" name="__codelineno-22-19"></a><a href="#__codelineno-22-19"><span class="linenos" data-linenos="19 "></span></a><span class="w">    </span><span class="n">Derive1</span><span class="p">(</span><span class="n">string</span><span class="w"> </span><span class="n">str</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="n">Base</span><span class="p">(</span><span class="n">str</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-22-20"><a id="__codelineno-22-20" name="__codelineno-22-20"></a><a href="#__codelineno-22-20"><span class="linenos" data-linenos="20 "></span></a><span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">showName</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-22-21"><a id="__codelineno-22-21" name="__codelineno-22-21"></a><a href="#__codelineno-22-21"><span class="linenos" data-linenos="21 "></span></a><span class="w">        </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Derive1 Name &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
</span><span id="__span-22-22"><a id="__codelineno-22-22" name="__codelineno-22-22"></a><a href="#__codelineno-22-22"><span class="linenos" data-linenos="22 "></span></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-22-23"><a id="__codelineno-22-23" name="__codelineno-22-23"></a><a href="#__codelineno-22-23"><span class="linenos" data-linenos="23 "></span></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">showNameNonVirtual</span><span class="p">(){</span>
</span><span id="__span-22-24"><a id="__codelineno-22-24" name="__codelineno-22-24"></a><a href="#__codelineno-22-24"><span class="linenos" data-linenos="24 "></span></a><span class="w">        </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Derive1 Name &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
</span><span id="__span-22-25"><a id="__codelineno-22-25" name="__codelineno-22-25"></a><a href="#__codelineno-22-25"><span class="linenos" data-linenos="25 "></span></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-22-26"><a id="__codelineno-22-26" name="__codelineno-22-26"></a><a href="#__codelineno-22-26"><span class="linenos" data-linenos="26 "></span></a><span class="p">};</span>
</span><span id="__span-22-27"><a id="__codelineno-22-27" name="__codelineno-22-27"></a><a href="#__codelineno-22-27"><span class="linenos" data-linenos="27 "></span></a>
</span><span id="__span-22-28"><a id="__codelineno-22-28" name="__codelineno-22-28"></a><a href="#__codelineno-22-28"><span class="linenos" data-linenos="28 "></span></a><span class="k">class</span><span class="w"> </span><span class="nc">Derive2</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Derive1</span><span class="p">{</span>
</span><span id="__span-22-29"><a id="__codelineno-22-29" name="__codelineno-22-29"></a><a href="#__codelineno-22-29"><span class="linenos" data-linenos="29 "></span></a><span class="k">public</span><span class="o">:</span>
</span><span id="__span-22-30"><a id="__codelineno-22-30" name="__codelineno-22-30"></a><a href="#__codelineno-22-30"><span class="linenos" data-linenos="30 "></span></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">id2</span><span class="p">{</span><span class="mi">2</span><span class="p">};</span>
</span><span id="__span-22-31"><a id="__codelineno-22-31" name="__codelineno-22-31"></a><a href="#__codelineno-22-31"><span class="linenos" data-linenos="31 "></span></a>
</span><span id="__span-22-32"><a id="__codelineno-22-32" name="__codelineno-22-32"></a><a href="#__codelineno-22-32"><span class="linenos" data-linenos="32 "></span></a><span class="w">    </span><span class="n">Derive2</span><span class="p">(</span><span class="n">string</span><span class="w"> </span><span class="n">str</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="n">Derive1</span><span class="p">(</span><span class="n">str</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-22-33"><a id="__codelineno-22-33" name="__codelineno-22-33"></a><a href="#__codelineno-22-33"><span class="linenos" data-linenos="33 "></span></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">showName</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-22-34"><a id="__codelineno-22-34" name="__codelineno-22-34"></a><a href="#__codelineno-22-34"><span class="linenos" data-linenos="34 "></span></a><span class="w">        </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Derive2 Name &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
</span><span id="__span-22-35"><a id="__codelineno-22-35" name="__codelineno-22-35"></a><a href="#__codelineno-22-35"><span class="linenos" data-linenos="35 "></span></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-22-36"><a id="__codelineno-22-36" name="__codelineno-22-36"></a><a href="#__codelineno-22-36"><span class="linenos" data-linenos="36 "></span></a><span class="p">};</span>
</span></code></pre></div>
上述<code>Base::showName()</code>, <code>Derive1::showName()</code>,  <code>Derive2::showName()</code>都是虚方法;
而<code>Base::showNameNonVirtual()</code>,<code>Derive1::showNameNonVirtual()</code>不是虚方法. </p>
<p>派生类的同名函数会<strong>重写(override)</strong>基类的虚函数. 重写时应在派生类的函数签名后, 函数体前加上 <code>override</code>关键字, 这样会检查基类是否有对应的虚函数.</p>
<h4 id="静态绑定和动态绑定">静态绑定和动态绑定<a class="headerlink" href="#静态绑定和动态绑定">&para;</a></h4>
<p>函数作为一个片段存在于内存的代码区, 一般而言, 将函数调用解释为保存上下文并让程序计数器跳转到函数的起始地址, 这被称为绑定(binding, 或称联编). 静态绑定(static binding, 又称静态联编或early binding早期联编), 是指编译器在编译阶段就把函数调用解释为跳转到一个固定的函数起始地址. 而动态绑定(dynamci binding, 又称动态联编/晚期联编)是指, 在编译阶段不能确定函数调用使用哪个地址, 需要在运行时确定, 所以编译器生成的是&rdquo;在运行时选择跳转到正确的函数的代码&rdquo;. </p>
<h4 id="继承类型的指针和引用类型的向上强制转换upcasting">继承类型的指针和引用类型的向上强制转换(upcasting)<a class="headerlink" href="#继承类型的指针和引用类型的向上强制转换upcasting">&para;</a></h4>
<p>对于一般类型, 在不使用显式类型转换时, C++并不允许将一种类型的地址赋值给另一类型的指针, 也不允许将一种类型的引用指向另一种类型. </p>
<p><strong>C++允许派生类对象的地址赋值给基类指针, 也允许基类的引用类型去引用一个派生类对象, 这两种情况下是默认进行隐式类型转换</strong>. 这被称为向上强制转换(upcasting).</p>
<p>这意味着, <strong>一个形参是基类引用/基类指针类型时, 可以传入派生类对象/派生类对象地址</strong>.</p>
<h4 id="虚方法实现多态">虚方法实现多态<a class="headerlink" href="#虚方法实现多态">&para;</a></h4>
<p><strong>当通过指针或引用调用对象的成员函数, 且成员函数为虚方法, 则将使用动态绑定; 除此之外的情况使用静态绑定.</strong></p>
<p>具体而言, 当使用静态绑定时, 编译器通过字面的对象/指针/引用类型调用对应类的成员函数. 而使用动态绑定时, 编译器通过指针/引用所具体指向的对象类型调用成员函数.</p>
<p><div class="language-cpp highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1"></a><a href="#__codelineno-23-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kt">void</span><span class="w"> </span><span class="nf">funcP</span><span class="p">(</span><span class="n">Base</span><span class="w"> </span><span class="o">*</span><span class="n">p</span><span class="p">){</span>
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2"></a><a href="#__codelineno-23-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="w">    </span><span class="n">p</span><span class="o">-&gt;</span><span class="n">showName</span><span class="p">();</span>
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3"></a><a href="#__codelineno-23-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="p">}</span>
</span><span id="__span-23-4"><a id="__codelineno-23-4" name="__codelineno-23-4"></a><a href="#__codelineno-23-4"><span class="linenos" data-linenos=" 4 "></span></a>
</span><span id="__span-23-5"><a id="__codelineno-23-5" name="__codelineno-23-5"></a><a href="#__codelineno-23-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="kt">void</span><span class="w"> </span><span class="nf">funcR</span><span class="p">(</span><span class="n">Base</span><span class="w"> </span><span class="o">&amp;</span><span class="n">r</span><span class="p">){</span>
</span><span id="__span-23-6"><a id="__codelineno-23-6" name="__codelineno-23-6"></a><a href="#__codelineno-23-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="w">    </span><span class="n">r</span><span class="p">.</span><span class="n">showName</span><span class="p">();</span>
</span><span id="__span-23-7"><a id="__codelineno-23-7" name="__codelineno-23-7"></a><a href="#__codelineno-23-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="p">}</span>
</span><span id="__span-23-8"><a id="__codelineno-23-8" name="__codelineno-23-8"></a><a href="#__codelineno-23-8"><span class="linenos" data-linenos=" 8 "></span></a>
</span><span id="__span-23-9"><a id="__codelineno-23-9" name="__codelineno-23-9"></a><a href="#__codelineno-23-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="kt">void</span><span class="w"> </span><span class="nf">funcV</span><span class="p">(</span><span class="n">Base</span><span class="w"> </span><span class="n">val</span><span class="p">){</span>
</span><span id="__span-23-10"><a id="__codelineno-23-10" name="__codelineno-23-10"></a><a href="#__codelineno-23-10"><span class="linenos" data-linenos="10 "></span></a><span class="w">    </span><span class="n">val</span><span class="p">.</span><span class="n">showName</span><span class="p">();</span>
</span><span id="__span-23-11"><a id="__codelineno-23-11" name="__codelineno-23-11"></a><a href="#__codelineno-23-11"><span class="linenos" data-linenos="11 "></span></a><span class="w">    </span><span class="k">if</span><span class="p">((</span><span class="n">val</span><span class="p">.</span><span class="n">name</span><span class="p">).</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;Derive&quot;</span><span class="p">)</span><span class="o">!=</span><span class="n">string</span><span class="o">::</span><span class="n">npos</span><span class="p">){</span>
</span><span id="__span-23-12"><a id="__codelineno-23-12" name="__codelineno-23-12"></a><a href="#__codelineno-23-12"><span class="linenos" data-linenos="12 "></span></a><span class="w">        </span><span class="c1">//cout &lt;&lt; &quot;id1= &quot;&lt;&lt; val.id1&lt;&lt;endl;//无法通过编译</span>
</span><span id="__span-23-13"><a id="__codelineno-23-13" name="__codelineno-23-13"></a><a href="#__codelineno-23-13"><span class="linenos" data-linenos="13 "></span></a><span class="w">        </span><span class="c1">//error: &#39;class Base&#39; has no member named &#39;id1&#39;;</span>
</span><span id="__span-23-14"><a id="__codelineno-23-14" name="__codelineno-23-14"></a><a href="#__codelineno-23-14"><span class="linenos" data-linenos="14 "></span></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-23-15"><a id="__codelineno-23-15" name="__codelineno-23-15"></a><a href="#__codelineno-23-15"><span class="linenos" data-linenos="15 "></span></a><span class="p">}</span>
</span><span id="__span-23-16"><a id="__codelineno-23-16" name="__codelineno-23-16"></a><a href="#__codelineno-23-16"><span class="linenos" data-linenos="16 "></span></a>
</span><span id="__span-23-17"><a id="__codelineno-23-17" name="__codelineno-23-17"></a><a href="#__codelineno-23-17"><span class="linenos" data-linenos="17 "></span></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(){</span>
</span><span id="__span-23-18"><a id="__codelineno-23-18" name="__codelineno-23-18"></a><a href="#__codelineno-23-18"><span class="linenos" data-linenos="18 "></span></a><span class="w">    </span><span class="n">Base</span><span class="w"> </span><span class="n">obj0</span><span class="p">{</span><span class="s">&quot;BaseObj&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">};</span>
</span><span id="__span-23-19"><a id="__codelineno-23-19" name="__codelineno-23-19"></a><a href="#__codelineno-23-19"><span class="linenos" data-linenos="19 "></span></a><span class="w">    </span><span class="n">Derive1</span><span class="w"> </span><span class="n">obj1</span><span class="p">{</span><span class="s">&quot;DeriveObj&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">};</span>
</span><span id="__span-23-20"><a id="__codelineno-23-20" name="__codelineno-23-20"></a><a href="#__codelineno-23-20"><span class="linenos" data-linenos="20 "></span></a>
</span><span id="__span-23-21"><a id="__codelineno-23-21" name="__codelineno-23-21"></a><a href="#__codelineno-23-21"><span class="linenos" data-linenos="21 "></span></a><span class="w">    </span><span class="n">funcP</span><span class="p">(</span><span class="o">&amp;</span><span class="n">obj0</span><span class="p">);</span>
</span><span id="__span-23-22"><a id="__codelineno-23-22" name="__codelineno-23-22"></a><a href="#__codelineno-23-22"><span class="linenos" data-linenos="22 "></span></a><span class="w">    </span><span class="n">funcP</span><span class="p">(</span><span class="o">&amp;</span><span class="n">obj1</span><span class="p">);</span>
</span><span id="__span-23-23"><a id="__codelineno-23-23" name="__codelineno-23-23"></a><a href="#__codelineno-23-23"><span class="linenos" data-linenos="23 "></span></a><span class="w">    </span><span class="n">funcR</span><span class="p">(</span><span class="n">obj0</span><span class="p">);</span>
</span><span id="__span-23-24"><a id="__codelineno-23-24" name="__codelineno-23-24"></a><a href="#__codelineno-23-24"><span class="linenos" data-linenos="24 "></span></a><span class="w">    </span><span class="n">funcR</span><span class="p">(</span><span class="n">obj1</span><span class="p">);</span>
</span><span id="__span-23-25"><a id="__codelineno-23-25" name="__codelineno-23-25"></a><a href="#__codelineno-23-25"><span class="linenos" data-linenos="25 "></span></a><span class="w">    </span><span class="n">funcV</span><span class="p">(</span><span class="n">obj0</span><span class="p">);</span>
</span><span id="__span-23-26"><a id="__codelineno-23-26" name="__codelineno-23-26"></a><a href="#__codelineno-23-26"><span class="linenos" data-linenos="26 "></span></a><span class="w">    </span><span class="n">funcV</span><span class="p">(</span><span class="n">obj1</span><span class="p">);</span>
</span><span id="__span-23-27"><a id="__codelineno-23-27" name="__codelineno-23-27"></a><a href="#__codelineno-23-27"><span class="linenos" data-linenos="27 "></span></a><span class="p">}</span>
</span></code></pre></div>
结果: 
<div class="language-text highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1"></a><a href="#__codelineno-24-1"><span class="linenos" data-linenos="1 "></span></a>Base Name BaseObj
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2"></a><a href="#__codelineno-24-2"><span class="linenos" data-linenos="2 "></span></a>Derive1 Name DeriveObj
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3"></a><a href="#__codelineno-24-3"><span class="linenos" data-linenos="3 "></span></a>Base Name BaseObj
</span><span id="__span-24-4"><a id="__codelineno-24-4" name="__codelineno-24-4"></a><a href="#__codelineno-24-4"><span class="linenos" data-linenos="4 "></span></a>Derive1 Name DeriveObj
</span><span id="__span-24-5"><a id="__codelineno-24-5" name="__codelineno-24-5"></a><a href="#__codelineno-24-5"><span class="linenos" data-linenos="5 "></span></a>Base Name BaseObj
</span><span id="__span-24-6"><a id="__codelineno-24-6" name="__codelineno-24-6"></a><a href="#__codelineno-24-6"><span class="linenos" data-linenos="6 "></span></a>Base Name DeriveObj
</span></code></pre></div>
可见使用指针或引用调用虚方法是, 虽然形参都是Base类, 但是调用了指向的具体对象的类型的方法. 且在按值传递时, 由于Base类没有id1成员变量, id1丢失了.</p>
<p>若我们将funcP, funcR, funcV的showName()都改为showNameNonVirtual(), 结果为:
<div class="language-text highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1"></a><a href="#__codelineno-25-1"><span class="linenos" data-linenos="1 "></span></a>Base Name BaseObj
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2"></a><a href="#__codelineno-25-2"><span class="linenos" data-linenos="2 "></span></a>Base Name DeriveObj
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3"></a><a href="#__codelineno-25-3"><span class="linenos" data-linenos="3 "></span></a>Base Name BaseObj
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4"></a><a href="#__codelineno-25-4"><span class="linenos" data-linenos="4 "></span></a>Base Name DeriveObj
</span><span id="__span-25-5"><a id="__codelineno-25-5" name="__codelineno-25-5"></a><a href="#__codelineno-25-5"><span class="linenos" data-linenos="5 "></span></a>Base Name BaseObj
</span><span id="__span-25-6"><a id="__codelineno-25-6" name="__codelineno-25-6"></a><a href="#__codelineno-25-6"><span class="linenos" data-linenos="6 "></span></a>Base Name DeriveObj
</span></code></pre></div>
可见若不使用虚方法而是使用同名方法, 将采用静态绑定, 不论传入基类Base还是派生类Derive1的对象, 均按照形参类型绑定到Base类的showNameNonVirtual()函数上.</p>
<details class="note虚函数表" open="open">
<summary>Note虚函数表</summary>
<p>定义了虚方法的类都有虚函数表. 注意每个类对应一张虚函数表, 这个表不会存在对象中, 每个对象只保存一个隐藏的指针成员vptr指向其所属类的虚函数表.</p>
<p>所以有虚函数会使对象多一个指针的空间. </p>
<p><img alt="虚函数表的机制(摘自C++ PrimerPlus)" src="../images/virtualFuncTable.png" /></p>
</details>
<h3 id="纯虚函数和抽象类">纯虚函数和抽象类<a class="headerlink" href="#纯虚函数和抽象类">&para;</a></h3>
<ul>
<li>
<p>纯虚函数没有实现;
    <code>virtual func(para) = 0;</code></p>
</li>
<li>
<p>有纯虚函数的基类或继承了纯虚函数(没有重写基类纯虚函数)的派生类被称为抽象类;</p>
</li>
<li>
<p><strong>抽象类不能实例化</strong>, 因此可以通过此方式实现强制规范, 让使用者必须实现指定的函数接口.</p>
</li>
</ul>
<p>纯虚函数只作为函数接口.</p>
<p><div class="language-cpp highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1"></a><a href="#__codelineno-26-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2"></a><a href="#__codelineno-26-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">std</span><span class="p">;</span>
</span><span id="__span-26-3"><a id="__codelineno-26-3" name="__codelineno-26-3"></a><a href="#__codelineno-26-3"><span class="linenos" data-linenos=" 3 "></span></a>
</span><span id="__span-26-4"><a id="__codelineno-26-4" name="__codelineno-26-4"></a><a href="#__codelineno-26-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="k">class</span><span class="w"> </span><span class="nc">XThread</span>
</span><span id="__span-26-5"><a id="__codelineno-26-5" name="__codelineno-26-5"></a><a href="#__codelineno-26-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="p">{</span>
</span><span id="__span-26-6"><a id="__codelineno-26-6" name="__codelineno-26-6"></a><a href="#__codelineno-26-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="k">public</span><span class="o">:</span>
</span><span id="__span-26-7"><a id="__codelineno-26-7" name="__codelineno-26-7"></a><a href="#__codelineno-26-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">Run</span><span class="p">()</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-26-8"><a id="__codelineno-26-8" name="__codelineno-26-8"></a><a href="#__codelineno-26-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">Start</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
</span><span id="__span-26-9"><a id="__codelineno-26-9" name="__codelineno-26-9"></a><a href="#__codelineno-26-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="w">        </span><span class="c1">//系统线程创建</span>
</span><span id="__span-26-10"><a id="__codelineno-26-10" name="__codelineno-26-10"></a><a href="#__codelineno-26-10"><span class="linenos" data-linenos="10 "></span></a><span class="w">        </span><span class="c1">//日志</span>
</span><span id="__span-26-11"><a id="__codelineno-26-11" name="__codelineno-26-11"></a><a href="#__codelineno-26-11"><span class="linenos" data-linenos="11 "></span></a><span class="w">        </span><span class="c1">//计时</span>
</span><span id="__span-26-12"><a id="__codelineno-26-12" name="__codelineno-26-12"></a><a href="#__codelineno-26-12"><span class="linenos" data-linenos="12 "></span></a><span class="w">        </span><span class="c1">//异常处理</span>
</span><span id="__span-26-13"><a id="__codelineno-26-13" name="__codelineno-26-13"></a><a href="#__codelineno-26-13"><span class="linenos" data-linenos="13 "></span></a><span class="w">        </span><span class="c1">//...</span>
</span><span id="__span-26-14"><a id="__codelineno-26-14" name="__codelineno-26-14"></a><a href="#__codelineno-26-14"><span class="linenos" data-linenos="14 "></span></a><span class="w">        </span><span class="n">Run</span><span class="p">();</span>
</span><span id="__span-26-15"><a id="__codelineno-26-15" name="__codelineno-26-15"></a><a href="#__codelineno-26-15"><span class="linenos" data-linenos="15 "></span></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-26-16"><a id="__codelineno-26-16" name="__codelineno-26-16"></a><a href="#__codelineno-26-16"><span class="linenos" data-linenos="16 "></span></a><span class="p">};</span>
</span><span id="__span-26-17"><a id="__codelineno-26-17" name="__codelineno-26-17"></a><a href="#__codelineno-26-17"><span class="linenos" data-linenos="17 "></span></a>
</span><span id="__span-26-18"><a id="__codelineno-26-18" name="__codelineno-26-18"></a><a href="#__codelineno-26-18"><span class="linenos" data-linenos="18 "></span></a><span class="k">class</span><span class="w"> </span><span class="nc">XTask</span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">XThread</span>
</span><span id="__span-26-19"><a id="__codelineno-26-19" name="__codelineno-26-19"></a><a href="#__codelineno-26-19"><span class="linenos" data-linenos="19 "></span></a><span class="p">{</span>
</span><span id="__span-26-20"><a id="__codelineno-26-20" name="__codelineno-26-20"></a><a href="#__codelineno-26-20"><span class="linenos" data-linenos="20 "></span></a><span class="k">protected</span><span class="o">:</span>
</span><span id="__span-26-21"><a id="__codelineno-26-21" name="__codelineno-26-21"></a><a href="#__codelineno-26-21"><span class="linenos" data-linenos="21 "></span></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">Run</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-26-22"><a id="__codelineno-26-22" name="__codelineno-26-22"></a><a href="#__codelineno-26-22"><span class="linenos" data-linenos="22 "></span></a><span class="w">        </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;XTask Run&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span>
</span><span id="__span-26-23"><a id="__codelineno-26-23" name="__codelineno-26-23"></a><a href="#__codelineno-26-23"><span class="linenos" data-linenos="23 "></span></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-26-24"><a id="__codelineno-26-24" name="__codelineno-26-24"></a><a href="#__codelineno-26-24"><span class="linenos" data-linenos="24 "></span></a><span class="p">};</span>
</span><span id="__span-26-25"><a id="__codelineno-26-25" name="__codelineno-26-25"></a><a href="#__codelineno-26-25"><span class="linenos" data-linenos="25 "></span></a>
</span><span id="__span-26-26"><a id="__codelineno-26-26" name="__codelineno-26-26"></a><a href="#__codelineno-26-26"><span class="linenos" data-linenos="26 "></span></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
</span><span id="__span-26-27"><a id="__codelineno-26-27" name="__codelineno-26-27"></a><a href="#__codelineno-26-27"><span class="linenos" data-linenos="27 "></span></a><span class="p">{</span>
</span><span id="__span-26-28"><a id="__codelineno-26-28" name="__codelineno-26-28"></a><a href="#__codelineno-26-28"><span class="linenos" data-linenos="28 "></span></a><span class="w">    </span><span class="n">XTask</span><span class="w"> </span><span class="n">task</span><span class="p">;</span>
</span><span id="__span-26-29"><a id="__codelineno-26-29" name="__codelineno-26-29"></a><a href="#__codelineno-26-29"><span class="linenos" data-linenos="29 "></span></a><span class="w">    </span><span class="n">task</span><span class="p">.</span><span class="n">Start</span><span class="p">();</span>
</span><span id="__span-26-30"><a id="__codelineno-26-30" name="__codelineno-26-30"></a><a href="#__codelineno-26-30"><span class="linenos" data-linenos="30 "></span></a>
</span><span id="__span-26-31"><a id="__codelineno-26-31" name="__codelineno-26-31"></a><a href="#__codelineno-26-31"><span class="linenos" data-linenos="31 "></span></a><span class="w">    </span><span class="n">XThread</span><span class="o">*</span><span class="w"> </span><span class="n">xt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">XTask</span><span class="p">();</span>
</span><span id="__span-26-32"><a id="__codelineno-26-32" name="__codelineno-26-32"></a><a href="#__codelineno-26-32"><span class="linenos" data-linenos="32 "></span></a><span class="w">    </span><span class="n">xt</span><span class="o">-&gt;</span><span class="n">Start</span><span class="p">();</span>
</span><span id="__span-26-33"><a id="__codelineno-26-33" name="__codelineno-26-33"></a><a href="#__codelineno-26-33"><span class="linenos" data-linenos="33 "></span></a><span class="p">}</span>
</span></code></pre></div>
<div class="language-text highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1"></a><a href="#__codelineno-27-1"><span class="linenos" data-linenos="1 "></span></a>XTask Run
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2"></a><a href="#__codelineno-27-2"><span class="linenos" data-linenos="2 "></span></a>XTask Run
</span></code></pre></div>
上述代码给出了一个纯虚函数的例子, 在这里我们设计了XThread抽象类, 这个类可能包装了一些线程管理的功能放在Start里, 但我们具体要执行的线程将放在Run里面, 这样就把用户定义的部分和库提供的功能很好地分开. 同时由于抽象类不可实例化, 就强制用户必须重写Run, 库函数提供者不对线程的具体执行负责. 同时一个基类也允许了诸如<code>vector&lt;XThread&gt;</code>或者<code>unique_ptr&lt;XThread&gt;</code>等写法, 使得代码可扩展性兼容性更好.</p>
<p>注意这里要清楚一点, 由于我们没有重写Start()且Start不是虚函数, <code>task.Start()</code>和<code>xt-&gt;Start()</code>都是静态绑定到的<code>XThread::Start()</code>. 而Start()内部的Run()调用在运行阶段根据实际类型判断绑定到<code>XTask.Run()</code>. </p>
<p>虽然基类不能访问派生类的private成员, 此处在访问控制时(编译期, 静态类型检查), Run()检查到的是<code>XThread::Run()</code>, 是基类自己的函成员函数, 所以通过了访问检查. 而运行时访问控制并不会再次启动, 所以运行时Start()内的Run()绑定到了<code>XTask::Run()</code></p>
<h3 id="常见坑-析构函数在绝大部分情况应设置为虚函数">常见坑: 析构函数在绝大部分情况应设置为虚函数<a class="headerlink" href="#常见坑-析构函数在绝大部分情况应设置为虚函数">&para;</a></h3>
<p><div class="language-cpp highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1"></a><a href="#__codelineno-28-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2"></a><a href="#__codelineno-28-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">std</span><span class="p">;</span>
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3"></a><a href="#__codelineno-28-3"><span class="linenos" data-linenos=" 3 "></span></a>
</span><span id="__span-28-4"><a id="__codelineno-28-4" name="__codelineno-28-4"></a><a href="#__codelineno-28-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="k">class</span><span class="w"> </span><span class="nc">XThread</span>
</span><span id="__span-28-5"><a id="__codelineno-28-5" name="__codelineno-28-5"></a><a href="#__codelineno-28-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="p">{</span>
</span><span id="__span-28-6"><a id="__codelineno-28-6" name="__codelineno-28-6"></a><a href="#__codelineno-28-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="k">public</span><span class="o">:</span>
</span><span id="__span-28-7"><a id="__codelineno-28-7" name="__codelineno-28-7"></a><a href="#__codelineno-28-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">Run</span><span class="p">()</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-28-8"><a id="__codelineno-28-8" name="__codelineno-28-8"></a><a href="#__codelineno-28-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">Start</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Run</span><span class="p">();}</span>
</span><span id="__span-28-9"><a id="__codelineno-28-9" name="__codelineno-28-9"></a><a href="#__codelineno-28-9"><span class="linenos" data-linenos=" 9 "></span></a>
</span><span id="__span-28-10"><a id="__codelineno-28-10" name="__codelineno-28-10"></a><a href="#__codelineno-28-10"><span class="linenos" data-linenos="10 "></span></a><span class="w">    </span><span class="n">XThread</span><span class="p">()</span>
</span><span id="__span-28-11"><a id="__codelineno-28-11" name="__codelineno-28-11"></a><a href="#__codelineno-28-11"><span class="linenos" data-linenos="11 "></span></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-28-12"><a id="__codelineno-28-12" name="__codelineno-28-12"></a><a href="#__codelineno-28-12"><span class="linenos" data-linenos="12 "></span></a><span class="w">        </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;ctor XThread&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span>
</span><span id="__span-28-13"><a id="__codelineno-28-13" name="__codelineno-28-13"></a><a href="#__codelineno-28-13"><span class="linenos" data-linenos="13 "></span></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-28-14"><a id="__codelineno-28-14" name="__codelineno-28-14"></a><a href="#__codelineno-28-14"><span class="linenos" data-linenos="14 "></span></a>
</span><span id="__span-28-15"><a id="__codelineno-28-15" name="__codelineno-28-15"></a><a href="#__codelineno-28-15"><span class="linenos" data-linenos="15 "></span></a><span class="w">    </span><span class="o">~</span><span class="n">XThread</span><span class="p">()</span><span class="w"> </span><span class="c1">//此处本应写为 virtual ~XThread()</span>
</span><span id="__span-28-16"><a id="__codelineno-28-16" name="__codelineno-28-16"></a><a href="#__codelineno-28-16"><span class="linenos" data-linenos="16 "></span></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-28-17"><a id="__codelineno-28-17" name="__codelineno-28-17"></a><a href="#__codelineno-28-17"><span class="linenos" data-linenos="17 "></span></a><span class="w">        </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;dtor XThread&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
</span><span id="__span-28-18"><a id="__codelineno-28-18" name="__codelineno-28-18"></a><a href="#__codelineno-28-18"><span class="linenos" data-linenos="18 "></span></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-28-19"><a id="__codelineno-28-19" name="__codelineno-28-19"></a><a href="#__codelineno-28-19"><span class="linenos" data-linenos="19 "></span></a><span class="p">};</span>
</span><span id="__span-28-20"><a id="__codelineno-28-20" name="__codelineno-28-20"></a><a href="#__codelineno-28-20"><span class="linenos" data-linenos="20 "></span></a>
</span><span id="__span-28-21"><a id="__codelineno-28-21" name="__codelineno-28-21"></a><a href="#__codelineno-28-21"><span class="linenos" data-linenos="21 "></span></a><span class="k">class</span><span class="w"> </span><span class="nc">XTask</span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">XThread</span>
</span><span id="__span-28-22"><a id="__codelineno-28-22" name="__codelineno-28-22"></a><a href="#__codelineno-28-22"><span class="linenos" data-linenos="22 "></span></a><span class="p">{</span>
</span><span id="__span-28-23"><a id="__codelineno-28-23" name="__codelineno-28-23"></a><a href="#__codelineno-28-23"><span class="linenos" data-linenos="23 "></span></a><span class="k">public</span><span class="o">:</span>
</span><span id="__span-28-24"><a id="__codelineno-28-24" name="__codelineno-28-24"></a><a href="#__codelineno-28-24"><span class="linenos" data-linenos="24 "></span></a><span class="w">    </span><span class="n">XTask</span><span class="p">()</span>
</span><span id="__span-28-25"><a id="__codelineno-28-25" name="__codelineno-28-25"></a><a href="#__codelineno-28-25"><span class="linenos" data-linenos="25 "></span></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-28-26"><a id="__codelineno-28-26" name="__codelineno-28-26"></a><a href="#__codelineno-28-26"><span class="linenos" data-linenos="26 "></span></a><span class="w">        </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;ctor XTask&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
</span><span id="__span-28-27"><a id="__codelineno-28-27" name="__codelineno-28-27"></a><a href="#__codelineno-28-27"><span class="linenos" data-linenos="27 "></span></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-28-28"><a id="__codelineno-28-28" name="__codelineno-28-28"></a><a href="#__codelineno-28-28"><span class="linenos" data-linenos="28 "></span></a><span class="w">    </span>
</span><span id="__span-28-29"><a id="__codelineno-28-29" name="__codelineno-28-29"></a><a href="#__codelineno-28-29"><span class="linenos" data-linenos="29 "></span></a><span class="w">    </span><span class="o">~</span><span class="n">XTask</span><span class="p">()</span>
</span><span id="__span-28-30"><a id="__codelineno-28-30" name="__codelineno-28-30"></a><a href="#__codelineno-28-30"><span class="linenos" data-linenos="30 "></span></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-28-31"><a id="__codelineno-28-31" name="__codelineno-28-31"></a><a href="#__codelineno-28-31"><span class="linenos" data-linenos="31 "></span></a><span class="w">        </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;dtor XTask&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
</span><span id="__span-28-32"><a id="__codelineno-28-32" name="__codelineno-28-32"></a><a href="#__codelineno-28-32"><span class="linenos" data-linenos="32 "></span></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-28-33"><a id="__codelineno-28-33" name="__codelineno-28-33"></a><a href="#__codelineno-28-33"><span class="linenos" data-linenos="33 "></span></a>
</span><span id="__span-28-34"><a id="__codelineno-28-34" name="__codelineno-28-34"></a><a href="#__codelineno-28-34"><span class="linenos" data-linenos="34 "></span></a><span class="k">private</span><span class="o">:</span>
</span><span id="__span-28-35"><a id="__codelineno-28-35" name="__codelineno-28-35"></a><a href="#__codelineno-28-35"><span class="linenos" data-linenos="35 "></span></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">Run</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-28-36"><a id="__codelineno-28-36" name="__codelineno-28-36"></a><a href="#__codelineno-28-36"><span class="linenos" data-linenos="36 "></span></a><span class="w">        </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;XTask Run&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span>
</span><span id="__span-28-37"><a id="__codelineno-28-37" name="__codelineno-28-37"></a><a href="#__codelineno-28-37"><span class="linenos" data-linenos="37 "></span></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-28-38"><a id="__codelineno-28-38" name="__codelineno-28-38"></a><a href="#__codelineno-28-38"><span class="linenos" data-linenos="38 "></span></a><span class="p">};</span>
</span><span id="__span-28-39"><a id="__codelineno-28-39" name="__codelineno-28-39"></a><a href="#__codelineno-28-39"><span class="linenos" data-linenos="39 "></span></a>
</span><span id="__span-28-40"><a id="__codelineno-28-40" name="__codelineno-28-40"></a><a href="#__codelineno-28-40"><span class="linenos" data-linenos="40 "></span></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
</span><span id="__span-28-41"><a id="__codelineno-28-41" name="__codelineno-28-41"></a><a href="#__codelineno-28-41"><span class="linenos" data-linenos="41 "></span></a><span class="p">{</span>
</span><span id="__span-28-42"><a id="__codelineno-28-42" name="__codelineno-28-42"></a><a href="#__codelineno-28-42"><span class="linenos" data-linenos="42 "></span></a><span class="w">    </span><span class="n">XThread</span><span class="o">*</span><span class="w"> </span><span class="n">xt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">XTask</span><span class="p">();</span>
</span><span id="__span-28-43"><a id="__codelineno-28-43" name="__codelineno-28-43"></a><a href="#__codelineno-28-43"><span class="linenos" data-linenos="43 "></span></a><span class="w">    </span><span class="k">delete</span><span class="w"> </span><span class="n">xt</span><span class="p">;</span>
</span><span id="__span-28-44"><a id="__codelineno-28-44" name="__codelineno-28-44"></a><a href="#__codelineno-28-44"><span class="linenos" data-linenos="44 "></span></a><span class="p">}</span>
</span></code></pre></div>
运行结果：
<div class="language-text highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1"></a><a href="#__codelineno-29-1"><span class="linenos" data-linenos="1 "></span></a>ctor XThread
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2"></a><a href="#__codelineno-29-2"><span class="linenos" data-linenos="2 "></span></a>ctor XTask
</span><span id="__span-29-3"><a id="__codelineno-29-3" name="__codelineno-29-3"></a><a href="#__codelineno-29-3"><span class="linenos" data-linenos="3 "></span></a>dtor XThread
</span></code></pre></div>
如上代码所示, 若非虚析构函数, ~XTask()将不会调用, 因为此时是静态绑定, 造成指针xt实际绑定到了~XThread(), 则只对XTask对象内存中属于XThread的部分进行了析构, 这就造成了内存泄露. </p>
<p>当我们改成<code>virtual ~XThread() {... ...}</code>, 才能成功析构XTask:
<div class="language-text highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1"></a><a href="#__codelineno-30-1"><span class="linenos" data-linenos="1 "></span></a>ctor XThread
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2"></a><a href="#__codelineno-30-2"><span class="linenos" data-linenos="2 "></span></a>ctor XTask
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3"></a><a href="#__codelineno-30-3"><span class="linenos" data-linenos="3 "></span></a>dtor XTask
</span><span id="__span-30-4"><a id="__codelineno-30-4" name="__codelineno-30-4"></a><a href="#__codelineno-30-4"><span class="linenos" data-linenos="4 "></span></a>dtor XThread
</span></code></pre></div></p>
<h2 id="#设计模式组合">设计模式: 组合 (has a)<a class="headerlink" href="##设计模式组合">&para;</a></h2>
<p>一个类A包含另一个类B的对象. 在使用类A的对象时, 不应该直接访问B例如<code>A.B.func()</code>, B类对象的所有需要的功能都应该通过A封装一层来访问.</p>
<details class="note" open="open">
<summary>组合还是继承?</summary>
<p>如果我希望一个类复用另一个类的代码并具有另一个类的某些功能, 组合和继承表面上都是可行的. 但是继承有更严格的判断标准, 当且仅当以下条件成立时才使用继承:</p>
<ol>
<li>is a 语义成立;</li>
<li>LSP可替换性(Liskov Substitution Principle)成立, 即将基类出现的地方均替换为子类, 不影响软件功能;</li>
<li>接口扩展而非裁剪: 派生类不应限制基类的大量接口. 要求对接口做限制意味着派生类只是与基类有&rdquo;相似&rdquo;性质, 而不满足&rdquo;派生类是基类&rdquo;.</li>
</ol>
<p>组合在逻辑上要求更宽松, 因此在以下情况下应当优先考虑组合:</p>
<ol>
<li>希望复用代码实现, 但不想继承函数接口;</li>
<li>
<p>需要高度受限的接口与很好的封装: 继承会暴露不该暴露的能力, &ldquo;让基类的成员函数func在派生类中禁用&rdquo;是不可行的且违背继承本意的. 
不论是声明private还是delete都无法阻止某个基类成员函数被访问, 这可以利用向上强制转换(upcasting)或者显式调用Base::func来做到:</p>
<div class="language-c++ highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1"></a><a href="#__codelineno-31-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2"></a><a href="#__codelineno-31-2"><span class="linenos" data-linenos=" 2 "></span></a>
</span><span id="__span-31-3"><a id="__codelineno-31-3" name="__codelineno-31-3"></a><a href="#__codelineno-31-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="k">struct</span><span class="w"> </span><span class="nc">Deque</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-31-4"><a id="__codelineno-31-4" name="__codelineno-31-4"></a><a href="#__codelineno-31-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">push_front</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Deque::push_front(int)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-31-5"><a id="__codelineno-31-5" name="__codelineno-31-5"></a><a href="#__codelineno-31-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">push_front</span><span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Deque::push_front(double)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-31-6"><a id="__codelineno-31-6" name="__codelineno-31-6"></a><a href="#__codelineno-31-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">push_back</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="w">     </span><span class="p">{</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Deque::push_back(int)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-31-7"><a id="__codelineno-31-7" name="__codelineno-31-7"></a><a href="#__codelineno-31-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="p">};</span>
</span><span id="__span-31-8"><a id="__codelineno-31-8" name="__codelineno-31-8"></a><a href="#__codelineno-31-8"><span class="linenos" data-linenos=" 8 "></span></a>
</span><span id="__span-31-9"><a id="__codelineno-31-9" name="__codelineno-31-9"></a><a href="#__codelineno-31-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="c1">// 方案1：在派生类里“禁用/删除”某个接口</span>
</span><span id="__span-31-10"><a id="__codelineno-31-10" name="__codelineno-31-10"></a><a href="#__codelineno-31-10"><span class="linenos" data-linenos="10 "></span></a><span class="k">struct</span><span class="w"> </span><span class="nc">Queue_Delete</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Deque</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-31-11"><a id="__codelineno-31-11" name="__codelineno-31-11"></a><a href="#__codelineno-31-11"><span class="linenos" data-linenos="11 "></span></a><span class="w">    </span><span class="k">using</span><span class="w"> </span><span class="n">Deque</span><span class="o">::</span><span class="n">push_front</span><span class="p">;</span><span class="w">      </span><span class="c1">// 把基类重载集合引入（否则会被隐藏）</span>
</span><span id="__span-31-12"><a id="__codelineno-31-12" name="__codelineno-31-12"></a><a href="#__codelineno-31-12"><span class="linenos" data-linenos="12 "></span></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">push_front</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">delete</span><span class="p">;</span><span class="w"> </span><span class="c1">// 试图禁用 int 版本（队列不想要）</span>
</span><span id="__span-31-13"><a id="__codelineno-31-13" name="__codelineno-31-13"></a><a href="#__codelineno-31-13"><span class="linenos" data-linenos="13 "></span></a><span class="p">};</span>
</span><span id="__span-31-14"><a id="__codelineno-31-14" name="__codelineno-31-14"></a><a href="#__codelineno-31-14"><span class="linenos" data-linenos="14 "></span></a>
</span><span id="__span-31-15"><a id="__codelineno-31-15" name="__codelineno-31-15"></a><a href="#__codelineno-31-15"><span class="linenos" data-linenos="15 "></span></a><span class="c1">// 方案2：在派生类里“私有化”某个接口</span>
</span><span id="__span-31-16"><a id="__codelineno-31-16" name="__codelineno-31-16"></a><a href="#__codelineno-31-16"><span class="linenos" data-linenos="16 "></span></a><span class="k">struct</span><span class="w"> </span><span class="nc">Queue_Private</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Deque</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-31-17"><a id="__codelineno-31-17" name="__codelineno-31-17"></a><a href="#__codelineno-31-17"><span class="linenos" data-linenos="17 "></span></a><span class="k">private</span><span class="o">:</span>
</span><span id="__span-31-18"><a id="__codelineno-31-18" name="__codelineno-31-18"></a><a href="#__codelineno-31-18"><span class="linenos" data-linenos="18 "></span></a><span class="w">    </span><span class="k">using</span><span class="w"> </span><span class="n">Deque</span><span class="o">::</span><span class="n">push_front</span><span class="p">;</span><span class="w">  </span><span class="c1">// 只是在 Queue_Private 的作用域里变成 private</span>
</span><span id="__span-31-19"><a id="__codelineno-31-19" name="__codelineno-31-19"></a><a href="#__codelineno-31-19"><span class="linenos" data-linenos="19 "></span></a><span class="k">public</span><span class="o">:</span>
</span><span id="__span-31-20"><a id="__codelineno-31-20" name="__codelineno-31-20"></a><a href="#__codelineno-31-20"><span class="linenos" data-linenos="20 "></span></a><span class="w">    </span><span class="k">using</span><span class="w"> </span><span class="n">Deque</span><span class="o">::</span><span class="n">push_back</span><span class="p">;</span>
</span><span id="__span-31-21"><a id="__codelineno-31-21" name="__codelineno-31-21"></a><a href="#__codelineno-31-21"><span class="linenos" data-linenos="21 "></span></a><span class="p">};</span>
</span><span id="__span-31-22"><a id="__codelineno-31-22" name="__codelineno-31-22"></a><a href="#__codelineno-31-22"><span class="linenos" data-linenos="22 "></span></a>
</span><span id="__span-31-23"><a id="__codelineno-31-23" name="__codelineno-31-23"></a><a href="#__codelineno-31-23"><span class="linenos" data-linenos="23 "></span></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-31-24"><a id="__codelineno-31-24" name="__codelineno-31-24"></a><a href="#__codelineno-31-24"><span class="linenos" data-linenos="24 "></span></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;=== delete 方案 ===</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span id="__span-31-25"><a id="__codelineno-31-25" name="__codelineno-31-25"></a><a href="#__codelineno-31-25"><span class="linenos" data-linenos="25 "></span></a><span class="w">    </span><span class="n">Queue_Delete</span><span class="w"> </span><span class="n">q1</span><span class="p">;</span>
</span><span id="__span-31-26"><a id="__codelineno-31-26" name="__codelineno-31-26"></a><a href="#__codelineno-31-26"><span class="linenos" data-linenos="26 "></span></a><span class="w">    </span><span class="n">q1</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span><span id="__span-31-27"><a id="__codelineno-31-27" name="__codelineno-31-27"></a><a href="#__codelineno-31-27"><span class="linenos" data-linenos="27 "></span></a>
</span><span id="__span-31-28"><a id="__codelineno-31-28" name="__codelineno-31-28"></a><a href="#__codelineno-31-28"><span class="linenos" data-linenos="28 "></span></a><span class="w">    </span><span class="c1">// q1.push_front(1);     // 编译期报错：已 delete</span>
</span><span id="__span-31-29"><a id="__codelineno-31-29" name="__codelineno-31-29"></a><a href="#__codelineno-31-29"><span class="linenos" data-linenos="29 "></span></a><span class="w">    </span><span class="n">q1</span><span class="p">.</span><span class="n">push_front</span><span class="p">(</span><span class="mf">3.14</span><span class="p">);</span><span class="w">     </span><span class="c1">// OK：double 版本仍可用</span>
</span><span id="__span-31-30"><a id="__codelineno-31-30" name="__codelineno-31-30"></a><a href="#__codelineno-31-30"><span class="linenos" data-linenos="30 "></span></a>
</span><span id="__span-31-31"><a id="__codelineno-31-31" name="__codelineno-31-31"></a><a href="#__codelineno-31-31"><span class="linenos" data-linenos="31 "></span></a><span class="w">    </span><span class="n">Deque</span><span class="o">&amp;</span><span class="w"> </span><span class="n">b1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">q1</span><span class="p">;</span><span class="w">          </span><span class="c1">// 关键：上行转换</span>
</span><span id="__span-31-32"><a id="__codelineno-31-32" name="__codelineno-31-32"></a><a href="#__codelineno-31-32"><span class="linenos" data-linenos="32 "></span></a><span class="w">    </span><span class="n">b1</span><span class="p">.</span><span class="n">push_front</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w">        </span><span class="c1">// OK！直接调用基类接口（队列不变量被破坏）</span>
</span><span id="__span-31-33"><a id="__codelineno-31-33" name="__codelineno-31-33"></a><a href="#__codelineno-31-33"><span class="linenos" data-linenos="33 "></span></a><span class="w">    </span><span class="n">q1</span><span class="p">.</span><span class="n">Deque</span><span class="o">::</span><span class="n">push_front</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w"> </span><span class="c1">// OK！显式限定到基类作用域，同样绕过（不变量被破坏）</span>
</span><span id="__span-31-34"><a id="__codelineno-31-34" name="__codelineno-31-34"></a><a href="#__codelineno-31-34"><span class="linenos" data-linenos="34 "></span></a>
</span><span id="__span-31-35"><a id="__codelineno-31-35" name="__codelineno-31-35"></a><a href="#__codelineno-31-35"><span class="linenos" data-linenos="35 "></span></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">=== private 方案 ===</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span id="__span-31-36"><a id="__codelineno-31-36" name="__codelineno-31-36"></a><a href="#__codelineno-31-36"><span class="linenos" data-linenos="36 "></span></a><span class="w">    </span><span class="n">Queue_Private</span><span class="w"> </span><span class="n">q2</span><span class="p">;</span>
</span><span id="__span-31-37"><a id="__codelineno-31-37" name="__codelineno-31-37"></a><a href="#__codelineno-31-37"><span class="linenos" data-linenos="37 "></span></a><span class="w">    </span><span class="n">q2</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
</span><span id="__span-31-38"><a id="__codelineno-31-38" name="__codelineno-31-38"></a><a href="#__codelineno-31-38"><span class="linenos" data-linenos="38 "></span></a>
</span><span id="__span-31-39"><a id="__codelineno-31-39" name="__codelineno-31-39"></a><a href="#__codelineno-31-39"><span class="linenos" data-linenos="39 "></span></a><span class="w">    </span><span class="c1">// q2.push_front(2);     // 编译期报错：在派生类作用域里是 private</span>
</span><span id="__span-31-40"><a id="__codelineno-31-40" name="__codelineno-31-40"></a><a href="#__codelineno-31-40"><span class="linenos" data-linenos="40 "></span></a>
</span><span id="__span-31-41"><a id="__codelineno-31-41" name="__codelineno-31-41"></a><a href="#__codelineno-31-41"><span class="linenos" data-linenos="41 "></span></a><span class="w">    </span><span class="n">Deque</span><span class="o">&amp;</span><span class="w"> </span><span class="n">b2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">q2</span><span class="p">;</span><span class="w">          </span><span class="c1">// 再次上行转换</span>
</span><span id="__span-31-42"><a id="__codelineno-31-42" name="__codelineno-31-42"></a><a href="#__codelineno-31-42"><span class="linenos" data-linenos="42 "></span></a><span class="w">    </span><span class="n">b2</span><span class="p">.</span><span class="n">push_front</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span><span class="w">        </span><span class="c1">// OK！仍然能从基类视角调用</span>
</span><span id="__span-31-43"><a id="__codelineno-31-43" name="__codelineno-31-43"></a><a href="#__codelineno-31-43"><span class="linenos" data-linenos="43 "></span></a><span class="w">    </span><span class="n">q2</span><span class="p">.</span><span class="n">Deque</span><span class="o">::</span><span class="n">push_front</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span><span class="w"> </span><span class="c1">// OK！显式限定到基类作用域也能调用</span>
</span><span id="__span-31-44"><a id="__codelineno-31-44" name="__codelineno-31-44"></a><a href="#__codelineno-31-44"><span class="linenos" data-linenos="44 "></span></a><span class="p">}</span>
</span></code></pre></div>
</li>
<li>
<p>希望未来保持底层的可替换性: 组合是一种接口, 当我需要换掉组合内部的类, 只需要改组合类的定义而无需改变任何业务代码, 因为我们没有直接使用组合内部的类的功能. 而若使用继承, 我们很可能在业务代码里使用了基类的功能, 换掉基类则很可能需要修改业务代码.</p>
</li>
</ol>
<p>一个例子是标准库的queue和deque, queue不是一种deque因为不满足deque的双端性质, queue希望严格FIFO行为不希望用户调用push_front, queue在底层使用deque时需要限制接口而非扩展接口, queue希望在底层能够替换为list以适配某些场景. 所以queue和deque是组合关系.</p>
</details>
<h3 id="设计模式-工厂类">设计模式: 工厂类<a class="headerlink" href="#设计模式-工厂类">&para;</a></h3>
<p>Logger与LogFac之间是组合关系.
<div class="language-c++ highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1"></a><a href="#__codelineno-32-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="k">class</span><span class="w"> </span><span class="nc">Logger</span>
</span><span id="__span-32-2"><a id="__codelineno-32-2" name="__codelineno-32-2"></a><a href="#__codelineno-32-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="p">{</span>
</span><span id="__span-32-3"><a id="__codelineno-32-3" name="__codelineno-32-3"></a><a href="#__codelineno-32-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="k">public</span><span class="o">:</span>
</span><span id="__span-32-4"><a id="__codelineno-32-4" name="__codelineno-32-4"></a><a href="#__codelineno-32-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="w">    </span><span class="n">Logger</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Create Logger</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;}</span>
</span><span id="__span-32-5"><a id="__codelineno-32-5" name="__codelineno-32-5"></a><a href="#__codelineno-32-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="w">    </span><span class="o">~</span><span class="n">Logger</span><span class="p">(){</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Drop Logger</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;}</span>
</span><span id="__span-32-6"><a id="__codelineno-32-6" name="__codelineno-32-6"></a><a href="#__codelineno-32-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="p">};</span>
</span><span id="__span-32-7"><a id="__codelineno-32-7" name="__codelineno-32-7"></a><a href="#__codelineno-32-7"><span class="linenos" data-linenos=" 7 "></span></a>
</span><span id="__span-32-8"><a id="__codelineno-32-8" name="__codelineno-32-8"></a><a href="#__codelineno-32-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="k">class</span><span class="w"> </span><span class="nc">LogFac</span><span class="w"> </span><span class="c1">//工厂 单件模式 私有化构造函数</span>
</span><span id="__span-32-9"><a id="__codelineno-32-9" name="__codelineno-32-9"></a><a href="#__codelineno-32-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="p">{</span>
</span><span id="__span-32-10"><a id="__codelineno-32-10" name="__codelineno-32-10"></a><a href="#__codelineno-32-10"><span class="linenos" data-linenos="10 "></span></a><span class="k">public</span><span class="o">:</span>
</span><span id="__span-32-11"><a id="__codelineno-32-11" name="__codelineno-32-11"></a><a href="#__codelineno-32-11"><span class="linenos" data-linenos="11 "></span></a><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="n">LogFac</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Instance</span><span class="p">(){</span>
</span><span id="__span-32-12"><a id="__codelineno-32-12" name="__codelineno-32-12"></a><a href="#__codelineno-32-12"><span class="linenos" data-linenos="12 "></span></a><span class="w">        </span><span class="k">static</span><span class="w"> </span><span class="n">LogFac</span><span class="w"> </span><span class="n">fac</span><span class="p">;</span>
</span><span id="__span-32-13"><a id="__codelineno-32-13" name="__codelineno-32-13"></a><a href="#__codelineno-32-13"><span class="linenos" data-linenos="13 "></span></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">fac</span><span class="p">;</span>
</span><span id="__span-32-14"><a id="__codelineno-32-14" name="__codelineno-32-14"></a><a href="#__codelineno-32-14"><span class="linenos" data-linenos="14 "></span></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-32-15"><a id="__codelineno-32-15" name="__codelineno-32-15"></a><a href="#__codelineno-32-15"><span class="linenos" data-linenos="15 "></span></a>
</span><span id="__span-32-16"><a id="__codelineno-32-16" name="__codelineno-32-16"></a><a href="#__codelineno-32-16"><span class="linenos" data-linenos="16 "></span></a><span class="w">    </span><span class="n">Logger</span><span class="o">&amp;</span><span class="w"> </span><span class="n">GetLogger</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">logger_</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="c1">//返回Logger类的引用, 避免拷贝构造.</span>
</span><span id="__span-32-17"><a id="__codelineno-32-17" name="__codelineno-32-17"></a><a href="#__codelineno-32-17"><span class="linenos" data-linenos="17 "></span></a><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">Logger</span><span class="o">&amp;</span><span class="w"> </span><span class="n">GetLogger</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">logger_</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="c1">//为什么要有const? 因为当LogFac是const对象时, 其只能访问const函数(确保不会修改对象自身).且因为Logger作为const对象的一部分自然也必须是const. </span>
</span><span id="__span-32-18"><a id="__codelineno-32-18" name="__codelineno-32-18"></a><a href="#__codelineno-32-18"><span class="linenos" data-linenos="18 "></span></a>
</span><span id="__span-32-19"><a id="__codelineno-32-19" name="__codelineno-32-19"></a><a href="#__codelineno-32-19"><span class="linenos" data-linenos="19 "></span></a><span class="w">    </span><span class="o">~</span><span class="n">LogFac</span><span class="p">(){</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Drop LogFac</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;}</span>
</span><span id="__span-32-20"><a id="__codelineno-32-20" name="__codelineno-32-20"></a><a href="#__codelineno-32-20"><span class="linenos" data-linenos="20 "></span></a><span class="k">private</span><span class="o">:</span>
</span><span id="__span-32-21"><a id="__codelineno-32-21" name="__codelineno-32-21"></a><a href="#__codelineno-32-21"><span class="linenos" data-linenos="21 "></span></a><span class="w">    </span><span class="n">LogFac</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Create LogFac</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;}</span>
</span><span id="__span-32-22"><a id="__codelineno-32-22" name="__codelineno-32-22"></a><a href="#__codelineno-32-22"><span class="linenos" data-linenos="22 "></span></a><span class="w">    </span><span class="n">Logger</span><span class="w"> </span><span class="n">logger_</span><span class="p">;</span>
</span><span id="__span-32-23"><a id="__codelineno-32-23" name="__codelineno-32-23"></a><a href="#__codelineno-32-23"><span class="linenos" data-linenos="23 "></span></a><span class="p">};</span>
</span><span id="__span-32-24"><a id="__codelineno-32-24" name="__codelineno-32-24"></a><a href="#__codelineno-32-24"><span class="linenos" data-linenos="24 "></span></a>
</span><span id="__span-32-25"><a id="__codelineno-32-25" name="__codelineno-32-25"></a><a href="#__codelineno-32-25"><span class="linenos" data-linenos="25 "></span></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(){</span>
</span><span id="__span-32-26"><a id="__codelineno-32-26" name="__codelineno-32-26"></a><a href="#__codelineno-32-26"><span class="linenos" data-linenos="26 "></span></a><span class="w">    </span><span class="n">LogFac</span><span class="o">&amp;</span><span class="w"> </span><span class="n">fac</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LogFac</span><span class="o">::</span><span class="n">Instance</span><span class="p">();</span>
</span><span id="__span-32-27"><a id="__codelineno-32-27" name="__codelineno-32-27"></a><a href="#__codelineno-32-27"><span class="linenos" data-linenos="27 "></span></a><span class="w">    </span><span class="n">Logger</span><span class="o">&amp;</span><span class="w"> </span><span class="n">lg</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">fac</span><span class="p">.</span><span class="n">GetLogger</span><span class="p">();</span>
</span><span id="__span-32-28"><a id="__codelineno-32-28" name="__codelineno-32-28"></a><a href="#__codelineno-32-28"><span class="linenos" data-linenos="28 "></span></a><span class="p">}</span>
</span></code></pre></div></p>
<h2 id="组合的另一种实现-委托">组合的另一种实现: 委托<a class="headerlink" href="#组合的另一种实现-委托">&para;</a></h2>
<p>一个类包含另一个类的引用或指针. 委托是一种特殊的的组合.</p>
<ul>
<li>
<p>对象组合更强调 <strong>&ldquo;组成关系&rdquo;(ownership)</strong> 与 <strong>&ldquo;生命周期绑定&rdquo;</strong>, 组合的对象是值语义/实体语义的, 其实现往往是固定的, 没有动态绑定和虚函数调用等. 其&rdquo;has a&rdquo;的语义更明确.</p>
</li>
<li>
<p>委托更强调 <strong>&ldquo;职责转交&rdquo;</strong> 与 <strong>&ldquo;动态可替换&rdquo;</strong>. 委托常需要在<strong>运行时</strong>切换行为, 常用于实现某种可替换的外部能力, 且可以很容易地通过新增一个子类(而非修改原类型)来进行扩展.</p>
</li>
</ul>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1"></a><a href="#__codelineno-33-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="c1">//接口类</span>
</span><span id="__span-33-2"><a id="__codelineno-33-2" name="__codelineno-33-2"></a><a href="#__codelineno-33-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="k">class</span><span class="w"> </span><span class="nc">LogOutput</span>
</span><span id="__span-33-3"><a id="__codelineno-33-3" name="__codelineno-33-3"></a><a href="#__codelineno-33-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="p">{</span>
</span><span id="__span-33-4"><a id="__codelineno-33-4" name="__codelineno-33-4"></a><a href="#__codelineno-33-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="k">public</span><span class="o">:</span><span class="c1">//日志输出</span>
</span><span id="__span-33-5"><a id="__codelineno-33-5" name="__codelineno-33-5"></a><a href="#__codelineno-33-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">Output</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">log</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-33-6"><a id="__codelineno-33-6" name="__codelineno-33-6"></a><a href="#__codelineno-33-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="w">    </span><span class="c1">//纯虚函数, 常引用传参</span>
</span><span id="__span-33-7"><a id="__codelineno-33-7" name="__codelineno-33-7"></a><a href="#__codelineno-33-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="p">};</span>
</span><span id="__span-33-8"><a id="__codelineno-33-8" name="__codelineno-33-8"></a><a href="#__codelineno-33-8"><span class="linenos" data-linenos=" 8 "></span></a>
</span><span id="__span-33-9"><a id="__codelineno-33-9" name="__codelineno-33-9"></a><a href="#__codelineno-33-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="k">class</span><span class="w"> </span><span class="nc">LogConsoleOutput</span><span class="o">:</span><span class="k">public</span><span class="w"> </span><span class="n">LogOutput</span>
</span><span id="__span-33-10"><a id="__codelineno-33-10" name="__codelineno-33-10"></a><a href="#__codelineno-33-10"><span class="linenos" data-linenos="10 "></span></a><span class="p">{</span>
</span><span id="__span-33-11"><a id="__codelineno-33-11" name="__codelineno-33-11"></a><a href="#__codelineno-33-11"><span class="linenos" data-linenos="11 "></span></a><span class="k">public</span><span class="o">:</span>
</span><span id="__span-33-12"><a id="__codelineno-33-12" name="__codelineno-33-12"></a><a href="#__codelineno-33-12"><span class="linenos" data-linenos="12 "></span></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">Output</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">log</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="p">{</span>
</span><span id="__span-33-13"><a id="__codelineno-33-13" name="__codelineno-33-13"></a><a href="#__codelineno-33-13"><span class="linenos" data-linenos="13 "></span></a><span class="w">        </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">log</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
</span><span id="__span-33-14"><a id="__codelineno-33-14" name="__codelineno-33-14"></a><a href="#__codelineno-33-14"><span class="linenos" data-linenos="14 "></span></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-33-15"><a id="__codelineno-33-15" name="__codelineno-33-15"></a><a href="#__codelineno-33-15"><span class="linenos" data-linenos="15 "></span></a><span class="p">};</span>
</span><span id="__span-33-16"><a id="__codelineno-33-16" name="__codelineno-33-16"></a><a href="#__codelineno-33-16"><span class="linenos" data-linenos="16 "></span></a>
</span><span id="__span-33-17"><a id="__codelineno-33-17" name="__codelineno-33-17"></a><a href="#__codelineno-33-17"><span class="linenos" data-linenos="17 "></span></a><span class="k">class</span><span class="w"> </span><span class="nc">LogFileOutput</span><span class="o">:</span><span class="k">public</span><span class="w"> </span><span class="n">LogOutput</span>
</span><span id="__span-33-18"><a id="__codelineno-33-18" name="__codelineno-33-18"></a><a href="#__codelineno-33-18"><span class="linenos" data-linenos="18 "></span></a><span class="p">{</span>
</span><span id="__span-33-19"><a id="__codelineno-33-19" name="__codelineno-33-19"></a><a href="#__codelineno-33-19"><span class="linenos" data-linenos="19 "></span></a><span class="w">    </span><span class="p">...</span><span class="w"> </span><span class="p">...</span>
</span><span id="__span-33-20"><a id="__codelineno-33-20" name="__codelineno-33-20"></a><a href="#__codelineno-33-20"><span class="linenos" data-linenos="20 "></span></a><span class="p">};</span>
</span><span id="__span-33-21"><a id="__codelineno-33-21" name="__codelineno-33-21"></a><a href="#__codelineno-33-21"><span class="linenos" data-linenos="21 "></span></a>
</span><span id="__span-33-22"><a id="__codelineno-33-22" name="__codelineno-33-22"></a><a href="#__codelineno-33-22"><span class="linenos" data-linenos="22 "></span></a><span class="k">class</span><span class="w"> </span><span class="nc">Logger</span><span class="p">{</span>
</span><span id="__span-33-23"><a id="__codelineno-33-23" name="__codelineno-33-23"></a><a href="#__codelineno-33-23"><span class="linenos" data-linenos="23 "></span></a><span class="k">public</span><span class="o">:</span>
</span><span id="__span-33-24"><a id="__codelineno-33-24" name="__codelineno-33-24"></a><a href="#__codelineno-33-24"><span class="linenos" data-linenos="24 "></span></a><span class="w">    </span><span class="n">Logger</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Create Logger</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;}</span>
</span><span id="__span-33-25"><a id="__codelineno-33-25" name="__codelineno-33-25"></a><a href="#__codelineno-33-25"><span class="linenos" data-linenos="25 "></span></a><span class="w">    </span><span class="o">~</span><span class="n">Logger</span><span class="p">(){</span>
</span><span id="__span-33-26"><a id="__codelineno-33-26" name="__codelineno-33-26"></a><a href="#__codelineno-33-26"><span class="linenos" data-linenos="26 "></span></a><span class="w">        </span><span class="k">delete</span><span class="w"> </span><span class="n">output_</span><span class="p">;</span><span class="w">          </span><span class="c1">//注意有指针要记得delete!</span>
</span><span id="__span-33-27"><a id="__codelineno-33-27" name="__codelineno-33-27"></a><a href="#__codelineno-33-27"><span class="linenos" data-linenos="27 "></span></a><span class="w">        </span><span class="n">output_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span><span class="w">       </span><span class="c1">//delete之后防止悬空</span>
</span><span id="__span-33-28"><a id="__codelineno-33-28" name="__codelineno-33-28"></a><a href="#__codelineno-33-28"><span class="linenos" data-linenos="28 "></span></a><span class="w">        </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Drop Logger</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span id="__span-33-29"><a id="__codelineno-33-29" name="__codelineno-33-29"></a><a href="#__codelineno-33-29"><span class="linenos" data-linenos="29 "></span></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-33-30"><a id="__codelineno-33-30" name="__codelineno-33-30"></a><a href="#__codelineno-33-30"><span class="linenos" data-linenos="30 "></span></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">Write</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">log</span><span class="p">){</span>
</span><span id="__span-33-31"><a id="__codelineno-33-31" name="__codelineno-33-31"></a><a href="#__codelineno-33-31"><span class="linenos" data-linenos="31 "></span></a><span class="w">        </span><span class="n">output_</span><span class="o">-&gt;</span><span class="n">Output</span><span class="p">(</span><span class="n">log</span><span class="p">);</span>
</span><span id="__span-33-32"><a id="__codelineno-33-32" name="__codelineno-33-32"></a><a href="#__codelineno-33-32"><span class="linenos" data-linenos="32 "></span></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-33-33"><a id="__codelineno-33-33" name="__codelineno-33-33"></a><a href="#__codelineno-33-33"><span class="linenos" data-linenos="33 "></span></a><span class="w">    </span><span class="c1">// 设置委托</span>
</span><span id="__span-33-34"><a id="__codelineno-33-34" name="__codelineno-33-34"></a><a href="#__codelineno-33-34"><span class="linenos" data-linenos="34 "></span></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">SetOutput</span><span class="p">(</span><span class="n">LogOutput</span><span class="o">*</span><span class="w"> </span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="n">output_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">out</span><span class="p">;}</span>
</span><span id="__span-33-35"><a id="__codelineno-33-35" name="__codelineno-33-35"></a><a href="#__codelineno-33-35"><span class="linenos" data-linenos="35 "></span></a><span class="k">private</span><span class="o">:</span>
</span><span id="__span-33-36"><a id="__codelineno-33-36" name="__codelineno-33-36"></a><a href="#__codelineno-33-36"><span class="linenos" data-linenos="36 "></span></a><span class="w">    </span><span class="n">LogOutput</span><span class="o">*</span><span class="w"> </span><span class="n">output_</span><span class="p">{</span><span class="k">nullptr</span><span class="p">};</span><span class="w"> </span><span class="c1">//指针要初始化!</span>
</span><span id="__span-33-37"><a id="__codelineno-33-37" name="__codelineno-33-37"></a><a href="#__codelineno-33-37"><span class="linenos" data-linenos="37 "></span></a><span class="p">};</span>
</span><span id="__span-33-38"><a id="__codelineno-33-38" name="__codelineno-33-38"></a><a href="#__codelineno-33-38"><span class="linenos" data-linenos="38 "></span></a>
</span><span id="__span-33-39"><a id="__codelineno-33-39" name="__codelineno-33-39"></a><a href="#__codelineno-33-39"><span class="linenos" data-linenos="39 "></span></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(){</span>
</span><span id="__span-33-40"><a id="__codelineno-33-40" name="__codelineno-33-40"></a><a href="#__codelineno-33-40"><span class="linenos" data-linenos="40 "></span></a><span class="w">    </span><span class="n">LogFac</span><span class="o">&amp;</span><span class="w"> </span><span class="n">fac</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LogFac</span><span class="o">::</span><span class="n">Instance</span><span class="p">();</span>
</span><span id="__span-33-41"><a id="__codelineno-33-41" name="__codelineno-33-41"></a><a href="#__codelineno-33-41"><span class="linenos" data-linenos="41 "></span></a><span class="w">    </span><span class="n">Logger</span><span class="o">&amp;</span><span class="w"> </span><span class="n">logger</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fac</span><span class="p">.</span><span class="n">GetLogger</span><span class="p">();</span>
</span><span id="__span-33-42"><a id="__codelineno-33-42" name="__codelineno-33-42"></a><a href="#__codelineno-33-42"><span class="linenos" data-linenos="42 "></span></a><span class="w">    </span><span class="n">logger</span><span class="p">.</span><span class="n">SetOutput</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">LogConsoleOutput</span><span class="p">());</span>
</span><span id="__span-33-43"><a id="__codelineno-33-43" name="__codelineno-33-43"></a><a href="#__codelineno-33-43"><span class="linenos" data-linenos="43 "></span></a><span class="w">    </span><span class="n">logger</span><span class="p">.</span><span class="n">Write</span><span class="p">(</span><span class="s">&quot;test console log&quot;</span><span class="p">);</span>
</span><span id="__span-33-44"><a id="__codelineno-33-44" name="__codelineno-33-44"></a><a href="#__codelineno-33-44"><span class="linenos" data-linenos="44 "></span></a><span class="p">};</span>
</span></code></pre></div>
<p>通过委托, logger可以调用不同的Output后端. 虽然这里使用了<code>new LogConsoleOutput()</code>来进行配置, 实际上可以使用配置文件, 从而更加彻底地解耦代码和配置. 当我们需要扩展一种输出设备, 也只需新增一个LogOutput的子类, 不需要对Logger类进行任何修改, 这对应了面向对象开发的&rdquo;开闭原则(Open Close Principle)&rdquo;, 即对扩展开放, 对修改关闭.</p>
<h2 id="使用继承组合委托实现日志类">使用继承、组合/委托实现日志类<a class="headerlink" href="#使用继承组合委托实现日志类">&para;</a></h2>
<p><img alt="alt text" src="../images/uml_graph.png" />
1. 图中, 实线+空心三角形箭头, 箭头指向父类/接口.
    图中两组继承关系：
    - <code>LogFileOutput</code>、<code>LogConsoleOutput</code> 继承 <code>LogOutput</code>
    - <code>XLogFormat</code> 继承 <code>LogFormat</code></p>
<div class="language-text highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>`LogOutput::Output()`、`LogFormat::Format()` 是抽象基类/接口（`virtual ... = 0;`），子类实现具体行为。
</code></pre></div>
<ol>
<li>
<p>图中, 实线 + 实心菱形（黑菱形）, 菱形所在端是“整体/拥有者”，表示强拥有关系(组合).</p>
<ul>
<li>整体负责部件生命周期（整体销毁，部件也随之销毁）</li>
<li>通常对应 C++ 里的成员对象或独占所有权（如 std::unique_ptr）</li>
</ul>
<p>图中的两处组合关系:
- <code>Logger</code> 组合 <code>LogOutput</code> 与 <code>LogFormat</code>, <code>Logger</code> 内部“拥有”一个 <code>LogOutput</code> 和一个 <code>LogFormat</code>（has-a语义）.由于<code>LogOutput</code>与<code>LogFormat</code>是可替换的&rdquo;功能&rdquo;而非值语义的&rdquo;组成部件&rdquo;, 所以可以采用委托. 
- <code>LogFac</code>组合<code>Logger</code>, 单例模式, 采用对象组合.</p>
</li>
<li>
<p>实线 + 普通箭头表示依赖/创建/装配。
    图里 <code>LogFac</code> 向下指向：<code>LogFileOutput</code>, <code>LogConsoleOutput</code>, <code>XLogFormat</code>, 含义是：<code>LogFac::Init()</code> 会创建/选择这些具体策略对象，并把它们装配进 <code>Logger</code>.</p>
</li>
</ol>


<!-- Comment system -->
<!-- 对所有非主页页面启用comment-->
 
    <h2 id="__comments">评论</h2>
    <!-- Insert generated snippet here -->
    <script src="https://giscus.app/client.js"
        data-repo="ScottCheung930/Scott930Website"
        data-repo-id="R_kgDON95dXw"
        data-category="Announcements"
        data-category-id="DIC_kwDON95dX84CnPj9"
        data-mapping="url"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="bottom"
        data-theme="preferred_color_scheme"
        data-lang="zh-CN"
        crossorigin="anonymous" async>
    </script>

    <!-- Synchronize Giscus theme with palette -->
    <script>
        var giscus = document.querySelector("script[src*=giscus]")

        // Set palette on initial load
        var palette = __md_get("__palette")
        if (palette && typeof palette.color === "object") {
            var theme = palette.color.scheme === "slate"
                ? "transparent_dark"
                : "light"

            // Instruct Giscus to set theme
            giscus.setAttribute("data-theme", theme)
        }

        // Register event handlers after documented loaded
        document.addEventListener("DOMContentLoaded", function () {
            var ref = document.querySelector("[data-md-component=palette]")
            ref.addEventListener("change", function () {
                var palette = __md_get("__palette")
                if (palette && typeof palette.color === "object") {
                    var theme = palette.color.scheme === "slate"
                        ? "transparent_dark"
                        : "light"

                    // Instruct Giscus to change theme
                    var frame = document.querySelector(".giscus-frame")
                    frame.contentWindow.postMessage(
                        { giscus: { setConfig: { theme } } },
                        "https://giscus.app"
                    )
                }
            })
        })
    </script>

                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2025 ScottCheung930
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.tabs.prune", "navigation.expand", "navigation.path", "navigation.indexes", "content.code.annotate", "content.action.edit", "content.action.view", "content.code.copy", "content.tooltips"], "search": "../../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="../../../javascripts/extra.js"></script>
      
        <script src="../../../javascripts/katex.js"></script>
      
        <script src="https://unpkg.com/katex@0/dist/katex.min.js"></script>
      
        <script src="https://unpkg.com/katex@0/dist/contrib/auto-render.min.js"></script>
      
        <script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
      
    
  </body>
</html>